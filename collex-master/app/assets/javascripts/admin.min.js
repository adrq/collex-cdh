function stopAddBadgeUpload(e){return e.startsWith("OK:")?addBadgeDlg.fileUploadFinished(e.substring(3)):addBadgeDlg.fileUploadError(e),!0}function stopAddPublicationImageUpload(e){return e.startsWith("OK:")?addPublicationImageDlg.fileUploadFinished(e.substring(3)):addPublicationImageDlg.fileUploadError(e),!0}function impersonateUser(e,t){new SelectInputDlg({title:"Choose User to Impersonate",prompt:"Select the user that you wish to impersonate",id:"user_id",actions:t,target_els:null,pleaseWaitMsg:"Changing apparent logged in user...",body_style:"edit_palette_dlg",options:[{value:-1,text:"Loading user names. Please Wait..."}],populateUrl:e})}var AjaxUpdate=Class.create({initialize:function(e,t,a){var l=!1;this.sendWithAjax=function(i,s){if(!l){l=!0;var n=s.arg0,o=s.dlg,r=o.getAllData();if(o.setFlash(t,!1),a){var c=a(r);if(c)return o.setFlash(c,!0),void(l=!1)}var d=function(t){o.cancel(),$(e).update(t.responseText),l=!1},u=function(e){genericAjaxFail(o,e,n),l=!1};serverRequest({url:n,params:r,onSuccess:d,onFailure:u})}}}}),AddCategoryDlg=Class.create({initialize:function(e,t,a){this.class_type="AddCategoryDlg";var l=null,i=[],s=function(){var e=function(e){l.setFlash("",!1);try{e.responseText.length>0&&(i=e.responseText.evalJSON(!0))}catch(t){new MessageBoxDlg("Error",t)}var a=$$(".categories_select"),s=a.pop();s.update(""),i=i.sortBy(function(e){return e.text});var n=0;i.each(function(e){"[root]"===e.text?(n=e.value,s.appendChild(new Element("option",{value:e.value,selected:"selected"}).update(e.text))):s.appendChild(new Element("option",{value:e.value}).update(e.text))}),$("parent_category_id").value=n};serverRequest({url:a,onSuccess:e})},n=function(e){if(e.category_name.length<1)return"Please enter a name for the Resource Tree.";var t=!1;return i.each(function(a){a.text===e.category_name&&(t=!0)}),t?"That category name has already been used.":null},o=new AjaxUpdate(e,"Adding Category...",n),r={page:"layout",rows:[[{text:"This is a label that sites and other categories can be attached to.",klass:"new_exhibit_instructions"}],[{text:"Category Name:",klass:"admin_dlg_label"},{input:"category_name",klass:"new_exhibit_input"}],[{text:"Parent Category:",klass:"admin_dlg_label"},{select:"parent_category_id",klass:"categories_select",options:[{value:-1,text:"Loading categories. Please Wait..."}]}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:o.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},c={this_id:"add_category_dlg",pages:[r],body_style:"edit_palette_dlg",row_style:"new_exhibit_row",title:"Add Category To Resource Tree",focus:"category_name"};l=new GeneralDialog(c),l.center(),s(l)}}),AddSiteDlg=Class.create({initialize:function(e,t,a,l){this.class_type="AddSiteDlg";var i=null,s=function(){var e=[],t=function(t){i.setFlash("",!1);try{t.responseText.length>0&&(e=t.responseText.evalJSON(!0))}catch(a){new MessageBoxDlg("Error",a)}var l=$$(".categories_select"),s=l.pop();s.update(""),e=e.sortBy(function(e){return e.text});var n=0;e.each(function(e){"[root]"===e.text?(n=e.value,s.appendChild(new Element("option",{value:e.value,selected:"selected"}).update(e.text))):s.appendChild(new Element("option",{value:e.value}).update(e.text))}),$("parent_category_id").value=n};serverRequest({url:l,onSuccess:t})},n=function(e){return e.display_name.length<1?"Please enter a name for the Resource Tree.":null},o=new AjaxUpdate(e,"Adding Site...",n),r={page:"layout",rows:[[{text:'Enter the information for the site labeled "'+a+'" in solr.',klass:"new_exhibit_instructions"}],[{text:"Name in Resource Tree:",klass:"admin_dlg_label"},{input:"display_name",klass:"new_exhibit_input"}],[{text:"Parent Category:",klass:"admin_dlg_label"},{select:"parent_category_id",klass:"categories_select",options:[{value:-1,text:"Loading categories. Please Wait..."}]}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:o.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback},{hidden:"site",value:a}]]},c={this_id:"add_site_dlg",pages:[r],body_style:"edit_palette_dlg",row_style:"new_exhibit_row",title:"Add Site To Resource Tree",focus:"display_name"};i=new GeneralDialog(c),i.center(),s(i)}}),RemoveSiteDlg=Class.create({initialize:function(e,t,a){this.class_type="RemoveSiteDlg";var l=new AjaxUpdate(e,"Removing the site...",null),i={page:"layout",rows:[[{text:'You are about to delete the resource "'+a+"\" from the Resource Tree. This is probably ok because the resource doesn't appear to be returned by solr. However, this could also happen if the solr index is corrupted.",klass:"new_exhibit_instructions"}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:l.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback},{hidden:"site",value:a}]]},s={this_id:"remove_site_dlg",pages:[i],body_style:"edit_palette_dlg",row_style:"new_exhibit_row",title:"Remove Site From Resource Tree"},n=new GeneralDialog(s);n.center()}}),DeleteFacetDialog=Class.create({initialize:function(e,t,a,l){this.class_type="DeleteSiteDlg";var i=new AjaxUpdate(e,"Deleting the site...",null),s=null;s=l?{page:"layout",rows:[[{text:'You are about to delete the category "'+a+'" from the Resource Tree. All of its children will be moved up to its parent.',klass:"new_exhibit_instructions"}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:i.sendWithAjax},{button:"Cancel",callback:GeneralDialog.cancelCallback,isDefault:!0},{hidden:"site",value:a}]]}:{page:"layout",rows:[[{text:'You are about to delete the site "'+a+'" from the Resource Tree. This resource is indexed in solr so results from this resource can be seen in the search page. Are you sure?',klass:"new_exhibit_instructions"}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:i.sendWithAjax},{button:"Cancel",callback:GeneralDialog.cancelCallback,isDefault:!0},{hidden:"site",value:a}]]};var n={this_id:"delete_site_dlg",pages:[s],body_style:"edit_palette_dlg",row_style:"new_exhibit_row",title:"Delete Site From Resource Tree"},o=new GeneralDialog(n);o.center()}}),EditFacetDialog=Class.create({initialize:function(e,t,a,l){this.class_type="EditFacetDialog";var i=null,s=[],n=function(){i.setFlash("Loading data, please wait...",!1);var e=null,t=function(t){i.setFlash("",!1);try{if(t.responseText.length>0){var l=t.responseText.evalJSON(!0);s=l.categories,e=l.details}}catch(n){new MessageBoxDlg("Error",n)}var o=$$(".categories_select"),r=o.pop();r.update(""),s=s.sortBy(function(e){return e.text}),s.each(function(e){e.text!==a&&r.appendChild(new Element("option",{value:e.value}).update(e.text))});var c=$("edit_facet_dlg_sel0");if($A(c.options).each(function(t){parseInt(t.value)===e.parent_id&&(t.selected="selected")}),$("parent_category_id").value=e.parent_id,e.is_category){$("display_name").value=a;var d=$$(".hide_if_category");d.each(function(e){e.hide()}),$("carousel_url").value=e.carousel_url}else{var u=$$(".hide_if_site");u.each(function(e){e.hide()}),$("display_name").value=e.display_name,$("site_url").value=e.site_url,$("site_thumbnail").value=e.site_thumbnail}$("carousel_include").checked=1===e.carousel_include,$("carousel_description").value=e.carousel_description;var _=$("carousel_thumbnail_img");_&&(_.src=e.image)};serverRequest({url:l,params:{site:a},onSuccess:t})};this.sendWithAjax=function(l,i){var n=i.arg0,o=i.dlg;o.setFlash("Updating Facet...",!1);var r=o.getAllData();r.site=a;var c=!1;if(r.display_name!==a&&(s.each(function(e){e.text===r.display_name&&(c=!0)}),c))return void o.setFlash("That category name has already been used.",!0);var d=function(){var e=$("carousel_thumbnail"),l=e.up("form");l.appendChild(new Element("input",{type:"hidden",name:"value",value:a})),submitForm("layout",t+"_upload"),o.cancel()};serverAction({action:{actions:n,els:e,params:r,onSuccess:d}})};var o={page:"layout",rows:[[{text:'Edit the facet "'+a+'" for both the Resource Tree and the Carousel.',klass:"new_exhibit_instructions"}],[{text:"Parent Category:",klass:"edit_facet_label"},{select:"parent_category_id",klass:"categories_select",options:[{value:-1,text:"Loading categories. Please Wait..."}]}],[{text:"Name in Resource Tree:",klass:"edit_facet_label"},{input:"display_name",klass:"edit_facet_input"}],[{text:"Site URL:",klass:"hide_if_category edit_facet_label"},{input:"site_url",klass:"hide_if_category edit_facet_input"}],[{text:window.gFederationName+" Thumbnail:",klass:"hide_if_category edit_facet_label"},{input:"site_thumbnail",klass:"hide_if_category edit_facet_input"}],[{text:"Include in Carousel:",klass:"edit_facet_label"},{checkbox:"carousel_include",klass:""}],[{text:"Carousel Description:",klass:"edit_facet_label"},{textarea:"carousel_description",klass:"edit_facet_textarea"}],[{text:"Carousel URL:",klass:"hide_if_site edit_facet_label"},{input:"carousel_url",klass:"hide_if_site edit_facet_input"}],[{text:"Carousel Thumbnail:",klass:"edit_facet_label"},{image:"carousel_thumbnail",klass:"edit_profile_image",removeButton:"Remove Thumbnail",value:" "}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:this.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},r={this_id:"edit_facet_dlg",pages:[o],body_style:"edit_palette_dlg",row_style:"new_exhibit_row",title:"Edit Facet",focus:"display_name"};i=new GeneralDialog(r),i.center(),n(i)}}),EditGroupType=Class.create({initialize:function(e,t,a,l,i,s,n,o,r,c,d,u){this.class_type="EditGroupType",i.each(function(e){e.text===l&&(l=e.value)});var _=new AjaxUpdate(e,"Updating Group Type...",null),g={page:"layout",rows:[[{text:"Choose the type that this group will appear under in the Exhibit List.",klass:"new_exhibit_instructions"}],[{text:"Type:",klass:"edit_facet_label"},{select:"group_type",value:l,klass:"categories_select",options:i}],[{text:"Badge:",klass:"edit_facet_label"},{select:"badge_id",value:s,options:n}],[{text:"Publication Image:",klass:"edit_facet_label"},{select:"publication_image_id",value:o,options:r}],[{text:"Header Text Color:",klass:"edit_facet_label"},{input:"header_text_color",value:c}],[{text:"Header Bkgd Color:",klass:"edit_facet_label"},{input:"header_background_color",value:d}],[{text:"Link Color:",klass:"edit_facet_label"},{input:"link_color",value:u}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:_.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback},{hidden:"group_id",value:a}]]},p={this_id:"change_exhibit_category_dlg",pages:[g],body_style:"edit_palette_dlg",row_style:"new_exhibit_row",title:"Edit Group Type",focus:"category_id"},h=new GeneralDialog(p);h.center()}}),addBadgeDlg=null,AddBadgeDlg=Class.create({initialize:function(e){this.class_type="AddBadgeDlg";var t=this,a=null,l=function(){addBadgeDlg=t,a.setFlash("Adding badge thumbnail...",!1),submitForm("layout",e)};this.fileUploadError=function(e){a.setFlash(e,!0)},this.fileUploadFinished=function(){a.setFlash("Badge updated...",!1),reloadPage()};var i=function(){var e={page:"layout",rows:[[{text:"Choose Badge:"}],[{image:"image",size:"47",klass:"edit_group_thumbnail"}],[{rowClass:"gd_last_row"},{button:"Upload Badge",callback:l},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},t={this_id:"add_badge",pages:[e],body_style:"add_badge_div",row_style:"new_exhibit_row",title:"Add Badge"};a=new GeneralDialog(t),a.center()};i()}}),addPublicationImageDlg=null,AddPublicationImageDlg=Class.create({initialize:function(e){var t=this,a=null,l=function(){addPublicationImageDlg=t,a.setFlash("Adding publication image...",!1),submitForm("layout",e)};this.fileUploadError=function(e){a.setFlash(e,!0)},this.fileUploadFinished=function(){a.setFlash("Publication Image updated...",!1),reloadPage()};var i=function(){var e={page:"layout",rows:[[{text:"Choose Publication Image:"}],[{image:"image",size:"47",klass:"edit_group_thumbnail"}],[{rowClass:"gd_last_row"},{button:"Upload Image",callback:l},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},t={this_id:"add_badge",pages:[e],body_style:"add_badge_div",row_style:"new_exhibit_row",title:"Add Publication Image"};a=new GeneralDialog(t),a.center()};i()}});