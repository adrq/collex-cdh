var ForumReplyDlg=Class.create({initialize:function(e){this.class_type="ForumReplyDlg";var t=e.topic_id,l=e.group_id;l&&(t=-1);var i=e.cluster_id,a=e.group_name,n=e.cluster_label,s=e.cluster_name,o=e.thread_id,r=e.submit_url,c=e.can_delete,u=e.populate_exhibit_url,d=e.populate_collex_obj_url,_=e.populate_topics_url,h=e.progress_img,p=e.ajax_div,b=e.logged_in,m=e.redirect,g=e.addTopicToLoginRedirect,v=5,f=e.comment_id,k=null,y=null,w=null,x=null,C=null,j=null,D=null,T=null;if(void 0!==f&&(k=e.title,y=e.obj_type,w=e.reply,x=e.nines_obj_list,C=e.exhibit_list,j=e.inet_title,D=e.inet_thumbnail,T=e.inet_url),e.license&&(v=e.license),!b){var A=new SignInDlg;A.setInitialMessage("You must be logged in to create a comment.");var N="script=ForumReplyDlg";return g&&(N+="_"+t),A.setRedirectPageToCurrentWithParam(N),void A.show("sign_in")}var L=this,R=function(e){var t=function(t){var l=[];e.setFlash("",!1);try{t.responseText.length>0&&(l=t.responseText.evalJSON(!0))}catch(i){new MessageBoxDlg("Error",i)}var a=$$(".discussion_topic_select"),n=a[0];n.update(""),l=l.sortBy(function(e){return e.text}),l.each(function(e){n.appendChild(new Element("option",{value:e.value}).update(e.text))}),$("topic_id").writeAttribute("value",l[0].value)};serverRequest({url:_,onSuccess:t})},O=function(){var e=$$(".attach_item")[0];e.addClassName("hidden"),setTimeout(function(){var e=$$(".attach");e.each(function(e){e.removeClassName("hidden")})},50)},F="",I="";this.attachItem=function(e,t){O(),t.arg0="mycollection",F="forum_reply_dlg_btn0",I=t.arg0;var l=L.switch_page.bind($(F));l(e,t)},this.switch_page=function(e,t){if(""!==F){$(F).removeClassName("button_tab_selected");var l=$$("."+I);l.each(function(e){e.addClassName("hidden")})}F=this.id,I=t.arg0,$(this.id).addClassName("button_tab_selected");var i=$$("."+t.arg0);i.each(function(e){e.removeClassName("hidden")})},this.sendWithAjax=function(e,a){var n=a.arg0,s=a.dlg;s.setFlash("Adding Comment...",!1);var r=s.getAllData();if(r.thread_id=o,-1!==t&&(r.topic_id=t),l&&(r.group_id=l),i&&(r.cluster_id=i),r.comment_id=f,r.obj_type=I,r.can_delete=c,p){var u=function(){s.cancel()};serverAction({action:{actions:n,els:p,params:r,onSuccess:u,dlg:s}})}else{var d=function(){s.cancel(),gotoPage(m)};serverRequest({url:n,params:r,onSuccess:d,dlg:s})}};var P=new CreateListOfObjects(d,x,"nines_obj_list",h),S=new CreateListOfObjects(u,C,"exhibit_list",h),E=new ForumLicenseDisplay({populateLicenses:"/exhibits/get_licenses?non_sharing=false",currentLicense:v,id:"license_list"}),W={page:"layout",rows:[[{custom:E,klass:"forum_reply_license title hidden"},{text:"Title",klass:"forum_reply_label title hidden"}],[{input:"title",value:k,klass:"forum_reply_input title hidden"}],[{text:"Group: "+a,klass:"group hidden"}],[{text:n+": "+s,klass:"cluster hidden"}],[{text:"Topic:",klass:"forum_web_label group hidden"},{select:"topic_id",klass:"discussion_topic_select group hidden",options:[{value:-1,text:"Loading discussion topics. Please Wait..."}]}],[{textarea:"reply",klass:"clear_both",value:w?$(w).innerHTML:void 0}],[{link:"Attach an Item...",klass:"attach_item nav_link",arg0:"",callback:this.attachItem}],[{button:"My Collection",arg0:"mycollection",klass:"button_tab attach hidden",callback:this.switch_page},{button:"Exhibit",klass:"button_tab attach hidden",arg0:"exhibit",callback:this.switch_page},{button:"Web Item",klass:"button_tab attach hidden",arg0:"weblink",callback:this.switch_page}],[{text:"Sort objects by:",klass:"forum_reply_label mycollection hidden"},{select:"sort_by",callback:P.sortby,klass:"link_dlg_select mycollection hidden",value:"date_collected",options:[{text:"Date Collected",value:"date_collected"},{text:"Title",value:"title"},{text:"Author",value:"author"}]},{text:"and",klass:"link_dlg_label_and mycollection hidden"},{inputFilter:"filterObjects",klass:"mycollection hidden",prompt:"type to filter objects",callback:P.filter}],[{custom:P,klass:"mycollection hidden"},{custom:S,klass:"exhibit hidden"}],[{text:"Caption:",klass:"forum_web_label weblink hidden"},{input:"inet_title",value:j,klass:"forum_web_input weblink hidden"}],[{text:"URL:",klass:"forum_web_label weblink hidden"},{input:"inet_url",value:T,klass:"forum_web_input weblink hidden"}],[{text:"Thumbnail for Item:",klass:"forum_web_label weblink hidden"},{input:"inet_thumbnail",value:D,klass:"forum_web_input weblink hidden"}],[{rowClass:"gd_last_row"},{button:"Post",arg0:r,callback:this.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},G=null;(t||f&&k)&&(G="title");var H=t?"New Post":o?"Reply":"Edit Comment",M={this_id:"forum_reply_dlg",pages:[W],body_style:"forum_reply_dlg",row_style:"forum_reply_row",title:H,focus:G},q=new GeneralDialog(M);(t||f&&k)&&$$(".title").each(function(e){e.removeClassName("hidden")}),l&&$$(".group").each(function(e){e.removeClassName("hidden")}),i&&$$(".cluster").each(function(e){e.removeClassName("hidden")}),q.initTextAreas({toolbarGroups:["fontstyle","link"],linkDlgHandler:new LinkDlgHandler([d],h)}),E.populate(q),P.populate(q,!1,"forum"),S.populate(q,!1,"forum"),q.center(),l&&R(q),y&&1!==y&&YAHOO.util.Event.onAvailable("reply_container",function(){O();var e=["mycollection","exhibit","weblink"],t={arg0:e[y-2]};F="forum_reply_dlg_btn"+(y-2),I=t.arg0;var l=L.switch_page.bind($(F));l(null,t)},this)}});