function encodeForUri(e){var t=e.gsub("%","%25");return t=t.gsub("#","%23"),t=t.gsub("&","%26"),t=t.gsub(/\?/,"%3f")}function removeHidden(e,t){var s=$(e);s.innerHTML.indexOf("more")>0?($$("#"+t+" .hidden").each(function(e){"IMG"!==e.tagName&&e.removeClassName("hidden"),e.addClassName("was_hidden")}),s.update(s.innerHTML.gsub("more","less"))):($$("#"+t+" .was_hidden").each(function(e){e.addClassName("hidden")}),s.update(s.innerHTML.gsub("less","more")))}function bulkTag(e){for(var t=Form.getInputs("bulk_collect_form","checkbox"),s="",l=!1,a=0;a<t.length;a++){var n=t[a];n.checked&&(s+=n.value+"	",l=!0)}if(l){var i={title:"Add Tag To All Checked Objects",prompt:"Tag:",id:"tag[name]",okStr:"Save",explanation_text:"Add multiple tags by separating them with a comma (e.g. painting, visual_art)",explanation_klass:"gd_text_input_help",extraParams:{uris:s},autocompleteParams:{url:e,token:","},inputKlass:"new_exhibit_autocomplete",actions:["/results/bulk_add_tag"],target_els:[null]};new TextInputDlg(i)}else new MessageBoxDlg("Error","You must select one or more objects before clicking this button.")}function bulkCollect(e){for(var t=Class.create({initialize:function(t){var s=t.title,l=t.addAction,a=t.skipAction,n=null,i="tag[name]",o="Your objects have been collected. Would you like to add a tag to the batch?",r="Tag:",c="Add multiple tags by separating them with a comma (e.g. painting, visual_art)";this.add=function(e,t){t.dlg.cancel();var s=t.dlg.getAllData(),a=s[i];l(a)},this.skip=function(e,t){t.dlg.cancel(),a()};var u={page:"layout",rows:[[{text:o,klass:"gd_text_input_dlg_label"}],[{text:r,klass:"gd_text_input_dlg_label"},{autocomplete:i,klass:"new_exhibit_autocomplete",url:e,token:","}],[{text:c,id:"gd_postExplanation",klass:"gd_text_input_help"}],[{rowClass:"gd_last_row"},{button:"Add Tags",callback:this.add,isDefault:!0},{button:"Skip Tags",callback:this.skip}]]};u.rows.push();var d={this_id:"gd_text_input_dlg",pages:[u],body_style:"gd_message_box_dlg",row_style:"gd_message_box_row",title:s,focus:GeneralDialog.makeId(i)};n=new GeneralDialog(d),n.center()}}),s=Form.getInputs("bulk_collect_form","checkbox"),l=!1,a=0;a<s.length;a++){var n=s[a];n.checked&&(l=!0)}if(l){var i=function(e){var t=$("bulk_tag_text");t.value=e,submitForm("bulk_collect_form","/results/bulk_collect","post")},o=function(){submitForm("bulk_collect_form","/results/bulk_collect","post")};new t({title:"Tag Selections",addAction:i,skipAction:o})}else new MessageBoxDlg("Error","You must select one or more objects before clicking this button.")}function bulkUncollect(){for(var e=Form.getInputs("bulk_collect_form","checkbox"),t=!1,s=0;s<e.length;s++){var l=e[s];if(l.checked){t=!0;break}}t?submitFormWithConfirmation({id:"bulk_collect_form",action:"/results/bulk_uncollect",title:"Remove Selected Objects from Collection?",message:"Are you sure you wish to remove the selected objects from your collection?"}):new MessageBoxDlg("Error","You must select one or more objects before clicking this button.")}function toggleAllBulkCollectCheckboxes(){bulk_checked=!bulk_checked;for(var e=Form.getInputs("bulk_collect_form","checkbox"),t=0;t<e.length;t++){var s=e[t];s.checked=bulk_checked}var l=document.getElementsByClassName("bulk_select_all");for(t=0;t<l.length;t++)l[t].toggle();for(l=document.getElementsByClassName("bulk_unselect_all"),t=0;t<l.length;t++)l[t].toggle()}function expandAllItems(){var e=jQuery(".search_result_data_container .hidden");e.removeClass("hidden"),e.addClass("was_hidden");var t=jQuery(".search_result_data_container .more");t.each(function(e,t){t=jQuery(t),t.html(t.html().replace("more","less"))})}function collapseAllItems(){var e=jQuery(".search_result_data_container .was_hidden");e.addClass("hidden"),e.removeClass("was_hidden");var t=jQuery(".search_result_data_container .more");t.each(function(e,t){t=jQuery(t),t.html(t.html().replace("less","more"))})}function toggleItemExpand(){var e=document.getElementById("expand_all"),t=document.getElementById("collapse_all");"none"===t.style.display?(e.style.display="none",t.style.display="",expandAllItems()):(e.style.display="",t.style.display="none",collapseAllItems())}function doCollect(e,t,s,l,a,n){if(!a){var i=new SignInDlg;return i.setInitialMessage("Please log in to collect objects"),i.setRedirectPageToCurrentWithParam("script=doCollect&uri="+t+"&row_num="+s+"&row_id="+l),void i.show("sign_in")}var o={partial:e,uri:t,row_num:s,full_text:""},r=function(e){var t=JSON.parse(e.responseText);window.collex.setCollected(s,t.collected_on,n)},c={waitMessage:"Collecting object..."};serverAction({action:{actions:"/results/collect.json",els:[],params:o,onSuccess:r},progress:c}),ninesObjCache&&ninesObjCache.reset("/forum/get_nines_obj_list")}function doRemoveTag(e,t,s){var l=t.substring(t.lastIndexOf("_")+1),a=function(e){var t=JSON.parse(e.responseText);window.collex.redrawTags(l,t.my_tags,t.other_tags)};serverAction({action:{actions:"/results/remove_tag.json",els:[],params:{uri:e,row_num:l,tag:s,full_text:""},onSuccess:a}})}function doRemoveCollect(e,t,s,l){var a={partial:e,uri:t,row_num:s,full_text:""},n=function(){window.collex.setUncollected(s,l),ninesObjCache&&ninesObjCache.reset("/forum/get_nines_obj_list")};serverAction({confirm:{title:"Remove Object from Collection?",message:"Are you sure you wish to remove this object from your collection?"},action:{actions:"/results/uncollect",els:[],onSuccess:n,params:a},progress:{waitMessage:"Removing collected object..."}})}function doAddTag(e,t,s,l){var a={title:"Add Tag",prompt:"Tag:",explanation_text:"Add multiple tags by separating them with a comma (e.g. painting, visual_art)",explanation_klass:"gd_text_input_help",id:"tag[name]",okStr:"Save",extraParams:{uri:t,row_num:s,row_id:l,full_text:""},autocompleteParams:{url:e,token:","},inputKlass:"new_exhibit_autocomplete",actions:"/results/add_tag.json",target_els:[],onSuccess:function(e){var t=JSON.parse(e.responseText);window.collex.redrawTags(s,t.my_tags,t.other_tags)}};new TextInputDlg(a)}function realLinkToEditorLink(e){var t=e.indexOf("<a");if(0>t)return e;var s=e.substring(0,t),l=e.substring(t);if(t=l.indexOf("</a>"),0>t)return e;var a=l.substring(t+4);l=l.substring(0,t);var n="ext_linklike",i="External Link";if(l.indexOf("nines_link")>0&&(n="nines_linklike",i="NINES Object"),t="nines_linklike"===n?l.indexOf("uri="):l.indexOf("href="),0>t)return e;var o=l.substring(t).indexOf("=");l=l.substring(t+o+2),t=l.indexOf('"');var r=l.indexOf("'");0>t?t=r:r>=0&&t>r&&(t=r);var c=l.substring(0,t);if(t=l.indexOf(">"),0>t)return e;var u=l.substring(t+1);return l='<span class="'+n+'" real_link="'+c+'" title="'+i+": "+c+'">'+u+"</span>",realLinkToEditorLink(s+l+a)}function doAnnotation(e,t,s,l,a,n){var i=$(l).innerHTML;i=i.gsub("<br />","\n"),i=i.gsub("<br>","\n"),i=realLinkToEditorLink(i);var o=function(s){var l=function(){window.collex.redrawAnnotation(t,s)};serverAction({action:{actions:"/results/set_annotation",els:[],params:{note:s,uri:e,row_num:t,full_text:""},onSuccess:l}})},r=i.length>0?"Edit Private Annotation":"Add Private Annotation";new RteInputDlg({title:r,value:i,populate_urls:[a],progress_img:n,okCallback:o})}function doAddToExhibit(e,t,s,l,a){function n(e){var t=JSON.parse(e.responseText);window.collex.redrawExhibits(s,t.exhibits)}if(0===window.collex.exhibit_names.length)new MessageBoxDlg("Exhibits",'You have not yet created any exhibits. <a href="/'+a+'" class="nav_link" >Click here</a> to get started with the Exhibit Wizard.');else{for(var i=$("search_result_"+s+"_full_text"),o=i?i.innerHTML:"",r=[],c=0;c<window.collex.exhibit_names.length;c++){var u=window.collex.exhibit_names[c],d=u.text.length>60?u.text.substring(0,60)+"...":u.text;r.push({text:d,value:u.value})}new SelectInputDlg({title:"Choose exhibit",prompt:"Exhibit:",id:"exhibit",actions:"/results/add_object_to_exhibit",target_els:[],okStr:"Save",options:r,extraParams:{partial:e,uri:t,row_num:s,full_text:o},onSuccess:n})}}var ResultRowDlg=Class.create({initialize:function(e,t,s,l){this.class_type="ResultRowDlg";var a=null,n="",i=l;i.uri=t;var o=function(){var t=function(t){a.setFlash("",!1);try{n=t.responseText}catch(s){genericAjaxFail(a,s,e)}var l=$$(".result_row_details"),i=l[0];i.update(n);var o=i.select(".search_result_data .hidden");o.each(function(e){e.removeClassName("hidden")})};serverRequest({url:e,params:i,onSuccess:t})},r={page:"layout",rows:[[{text:'<img src="'+s+'" alt="Please wait..." />',klass:"result_row_details"}],[{rowClass:"gd_last_row"},{button:"Cancel",callback:GeneralDialog.cancelCallback,isDefault:!0}]]},c={this_id:"result_row_dlg",pages:[r],body_style:"result_row_dlg",row_style:"result_row_row",title:"Object Details"};a=new GeneralDialog(c),a.center(),o()}}),bulk_checked=!1,StartDiscussionWithObject=Class.create({initialize:function(e,t,s,l,a,n,i,o){this.class_type="StartDiscussionWithObject";var r=null;if(!n){var c=new SignInDlg;return c.setInitialMessage("Please log in to start a discussion"),c.setRedirectPageToCurrentWithParam("script=StartDiscussionWithObject"),void c.show("sign_in")}var u=function(){var t=function(e){var t=[];r.setFlash("",!1);try{e.responseText.length>0&&(t=e.responseText.evalJSON(!0))}catch(s){new MessageBoxDlg("Error",s)}var l=$$(".discussion_topic_select"),a=l[0];a.update(""),t=t.sortBy(function(e){return e.text}),t.each(function(e){a.appendChild(new Element("option",{value:e.value}).update(e.text))}),$("topic_id").writeAttribute("value",t[0].value)};serverRequest({url:e,onSuccess:t})};this.sendWithAjax=function(e,t){var l=t.arg0,n=t.dlg;n.setFlash("Updating Discussion Topics...",!1);var i=n.getAllData();i.inet_thumbnail="",i.thread_id="",i.nines_exhibit="",i.nines_object=s,i.inet_url="",i.inet_title="",i.disc_type="NINES Object";var o=function(e){jQuery(a).hide(),n.cancel(),gotoPage(e.responseText)};serverRequest({url:l,params:i,onSuccess:o})};var d=new ForumLicenseDisplay({populateLicenses:"/exhibits/get_licenses?non_sharing=false",currentLicense:5,id:"license_list"}),_={page:"start_discussion",rows:[[{text:"Starting a discussion of: "+l,klass:"new_exhibit_label"}],[{custom:d,klass:"forum_reply_license title"},{text:"Select the topic you want this discussion to appear under:",klass:"new_exhibit_label"}],[{select:"topic_id",klass:"discussion_topic_select",options:[{value:-1,text:"Loading discussion topics. Please Wait..."}]}],[{text:"Title",klass:"forum_reply_label title "}],[{input:"title",klass:"forum_reply_input title"}],[{textarea:"description"}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:this.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},g={this_id:"start_discussion_with_object_dlg",pages:[_],body_style:"forum_reply_dlg",row_style:"new_exhibit_row",title:"Choose Discussion Topic",focus:"start_discussion_with_object_dlg_sel0"};r=new GeneralDialog(g),r.initTextAreas({toolbarGroups:["fontstyle","link"],linkDlgHandler:new LinkDlgHandler([i],o)}),d.populate(r),r.center(),u(r)}});