nulljQuery(document).ready(function(e){"use strict";function t(e){var t=e.thumbnail,l=t?e.image:void 0;if(!t){var i=window.collex.getArchive(e.archive);i&&(t=i.thumbnail)}t||(t=window.collex.images.federationThumbnail);var s="progress_"+v++,a=e.title?e.title:"Image",r=window.pss.createHtmlTag("img",{src:t,alt:a,"class":"result_row_img hidden",onload:'finishedLoadingImage("'+s+'", this, 100, 100);'}),n=window.pss.createHtmlTag("img",{id:s,"class":"progress_timeout result_row_img_progress",src:window.collex.images.spinner,alt:"loading...","data-noimage":window.collex.images.spinnerTimeout});if(l){a.length>60&&(a=a.substr(0,59)+"...");var o='showInLightbox({ title: "'+a+'", img: "'+l+'", spinner: "'+window.collex.images.spinner+'", size: 500 }); return false;';r=window.pss.createHtmlTag("a",{"class":"nines_pic_link",onclick:o,href:"#"},r)}return n+r}function l(e,l){var i="",s=window.collex.currentUserId&&window.collex.currentUserId>0;s&&(i=window.pss.createHtmlTag("input",{type:"checkbox",id:"bulk_collect_"+e,name:"bulk_collect["+e+"]",value:l.uri}));var a=t(l),r="";"true"===l.freeculture&&(r+=window.pss.createHtmlTag("span",{"class":"tooltip free_culture"},"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+window.pss.createHtmlTag("span",{"class":"result_row_tooltip"},"Free Culture resource"))),"true"===l.has_full_text&&(r+=window.pss.createHtmlTag("span",{"class":"tooltip full_text"},"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+window.pss.createHtmlTag("span",{"class":"result_row_tooltip"},"Full text provided for this document"))),"true"===l.source_xml&&(r+=window.pss.createHtmlTag("span",{"class":"tooltip has_xml_source"},"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+window.pss.createHtmlTag("span",{"class":"result_row_tooltip"},"XML source available for this document")));var n=window.pss.createHtmlTag("div",{"class":"result_row_icons"},r),o=window.pss.createHtmlTag("div",{"class":"search_result_image"},a+n);return window.pss.createHtmlTag("div",{"class":"search_result_left"},i+o)}function i(e,t){var l=(t?"":window.pss.createHtmlTag("button",{"class":"collect"},"Collect"),t?window.pss.createHtmlTag("button",{"class":"uncollect"},"Uncollect"):"",window.pss.createHtmlTag("button",{"class":"discuss"},"Discuss"),t?window.pss.createHtmlTag("button",{"class":"exhibit"},"Exhibit"):""),i=window.collex.hasTypewright&&e.typewright?window.pss.createHtmlTag("button",{"class":"edit log-in-first-link","data-login-prompt":"Please log in to begin editing"},"Edit"):"",s="";return window.collex.hasPageSearch&&e.has_pages&&(s=window.pss.createHtmlTag("button",{"class":"page-search"},"All Pages")),window.pss.createHtmlTag("div",{"class":"search_result_buttons"},l+i+s)}function s(e){var t=encodeURIComponent(e.url),l=e.title?encodeURIComponent(e.title):"",i=e.role_AUT?encodeURIComponent(e.role_AUT):"",s=e.date_label?encodeURIComponent(e.date_label):"",a=e.role_PBL?encodeURIComponent(e.role_PBL):"",r=["ctx_ver=Z39.88-2004","rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook","rft_id="+t,"rfr_id=info%3Asid%2Focoins.info%3Agenerator","rft.genre=book","rft.btitle="+l,"rft.title="+l,"rft.aulast="+i,"rft.aufirst=","rft.au="+i,"rft.date="+s,"rft.pub="+a];return r.join("&amp;")}function a(e,t){if(e||(e="No title"),e.length<200)return window.pss.createHtmlTag("a",{"class":"nines_link doc-title",href:t,target:"_blank",title:" "},e);b++;var l=e.substr(0,199),i=e.substr(199),s="title_more_"+b,a=l+window.pss.createHtmlTag("span",{id:s,style:"display:none;"},i);return window.pss.createHtmlTag("a",{"class":"nines_link doc-title",title:e,target:"_blank",href:t},a)+window.pss.createHtmlTag("a",{href:"#",onclick:"return false;","class":"nav_link more_link","data-div":s,"data-less":"[show less]",title:" "},"...[show full title]")}function r(e){var t="";window.collex.isAdmin&&(t=window.pss.createHtmlTag("a",{"class":"uri_link",href:"#"},"uri")+window.pss.createHtmlTag("span",{style:"display:none;"},e.uri+"&nbsp;"));var l=a(e.title,e.url),i=window.pss.createHtmlTag("div",{"class":"search_result_header"},t+l);return window.pss.createHtmlTag("span",{"class":"Z3988",title:s(e)},i)}function n(e){return window.pss.createHtmlTag("div",{"class":e,style:"display:none;"},window.pss.createHtmlTag("span",{"class":"label"},"")+window.pss.createHtmlTag("span",{"class":"value"},""))}function o(e,t,l){e.find(".label").html(t),e.find(".value").html(l)}function c(e,t,l,i,s){if(!l)return"";var a="row";switch(i&&(a+=" hidden",T=!0),s&&(a+=" "+s),e){case"separate_lines":for(var r=window.pss.createHtmlTag("div",{"class":a},window.pss.createHtmlTag("span",{"class":"label"},t)+window.pss.createHtmlTag("span",{"class":"value"},l[0])),n=1;n<l.length;n++)r+=window.pss.createHtmlTag("div",{"class":a},window.pss.createHtmlTag("span",{"class":"label"},"")+window.pss.createHtmlTag("span",{"class":"value"},l[n]));return r;case"single_item":return window.pss.createHtmlTag("div",{"class":a},window.pss.createHtmlTag("span",{"class":"label"},t)+window.pss.createHtmlTag("span",{"class":"value"},l));case"multiple_item":return window.pss.createHtmlTag("div",{"class":a},window.pss.createHtmlTag("span",{"class":"label"},t)+window.pss.createHtmlTag("span",{"class":"value"},l.join("; ")));case"one_col":return window.pss.createHtmlTag("div",{"class":a},window.pss.createHtmlTag("span",{"class":"one-col"},l))}}function u(e){return e&&0!==e.length?window.pss.createHtmlTag("div",{"class":"search_result_full_text_label"},"Excerpt from Full Text:")+window.pss.createHtmlTag("span",{"class":"snippet"},e):""}function m(e,t,l,i){var s,a="";if(l)for(s=0;s<l.length;s++){0!==s&&(a+=" | "),a+=window.pss.createHtmlTag("a",{"class":"tag_link my_tag",title:"view all objects tagged &quot;"+l[s]+"&quot;",href:"/tags/results?tag="+l[s]+"&amp;view=tag"},l[s]);var r="doRemoveTag('"+e+"', 'search_result_"+t+"', '"+l[s]+"'); return false;";a+=window.pss.createHtmlTag("a",{"class":"modify_link remove_tag",title:"delete tag &quot;"+l[s]+"&quot;",onclick:r,href:"#"},"X")}if(i&&i.length>0)for(l&&l.length>0&&(a+=" | "),s=0;s<i.length;s++)a+=window.pss.createHtmlTag("a",{"class":"tag_link other_tag",title:"view all objects tagged &quot;"+i[s]+"&quot;",href:"/tags/results?tag="+i[s]+"&amp;view=tag"},i[s]);return a}function p(e,t,l,i){var s,a="doAddTag('/tag/tag_name_autocomplete', '"+e+"', "+t+", 'search_result_"+t+"', event); return false;",r=window.collex.currentUserId&&window.collex.currentUserId>0;return s=r?window.pss.createHtmlTag("button",{"class":"modify_link",id:"add_tag_"+t,onclick:a},"[add&nbsp;tag]"):window.pss.createHtmlTag("span",{"class":"tags_instructions"},"["+window.pss.createHtmlTag("a",{"class":"nav_link",href:"#",onclick:"var dlg = new SignInDlg(); dlg.show('sign_in'); return false;"},"LOG IN")+" to add tags]"),m(e,t,l,i)+s}function d(e,t,l){var i,s="doAnnotation('"+t+"', "+e+", 'search_result_"+e+"', 'annotation_"+e+"', '/forum/get_nines_obj_list', '"+window.collex.images.spinner+"'); return false;",a="<br>"+window.pss.createHtmlTag("span",{id:"annotation_"+e,"class":"annotation"},l);return i=l&&l.length>0?"Edit Private Annotation":"Add Private Annotation",window.pss.createHtmlTag("button",{"class":"modify_link",onclick:s},i)+a}function _(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],l=e.split("T");l=l[0].split("-");var i=parseInt(l[2],10),s=parseInt(l[1],10)-1,a=l[0];return t[s]+" "+i+", "+a}function w(e){var t=e.title+"&nbsp;"+window.pss.createHtmlTag("a",{"class":"nav_link",href:e.view_path},"[view]");return e.edit_path&&e.edit_path.length>0&&(t+="&nbsp;"+window.pss.createHtmlTag("a",{"class":"nav_link",href:e.edit_path},"[edit]")),t}function g(e){if(!e)return null;try{e=JSON.parse(e)}catch(t){return window.console.error(t.message),null}for(var l=[],i=0;i<e.length;i++)l.push(f(e[i]));return l}function h(e,t,l){T=!1;var i="",s=window.collex.getSite(e.archive);i+=c("single_item","Shelfmark:",e.shelfmark,!1),i+=c("multiple_item","Date:",e.date_label,!1),i+=c("single_item","Place of Composition:",e.composition,!1),i+=c("single_item","Provenance:",e.provenance,!1),i+=c("single_item","Place of Origin:",e.origin,!1),i+=c("single_item","Site:",s,!1),i+=c("multiple_item","Genre:",e.genre,!0),i+=c("multiple_item","Discipline:",e.discipline,!0),i+=c("single_item","Divisions:",e.divisions,!0),i+=c("single_item","Content Type:",e.type_content,!0),i+=c("multiple_item","Digital Artifact Type:",e.type_digital_artifact,!0),i+=c("single_item","Original Artifact Type:",e.type_original_artifact,!0),i+=c("multiple_item","Subject:",e.subject,!0),i+=c("single_item","Exhibit&nbsp;type:",e.exhibit_type,!0),i+=c("single_item","License:",e.license,!0),i+=c("multiple_item","Editor:",e.role_EDT,!0),i+=c("multiple_item","Publisher:",e.role_PBL,!0),i+=c("multiple_item","Owner:",e.role_OWN,!0),i+=c("multiple_item","Translator:",e.role_TRL,!0),i+=c("multiple_item","Architect:",e.role_ARC,!0),i+=c("multiple_item","Binder:",e.role_BND,!0),i+=c("multiple_item","Book Designer:",e.role_BKD,!0),i+=c("multiple_item","Book Producer:",e.role_BKP,!0),i+=c("multiple_item","Broadcaster:",e.role_BRD,!0),i+=c("multiple_item","Calligrapher:",e.role_CLL,!0),i+=c("multiple_item","Cartographer:",e.role_CTG,!0),i+=c("multiple_item","Collector:",e.role_COL,!0),i+=c("multiple_item","Colorist:",e.role_CLR,!0),i+=c("multiple_item","Commentator:",e.role_CWT,!0),i+=c("multiple_item","Compiler:",e.role_COM,!0),i+=c("multiple_item","Compositor:",e.role_CMT,!0),i+=c("multiple_item","Cinematographer:",e.role_CNG,!0),i+=c("multiple_item","Conductor:",e.role_CND,!0),i+=c("multiple_item","Creator:",e.role_CRE,!0),i+=c("multiple_item","Director:",e.role_DRT,!0),i+=c("multiple_item","Dubious Author:",e.role_DUB,!0),i+=c("multiple_item","Facsimilist:",e.role_FAC,!0),i+=c("multiple_item","Former Owner:",e.role_FMO,!0),i+=c("multiple_item","Illuminator:",e.role_ILU,!0),i+=c("multiple_item","Illustrator:",e.role_ILL,!0),i+=c("multiple_item","Interviewer:",e.role_IVR,!0),i+=c("multiple_item","Interviewee:",e.role_IVE,!0),i+=c("multiple_item","Lithographer:",e.role_LTG,!0),i+=c("multiple_item","Owner:",e.role_OWN,!0),i+=c("multiple_item","Performer:",e.role_PRF,!0),i+=c("multiple_item","Printer:",e.role_PRT,!0),i+=c("multiple_item","Printer of plates:",e.role_POP,!0),i+=c("multiple_item","Printmaker:",e.role_PRM,!0),i+=c("multiple_item","Producer:",e.role_PRO,!0),i+=c("multiple_item","Production Company:",e.role_PRN,!0),i+=c("multiple_item","Repository:",e.role_RPS,!0),i+=c("multiple_item","Rubricator:",e.role_RBR,!0),i+=c("multiple_item","Scribe:",e.role_SCR,!0),i+=c("multiple_item","Sculptor:",e.role_SCL,!0),i+=c("multiple_item","Translator:",e.role_TRL,!0),i+=c("multiple_item","Type Designer:",e.role_TYD,!0),i+=c("multiple_item","Typographer:",e.role_TYG,!0),i+=c("multiple_item","Wood Engraver:",e.role_WDE,!0),i+=c("multiple_item","Wood Cutter:",e.role_WDC,!0),i+=c("single_item","Notes:",e.notes,!0),i+=c("single_item","Alternative Title",e.alternative,!0),i+=c("multiple_item","By:",e.role_AUT,!1),i+=c("multiple_item","Artist:",e.role_ART,!0),i+=l?c("single_item","Collected&nbsp;on:",_(l),!1,"collected-on"):n("row collected-on"),i+=c("separate_lines","Source:",e.source,!0),i+=c("separate_lines","Has Part:",g(e.hasPart),!0),i+=c("separate_lines","Is Part Of:",g(e.isPartOf),!0);var a;if(e.exhibits){a=[];for(var r=0;r<e.exhibits.length;r++)a.push(w(e.exhibits[r]))}i+=a?c("multiple_item","Exhibits:",a,!0,"exhibits-row"):n("row exhibits-row"),T&&null!==t&&(i+=window.pss.createHtmlTag("button",{id:"more-search_result_"+t,"class":"nav_link more",onclick:'removeHidden("more-search_result_'+t+'", "search_result_'+t+'");return false;'},"[more...]"));var o=d(t,e.uri,e.annotation),m={"class":"row annotation-row"};return l||(m.style="display:none;"),i+=window.pss.createHtmlTag("div",m,o),i+=u(e.text),window.pss.createHtmlTag("div",{"class":"search_result_data_container","data-uri":e.uri},i)}function f(e){var t=r(e),l=h(e,null);return window.pss.createHtmlTag("div",{"class":"search-result-sub"},t+l)}var v=0,b=0,T=!1;window.collex.createMediaBlock=function(e,t,s,a){var n=l(t,e),o=i(e,s),c=r(e),u=h(e,t,a),m=window.pss.createHtmlTag("div",{"class":"search_result_right"},c+u),p=window.pss.createHtmlTag("div",{"class":"clear_both"},"")+window.pss.createHtmlTag("hr",{"class":"search_results_hr"}),d="search-result";return s&&(d+=" result_row_collected"),p+=window.pss.createHtmlTag("div",{id:"search_result_"+t,"class":d,"data-index":t,"data-uri":e.uri},n+o+m)},window.collex.setCollected=function(t,l,s){var a=e("#search_result_"+t);if(a.length){a.addClass("result_row_collected");var r={};s&&(r.typewright=!0);var n=i(r,!0);a.find(".search_result_buttons").html(n);var c=a.find(".collected-on");o(c,"Collected&nbsp;on:",_(l)),a.find(".collected-on").show(),a.find(".annotation-row").show()}},window.collex.setUncollected=function(t,l){var s=e("#search_result_"+t);if(s.length){s.removeClass("result_row_collected");var a={};l&&(a.typewright=!0);var r=i(a,!1);s.find(".search_result_buttons").html(r),s.find(".collected-on").hide();var n=s.find(".annotation-row");n.find("button").text("Add Private Annotation"),n.find(".annotation").text(""),n.hide()}},window.collex.redrawTags=function(t,l,i){var s=e("#search_result_"+t);if(s.length){var a=s.find(".tag-list .value"),r=s.attr("data-uri"),n=p(r,t,l,i);a.html(n)}},window.collex.redrawAnnotation=function(t,l){var i=e("#search_result_"+t);if(i.length){var s=i.find(".annotation-row"),a=i.closest(".search_result_data_container"),r=a.attr("data-uri"),n=d(t,r,l);s.html(n)}},window.collex.redrawExhibits=function(t,l){var i=e("#search_result_"+t);if(i.length){var s=i.find(".exhibits-row"),a=[];if(l){for(var r=0;r<l.length;r++)a.push(w(l[r]));s.find(".value").html(a.join("<br>")),s.find(".label").html("Exhibits:"),s.show()}else s.hide()}},window.collex.createPageResult=function(e){var t="<div class='page-search-result'>";return t+="<div class='page-num'>Page "+e.page_num+"</div>",t+="<div class='search_result_full_text_label'>Excerpt:</div>",t+="<span class='snippet'>",t+=e.text,t+="</span>",t+="</div>"},window.collex.createPageResultRows=function(t){var l="<div class='page_header'>";if(l+="<span id='page-count'>Page Search Results (",l+=t.total_pages,l+=")</span>",l+="<p id='search-hint'>Use search box above to find page-level results</p>",t.total_pages>t.pages.length&&(l+="<div class='pages pagination'></div>"),l+="</div>",0===t.pages.length)l+=t.query.q?"<div class='no-page-matches'>No matches found in the pages of this document</div>":"<div class='no-page-matches'>To get Page Search Results, enter search term(s) above</div>";else for(var i=0;i<t.pages.length;i++)l+=window.collex.createPageResult(t.pages[i],i);e(".page-results").html(l)},window.collex.createResultRows=function(t){for(var l="",i=0;i<t.hits.length;i++){var s=void 0!==t.collected[t.hits[i].uri];l+=window.collex.createMediaBlock(t.hits[i],i,s,t.collected[t.hits[i].uri])}e(".search-results").html(l)}});