var BorderDialog=Class.create();BorderDialog.prototype={initialize:function(){var e=this;this.myPanel=new YAHOO.widget.Dialog("edit_border_dlg",{width:"380px",constraintoviewport:!0,underlay:"shadow",close:!0,visible:!0,modal:!0,draggable:!0}),this.myPanel.setHeader("Edit Border");var r=[{text:"Submit",handler:this.handleSubmit},{text:"Cancel",handler:this.handleCancel}];this.myPanel.cfg.queueProperty("buttons",r);var t=new Element("div",{id:"border_outer_container"}),o=new Element("div",{id:"border_dlg_instructions"}).update('First, drag the mouse over some sections and then click "Add Border" or "Remove Border".');o.addClassName("instructions"),t.appendChild(o);var n=new Element("div",{id:"border_container"});t.appendChild(n);var a=$$(".selected_page .exhibit_outline_text"),s=a[0].innerHTML,d=new Element("span").update("&nbsp;&nbsp;"+s);d.addClassName("exhibit_outline_text");var i=d.wrap("div");i.addClassName("unselected_page"),i.addClassName("selected_page"),n.appendChild(i);var l=$$(".selected_page .outline_element");l.each(function(e){var r=e.up(),t=e.previous(),o=e.next(),a="border_dlg_element";r.hasClassName("outline_section_with_border")&&(a+=" border_sides",null===t&&(a+=" border_top"),null===o&&(a+=" border_bottom"));var s=e.innerHTML,d=new Element("div",{id:"border_"+e.id}).update(s);d.addClassName(a);var i=d.wrap("div",{id:"rubberband_"+e.id});i.addClassName("rubberband_dlg_element"),n.appendChild(i)},this),this.center=function(e,r){var t=$("edit_border_dlg"),o=parseInt(t.getStyle("width"),10),n=parseInt(t.getStyle("height"),10),a=YAHOO.util.Dom.getViewportWidth(),s=YAHOO.util.Dom.getViewportHeight(),d=(a-o)/2,i=(s-n)/2;d+=e,i+=r,0>d&&(d=0),0>i&&(i=0);var l=t.up();l.setStyle({left:d+"px",top:i+"px"}),window.scroll(e,r)},this.myPanel.setBody(t);var b=YAHOO.util.Dom.getDocumentScrollLeft(),c=YAHOO.util.Dom.getDocumentScrollTop();this.myPanel.render(document.body),this.center(b,c),l=$$("#border_container .outline_right_controls"),l.each(function(e){e.remove()},this),l=$$("#border_container .count"),l.each(function(e){var r=e.down().innerHTML;e.update(r),e.addClassName("count")},this),l=$$("#border_container [onclick]"),l.each(function(e){e.removeAttribute("onclick")},this);var u=$("border_container");u.observe("mousedown",this.mouseDown.bind(this)),u.observe("mousemove",this.mouseMove.bind(this)),u.observe("mouseup",this.mouseUp.bind(this)),this.addBorder=function(){var r=$$(".rubberband_dlg_element");r.each(function(e){e.hasClassName("selection_border_sides")&&(e.down().addClassName("border_sides"),e.hasClassName("selection_border_top")?e.down().addClassName("border_top"):e.down().removeClassName("border_top"),e.hasClassName("selection_border_bottom")?e.down().addClassName("border_bottom"):e.down().removeClassName("border_bottom"))}),e.adjustOverlappingBorder(),e.removeRubberband(),e.selectionMenu.cancel()},this.removeBorder=function(){var r=$$(".rubberband_dlg_element");r.each(function(e){e.hasClassName("selection_border_sides")&&(e.down().removeClassName("border_top"),e.down().removeClassName("border_sides"),e.down().removeClassName("border_bottom"))}),e.adjustOverlappingBorder(),e.removeRubberband(),e.selectionMenu.cancel()}},isDragging:!1,anchor:null,focus:null,redrawRubberband:function(e){var r=e>this.anchor?this.anchor:e,t=e<this.anchor?this.anchor:e;this.removeRubberband();var o=$$(".rubberband_dlg_element");o.each(function(e){var o=parseInt(e.down(".count").innerHTML);o===r&&e.addClassName("selection_border_top"),o>=r&&t>=o&&e.addClassName("selection_border_sides"),o===t&&e.addClassName("selection_border_bottom")}),this.focus=e},removeRubberband:function(){$$(".selection_border_top").each(function(e){e.removeClassName("selection_border_top")}),$$(".selection_border_sides").each(function(e){e.removeClassName("selection_border_sides")}),$$(".selection_border_bottom").each(function(e){e.removeClassName("selection_border_bottom")})},getCurrentElement:function(e){var r=this.getTarget(e),t=r.hasClassName("rubberband_dlg_element")?r:r.up(".rubberband_dlg_element");return void 0===t?-1:parseInt(t.down(".count").innerHTML)},getTarget:function(e){var r=$(e.originalTarget);return void 0===r&&(r=$(e.srcElement)),r},mouseDown:function(e){this.isDragging=!0,this.anchor=this.getCurrentElement(e),this.redrawRubberband(this.anchor),Event.stop(e)},mouseMove:function(e){if(this.isDragging){var r=this.getCurrentElement(e);r!==this.focus&&r>=0&&this.redrawRubberband(r)}Event.stop(e)},selectionMenu:null,mouseUp:function(e){if(this.isDragging){this.isDragging=!1;var r={page:"layout",rows:[[{button:"Add Border",callback:this.addBorder},{button:"Remove Border",callback:this.removeBorder}]]},t={this_id:"border_selection_dlg",pages:[r],body_style:"border_selection_dlg",row_style:"forum_reply_row",title:"Add Border"};this.selectionMenu=new GeneralDialog(t),this.selectionMenu.changePage("layout",null),this.selectionMenu.center()}Event.stop(e)},userCanceled:function(e){e.removeRubberband()},adjustOverlappingBorder:function(){var e=$$(".selection_border_top"),r=$$(".selection_border_bottom");if(1===e.length&&1===r.length){var t=e[0].previous();t&&t.down().hasClassName("border_sides")&&t.down().addClassName("border_bottom");var o=r[0].next();o&&o.down().hasClassName("border_sides")&&o.down().addClassName("border_top")}},handleCancel:function(){this.cancel(),this.destroy()},handleSubmit:function(){var e=$$(".border_dlg_element"),r="";e.each(function(e){r+=e.hasClassName("border_top")?"start_border,":e.hasClassName("border_sides")?"continue_border,":"no_border,"});var t=$$(".outline_tree_element_selected");if(t.length>0){var o=t[0].id;o=o.substring(o.lastIndexOf("_")+1),serverAction({action:{actions:["/builder/modify_border","/builder/redraw_exhibit_page"],els:["exhibit_builder_outline_content","exhibit_page"],params:{borders:r,element_id:o}}})}this.cancel(),this.destroy()}};