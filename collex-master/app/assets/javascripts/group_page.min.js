function stopEditGroupThumbnailUpload(e){return e.startsWith("OK:")?editGroupThumbnailDlg.fileUploadFinished(e.substring(3)):editGroupThumbnailDlg.fileUploadError(e),!0}function stopNewClusterUpload(e){return e.startsWith("OK:")?newClusterDlg.fileUploadFinished(e.substring(3)):newClusterDlg.fileUploadError(e),!0}var editGroupThumbnailDlg=null,EditGroupThumbnailDlg=Class.create({initialize:function(e,t,i){this.class_type="EditGroupThumbnailDlg";var a=this,s=null,o=function(e,i){editGroupThumbnailDlg=a;var o=i.arg0;s.setFlash("Editing "+t.toLowerCase()+" thumbnail...",!1),submitForm("layout",o)};this.fileUploadError=function(e){s.setFlash(e,!0)},this.fileUploadFinished=function(){s.setFlash(t+" thumbnail updated...",!1),reloadPage()};var n=function(){var a={page:"layout",rows:[[{text:"Choose Thumbnail:"}],[{image:"image",size:"47",klass:"edit_group_thumbnail"},{hidden:"id",value:e}],[{rowClass:"gd_last_row"},{button:"Update Thumbnail",arg0:"/"+i+"/edit_thumbnail",callback:o},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},n={this_id:"edit_group_thumbnail",pages:[a],body_style:"new_group_div",row_style:"new_exhibit_row",title:"Edit "+t+" Thumbnail"};s=new GeneralDialog(n),s.center()};n()}}),GroupNewPost=Class.create({initialize:function(e,t,i,a,s){new ForumReplyDlg({group_id:t,group_name:i,submit_url:"/forum/post_comment_to_new_thread",populate_exhibit_url:"/forum/get_exhibit_list",populate_collex_obj_url:"/forum/get_nines_obj_list",populate_topics_url:"/forum/get_all_topics",progress_img:e,logged_in:a,addTopicToLoginRedirect:!1,redirect:"/groups/"+t,license:s})}}),ClusterNewPost=Class.create({initialize:function(e,t,i,a,s,o,n,r){new ForumReplyDlg({group_id:t,group_name:i,cluster_id:a,cluster_name:s,cluster_label:o,submit_url:"/forum/post_comment_to_new_thread",populate_exhibit_url:"/forum/get_exhibit_list",populate_collex_obj_url:"/forum/get_nines_obj_list",populate_topics_url:"/forum/get_all_topics",progress_img:e,logged_in:n,addTopicToLoginRedirect:!1,redirect:"/clusters/"+a,license:r})}}),GridDlg=Class.create({initialize:function(e){this.class_type="GridDlg";var t=e.title,i=e.hidden_id,a=e.hidden_value,s=e.url,o=e.fields,n=e.data,r=e.extraCtrl,l=e.extraCtrl2,u=function(e){var t=e.element_id,i=$(t).up();$(t).remove(),i.appendChild(new Element("div",{id:t}));var a=e.fields,s=e.data,o=e.paginator_id;i=$(o).up(),$(o).remove(),i.appendChild(new Element("div",{id:o}));var n=e.highlight,r=parseInt(""+(n/10+1)),l=[];a.each(function(e){l.push({key:e,sortable:!1,resizable:!0})});var u=new YAHOO.util.DataSource(s);u.responseType=YAHOO.util.DataSource.TYPE_JSARRAY,u.responseSchema={fields:a};var c={};s.length>10&&(c.paginator=new YAHOO.widget.Paginator({rowsPerPage:10,containers:o,template:"{PreviousPageLink} <strong>{CurrentPageReport}</strong> {NextPageLink}"}));var p=new YAHOO.widget.DataTable(t,l,u,c);return c.paginator&&n&&c.paginator.setPage(r,!1),n&&p.selectRow(n),{oDS:u,oDT:p}},c=null,p=function(e,t){c.setFlash("Updating. Please wait...",!1);var i=function(){c.cancel()},a=c.getAllData(),s=t.arg0;serverAction({action:{actions:s,els:"group_details",onSuccess:i,params:a}})},d=function(){var e={page:"layout",rows:[[{text:"paginator",id:"membership_pagination",klass:"pagination"}],[{text:"grid",id:"membership_data_grid"}]]};void 0!==i&&e.rows[0].push({hidden:i,value:a}),void 0!==r&&e.rows.push(r),void 0!==l&&e.rows.push(l),e.rows.push([{rowClass:"gd_last_row"},{button:"Save",arg0:s,callback:p,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]);var d={this_id:"new_group_wizard",pages:[e],body_style:"edit_group_membership_div",row_style:"new_exhibit_row",title:t};c=new GeneralDialog(d),u({element_id:"membership_data_grid",paginator_id:"membership_pagination",fields:o,data:n}),c.center()};d()}}),EditMembershipDlg=Class.create({initialize:function(e,t,i,a,s){this.class_type="EditMembershipDlg";var o=[{Name:a,"Administrator?":"owner"}],n=[{text:"No change",value:0}];t.each(function(e){var t="editor"===e.role?' checked="true"':"";o.push({Name:e.name,"Administrator?":'<input id="group_'+e.id+'_editor" type="checkbox" value="1" name="group['+e.id+'[editor]]"'+t+"/>",Delete:'<input id="group_'+e.id+'_delete" type="checkbox" value="1" name="group['+e.id+'[delete]]"/>'}),"editor"===e.role&&n.push({text:e.name,value:e.user_id})});var r=[{text:"Show Membership List: "},{select:"show_membership",klass:"gd_select_dlg_input",options:[{text:"To All",value:"Yes"},{text:"To Admins",value:"No"}],value:i}],l=void 0;s&&n.length>1&&(l=[{text:"Change Owner: "},{select:"change_owner",klass:"gd_select_dlg_input",options:n,value:0}]),new GridDlg({title:"Edit Membership",hidden_id:"id",hidden_value:e,url:"edit_membership",fields:["Name","Administrator?","Delete"],data:o,extraCtrl:r,extraCtrl2:l})}}),RespondToRequestDlg=Class.create({initialize:function(e,t){this.class_type="RespondToRequestDlg";var i=[];t.each(function(e){i.push({Name:e.user_name,"No Action":'<input id="group_'+e.group_id+'_noaction" type="radio" value="no_action" checked="checked" name="group['+e.group_id+']"/>',Accept:'<input id="group_'+e.group_id+'_accept" type="radio" value="accept" name="group['+e.group_id+']"/>',Deny:'<input id="group_'+e.group_id+'_deny" type="radio" value="deny" name="group['+e.group_id+']"/>'})}),new GridDlg({title:"Respond",hidden_id:"id",hidden_value:e,url:"pending_requests",fields:["Name","No Action","Accept","Deny"],data:i})}}),InviteMembersDlg=Class.create({initialize:function(e,t){this.class_type="InviteMembersDlg";var i=null,a=function(e,t){i.setFlash("Sending email to invitees. Please wait...",!1);var a=function(){i.cancel()},s=function(e){var t="Some or all of your invitees have not been invited. Please check their email address and try again.<br />"+e.responseText;new MessageBoxDlg("Members Not Invited",t),i.setFlash("Error: Please try again.",!0)},o=i.getAllData(),n=t.arg0;serverAction({action:{actions:n,els:"group_details",onSuccess:a,onFailure:s,params:o}})},s=function(){var s={page:"layout",rows:[[{text:"There are two ways to invite people to join your group in "+t+": email address or username. If you know the participants' usernames, list them in the blank below, one per line.",klass:"invite_users_instructions"}],[{text:"By Username:",klass:"invite_users_label"},{textarea:"usernames",klass:"groups_textarea"}],[{rowClass:"button_row"},{button:"Submit",arg0:{method:"PUT",url:"/groups/"+e},callback:a}],[{text:"Don't know any usernames? Add email addresses of users you want to invite in the blank below, one per line.",klass:"invite_users_instructions"}],[{text:"By Email Address:",klass:"invite_users_label"},{textarea:"emails",klass:"groups_textarea"}],[{rowClass:"gd_last_row"},{button:"Submit",arg0:{method:"PUT",url:"/groups/"+e},callback:a},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},o={this_id:"invite_users_dlg",pages:[s],body_style:"invite_users_div",row_style:"new_exhibit_row",title:"Invite Users to Join",focus:"username"};i=new GeneralDialog(o),i.center()};s()}}),editDescription=function(e,t,i,a,s){var o=function(t){var a={};a[i+"[description]"]=t,serverAction({action:{actions:{method:"PUT",url:"/"+i+"s/"+e},els:i+"_details",params:a}})};new RteInputDlg({title:"Edit Description",okCallback:o,value:t,populate_urls:[a],progress_img:s})},editPermissions=function(e,t,i,a){new SelectInputDlg({title:"Change Forum Permissions",prompt:"Permissions",id:"group[forum_permissions]",options:i,explanation:a,okStr:"Save",value:t,actions:[{method:"PUT",url:"/groups/"+e}],target_els:["group_discussions"]})},changeWhichExhibitsAreShown=function(e,t,i,a,s){new SelectInputDlg({title:"Change Which "+s+"s Are Shown",prompt:"Show "+s+"s",id:"group[show_exhibits]",options:i,explanation:a,okStr:"Save",value:t,extraParams:{id:e},actions:[{method:"PUT",url:"/groups/"+e},"/groups/group_exhibits_list"],target_els:["group_details","group_exhibits"]})},editVisibility=function(e,t,i,a,s){new SelectInputDlg({title:"Change "+s+" Visibility",prompt:s+"s are ",id:"group[exhibit_visibility]",options:i,explanation:a,okStr:"Save",value:t,actions:[{method:"PUT",url:"/groups/"+e}],target_els:["group_details"]})},editType=function(e,t,i){new SelectInputDlg({title:"Edit Group Type",prompt:"Type",id:"group[group_type]",options:i,explanation:['This group is being used for scholarly collaboration. File this group under the "Community" section.','This group is being used to teach. File this group under the "Classroom" section.',"Publication groups work closely with the "+window.gFederationName+" staff to vet their content. If you select this option a notification will be sent to the "+window.gFederationName+" staff, and someone will be in contact with you soon."],okStr:"Save",value:t,actions:{method:"PUT",url:"/groups/"+e},target_els:"group_details"})},editGroupTextField=function(e,t,i,a){var s=function(e){var t=e["group["+a+"]"];return 0===t.length?"This entry cannot be blank. Please enter a value.":null};new TextInputDlg({title:"Edit "+i,prompt:i,id:"group["+a+"]",okStr:"Save",value:t,verifyFxn:s,actions:{method:"PUT",url:"/groups/"+e},target_els:"group_details"})},editTitle=function(e,t,i){new TextInputDlg({title:"Edit Title",prompt:"Title",id:i+"[name]",okStr:"Save",value:t,actions:{method:"PUT",url:"/"+i+"s/"+e},target_els:i+"_details"})},editURL=function(e,t,i,a){new TextInputDlg({title:"Edit URL",prompt:a,id:i+"[visible_url]",okStr:"Save",value:t,inputKlass:"edit_url_input",verify:"/"+i+"s/check_url",extraParams:{id:e},actions:{method:"PUT",url:"/"+i+"s/"+e},target_els:i+"_details"})},moveExhibitToCluster=function(e,t,i,a,s,o,n){new SelectInputDlg({title:"Move "+o+" to "+n,prompt:o,id:"exhibit_id",options:a,okStr:"Move",body_style:"",extraParams:{dest_cluster:i,cluster_id:i,group_id:t},actions:e,target_els:s})},changeClusterVisibility=function(e,t,i,a,s){new SelectInputDlg({title:"Change "+s+" Visibility",prompt:"Visibility",id:"cluster[visibility]",options:i,value:t,okStr:"Save",actions:e,target_els:a})},changeExhibitLabel=function(e,t,i,a,s){new SelectInputDlg({title:"Change Exhibit Label",prompt:"Label",id:"group[exhibits_label]",options:i,value:t,okStr:"Save",extraParams:s,actions:[e,"/groups/group_exhibits_list"],target_els:[a,"group_exhibits"]})},changeClusterLabel=function(e,t,i,a,s){new SelectInputDlg({title:"Change Cluster Label",prompt:"Label",id:"group[clusters_label]",options:i,value:t,okStr:"Save",extraParams:s,actions:[e,"/groups/group_exhibits_list"],target_els:[a,"group_exhibits"]})},moveExhibit=function(e,t,i,a,s){t.unshift({text:"(None)",value:"0"}),new SelectInputDlg({title:"Move "+s,prompt:"To:",id:"dest_cluster",value:a,options:t,okStr:"Save",body_style:"",extraParams:{group_id:i,cluster_id:a,exhibit_id:e},actions:["/clusters/move_exhibit"],target_els:["group_exhibits"]})},request_to_join=function(e,t){serverAction({action:{actions:"/groups/request_join",els:"group_details",params:{group_id:e,user_id:t}},progress:{waitMessage:"Request To Join Group...",completeMessage:"A request to join this group is pending acceptance by the moderator."}})},accept_invitation=function(e){serverAction({action:{actions:"/groups/accept_invitation",els:"group_details",params:{id:e}},progress:{waitMessage:"Updating Group Membership...",completeMessage:"You are now a member of this group."}})},decline_invitation=function(e){serverAction({action:{actions:"/groups/decline_invitation",els:"group_details",params:{id:e}},progress:{waitMessage:"Updating Group Membership...",completeMessage:"You have been removed from this group."}})},acceptAsPeerReviewed=function(e,t,i,a,s,o,n,r,l,u,c,p,d){t.unshift({text:"(None)",value:"0"});var g=null,_=function(t,s){var o=function(){g.cancel()},n=function(e){g.setFlash("Error: "+e.responseText,!0)},r=g.getAllData();if(r.exhibit_id=e,r["exhibit[is_published]"]="1","cluster"===r.typ&&"0"===r["exhibit[cluster_id]"])g.setFlash("Please choose a "+a+" from the list.",!0);else{var l=s.arg0;g.setFlash("Accepting "+i+". Please wait...",!1),serverAction({action:{actions:l,els:"group_exhibits",onSuccess:o,onFailure:n,params:r}})}},h={page:"layout",rows:[[{rowClass:"accept_peer_review_header"},{text:'You are about to set <a href="'+c+'" target="_blank" class="nav_link">'+s+'</a> by <a class="nav_link" href="#" onclick="showPartialInLightBox(\''+p+"', 'Profile for "+o+"', '"+d+"'); return false;\">"+o+"</a> as a peer-reviewed object."}],[{text:"This means that the work will be indexed into "+n+' and stamped with a badge of approval. If you wish to continue, please select "Accept". Otherwise, please select "Cancel."',klass:"accept_peer_review_label non_cluster_options"},{text:"This means that the work will be indexed into "+n+' and stamped with a badge of approval. If you wish to continue, please select a method for sharing this work below. Otherwise, please select "Cancel."',klass:"accept_peer_review_label hidden cluster_options"}],[{radioList:"typ",klass:"accept_peer_review_radio hidden cluster_options",value:0===r?"noncluster":"cluster",options:[{value:"noncluster",text:"I certify this "+i+" has been peer reviewed as a stand-alone object."},{value:"cluster",text:"I certify that this "+i+" has been peer reviewed as part of a "+a+" of objects."}]}],[{text:"Choose a "+a+":",klass:"accept_peer_review_label2 hidden cluster_options"},{select:"exhibit[cluster_id]",options:t,value:r,klass:"hidden cluster_options"}],[{text:'Note: Objects in <span class="accept_peer_review_group_name">'+l+'</span> have a default sharing option of "<span class="accept_peer_review_permissions">'+u+'</span>".',klass:"accept_peer_review_label"}],[{rowClass:"gd_last_row"},{button:"Accept",arg0:"/groups/accept_as_peer_reviewed",callback:_},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},m={this_id:"invite_users_dlg",pages:[h],body_style:"invite_users_div",row_style:"new_exhibit_row",title:"Accept As Peer Reviewed",focus:"username"};g=new GeneralDialog(m),t.length>1&&($$(".cluster_options").each(function(e){e.removeClassName("hidden")}),$$(".non_cluster_options").each(function(e){e.addClassName("hidden")})),g.center()},limitExhibit=function(e,t){serverAction({action:{actions:"/groups/limit_exhibit",els:"group_exhibits",params:{exhibit_id:e}},progress:{waitMessage:"Limiting Exhibit...",completeMessage:"This "+t+" can only be viewed by group members."}})},unlimitExhibit=function(e,t){serverAction({action:{actions:"/groups/unlimit_exhibit",els:"group_exhibits",params:{exhibit_id:e}},progress:{waitMessage:"Allowing Publishing...",completeMessage:"This "+t+" can be viewed by everyone."}})},hideAdmins=function(e){serverAction({action:{actions:e,els:"group_details",params:{"group[show_admins]":"members"}},progress:{waitMessage:"Hiding Admins...",completeMessage:"The administators are hidden to non-members."}})},showAdmins=function(e){serverAction({action:{actions:e,els:"group_details",params:{"group[show_admins]":"all"}},progress:{waitMessage:"Showing Admins...",completeMessage:"The administators are visible to non-members."}})},confirmDlgWithTextArea=function(e,t,i,a,s,o,n){var r=function(s,o){var r=o.dlg.getAllData();n.comment=r.comment,o.dlg.cancel(),serverAction({action:{actions:e,els:t,params:n},progress:{waitMessage:i+"...",completeMessage:a}})},l={page:"layout",rows:[[{text:s,klass:"gd_message_box_label"}],[{text:o},{textarea:"comment",klass:"confirmdlg_comment"}],[{rowClass:"gd_last_row"},{button:"Ok",callback:r,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},u={this_id:"confirm_comment_dlg",pages:[l],body_style:"gd_message_box_dlg",row_style:"gd_message_box_row",title:i},c=new GeneralDialog(u);c.center()},unpublishExhibit=function(e,t,i,a){confirmDlgWithTextArea(["/groups/unpublish_exhibit"],["group_exhibits"],"Unpublish "+a,"This "+a+' has been set to "Private".',"This option unpublishes the "+a+". A message will be sent to "+t+" at "+i+" with a short message notifying them of your action.","Add a comment to this email:",{exhibit_id:e})},rejectAsPeerReviewed=function(e,t,i,a){confirmDlgWithTextArea(["/groups/reject_as_peer_reviewed"],["group_exhibits"],"Return "+a+" For Revisions","The "+a+" has been sent back for revisions.","This option returns the "+a+" to its original contributor for revision. A message will be sent to "+t+" at "+i+" with a short message notifying them of your request.","Add a comment to this email:",{exhibit_id:e})},newClusterDlg=null,CreateNewClusterDlg=Class.create({initialize:function(e,t,i,a,s,o,n,r,l){this.class_type="CreateNewClusterDlg";var u=this,c=null,p=function(){c.setFlash("",!1);var t=c.getAllData();return 0===t["cluster[name]"].strip().length?void c.setFlash("Please enter a name for this "+l+" before continuing.",!0):(newClusterDlg=u,c.setFlash("Verifying "+l+" creation...",!1),c.getAllData(),void submitForm("layout",e))};this.fileUploadError=function(e){c.setFlash(e,!0)},this.fileUploadFinished=function(){c.setFlash(l+" created...",!1);var e=function(){c.cancel()};serverAction({action:{els:o,actions:s,params:{id:t},onSuccess:e}})};var d=function(){var s={page:"layout",rows:[[{text:"Creating New "+l+' in the Group "'+i+'"',klass:"new_exhibit_title"},{hidden:"cluster[group_id]",value:t}],[{text:"Title:",klass:"groups_label"},{input:"cluster[name]",klass:"new_exhibit_input_long"}],[{text:"Description:",klass:""}],[{textarea:"cluster[description]",klass:"groups_textarea"}],[{text:"Thumbnail:",klass:"groups_label thumbnail hidden"},{image:"image",size:"37",removeButton:"Remove Thumbnail",klass:"thumbnail hidden"}],[{rowClass:"new_cluster_radio_title"},{text:"This "+l+" should be"}],[{radioList:"cluster[visibility]",klass:"new_cluster_radio",options:[{text:"visible to everyone",value:"everyone"},{text:"visible to group members only",value:"members"},{text:"visible to group administrators only",value:"administrators"}],value:"members"}],[{rowClass:"gd_last_row"},{button:"Create "+l,arg0:e,callback:p},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},o={this_id:"new_cluster_wizard",pages:[s],body_style:"new_cluster_div",row_style:"new_exhibit_row",title:"Create New "+l,focus:"cluster_name"};c=new GeneralDialog(o),c.initTextAreas({toolbarGroups:["fontstyle","link"],linkDlgHandler:new LinkDlgHandler([n],r)}),a&&$$(".thumbnail").each(function(e){e.removeClassName("hidden")}),c.center()};d()}}),setNotificationLevel=function(e,t,i,a,s){var o=null,n=function(i,a){var s=function(){o.cancel()},n=o.getAllData();n.group_id=e;var r=a.arg0;o.setFlash("Setting Notifications for "+t+". Please wait...",!1),serverAction({action:{actions:r,els:"group_details",onSuccess:s,params:n}})},r={page:"layout",rows:[[{text:"Set the email notifications you want to receive when activity occurs in "+t+":"}],[{checkboxList:"notifications",klass:"notifications_checkbox_label",selections:i,items:[["exhibit","<span class='notifications_item'>"+a+" changes</span>: added or removed from group or "+s+", sharing level changed"],["membership","<span class='notifications_item'>Membership changes</span>: member invited, member added, member declined, member removed, member becomes admin"],["discussion","<span class='notifications_item'>Discussion changes</span>: new thread or new comment posted in this group"],["group","<span class='notifications_item'>Group changes</span>: changed name, description, add "+s+"s, remove "+s+"s, changed visibility"]]}],[{rowClass:"gd_last_row"},{button:"Save",arg0:"/groups/notifications",callback:n},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},l={this_id:"invite_users_dlg",pages:[r],body_style:"invite_users_div",row_style:"new_exhibit_row",title:"Set Notifications",focus:"username"};o=new GeneralDialog(l),o.center()};