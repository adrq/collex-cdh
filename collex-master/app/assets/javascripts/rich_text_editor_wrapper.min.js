null(function(){var e=function(){YAHOO.widget.SimpleEditor.prototype.getNumSibs=function(e){for(var t=0,i=e;i.previousSibling;)i=i.previousSibling,(3!=i.nodeType||0!=i.wholeText.trim().length)&&8!=i.nodeType&&t++;return t},YAHOO.widget.SimpleEditor.prototype.getXPathPosition=function(e){for(var t=this.getNumSibs(e),i=[],n=e;"BODY"!==n.parentNode.tagName;)n.parentNode&&i.push(this.getNumSibs(n.parentNode)),n=n.parentNode;for(var r=[],o=i.length-1;o>=0;o--)r.push(i[o]);return r.push(t),r},YAHOO.widget.SimpleEditor.prototype.checkStringForMatchingTags=function(e){for(var t=0,i=0;i<e.length-1;i++)if("<"===e[i]&&("/"===e[i+1]?t--:t++),0>t)return!1;return 0===t},YAHOO.widget.SimpleEditor.prototype.splitHtmlIntoArray=function(e){var t=e.split("<");t=t.map(function(e){return"<"+e}),"<"===t[0]?t.shift():t[0]=t[0].substring(1);for(var i=[],n=0;n<t.length;n++)if(t[n].indexOf(">")>0){var r=t[n].split(">");i.push(r[0]+">"),i.push(r[1])}else i.push(t[n]);return i},YAHOO.widget.SimpleEditor.prototype.excludeOuterTagsFromSelection=function(e,t,i){for(;"<"===e[t];)t=t+e.substring(t).indexOf(">")+1;for(;">"===e[i-1];)i=e.substring(0,i-1).lastIndexOf("<");return{aOffset:t,fOffset:i}},YAHOO.widget.SimpleEditor.prototype.canInsertTagsAroundSelection=function(e,t,i){var n=e.substring(t,i),r=this.checkStringForMatchingTags(n);if(!r){var o=this.excludeOuterTagsFromSelection(e,t,i);t=o.aOffset,i=o.fOffset,n=e.substring(t,i),r=this.checkStringForMatchingTags(n)}return r?{aOffset:t,fOffset:i,selection:n,errorMsg:null}:{errorMsg:"Please try to select something different and attempt the operation again. [Problem: You cannot create a link when the selection is over different tags.]"}},YAHOO.widget.SimpleEditor.prototype.guessSelectionEnd=function(e,t,i){var n=(i+"").length,r=e.substring(t-n,t);return r===i?t-n:(r=e.substring(t,t+n),r===i?t+n:-1)},YAHOO.widget.SimpleEditor.prototype.correctOffsetForSubstitutedText=function(e,t){if(void 0===e)return 0;var i=""+e;return i=i.substr(0,t),i=i.escapeHTML(i),i.length},YAHOO.widget.SimpleEditor.prototype.getRawSelectionPosition=function(e){if(this.browser.opera)return null;var t=null,i=this._getSelection();if(this.browser.webkit)i+""==""&&(i=null);else if(this.browser.ie){var n=i.createRange(),r=n.htmlText;t=this.getEditorHTML();var o=t.indexOf(r);if(-1!==o)return{startPos:o,endPos:o+r.length,selection:r,errorMsg:null};i.rangeCount=2}else i&&void 0!==i||(i=null),e&&""===i.toString()&&(i=null);if(null===i)return{errorMsg:"Nothing is selected."};if(1!==i.rangeCount)return{errorMsg:"You cannot create a link when more than one area is selected."};var s=i.anchorNode,l=this.correctOffsetForSubstitutedText(s.data,i.anchorOffset),a=i.focusNode,u=this.correctOffsetForSubstitutedText(a.data,i.focusOffset),d=i.toString();if("BODY"===s.tagName&&"BODY"===a.tagName){if(a.textContent===d){var p=this.getEditorHTML();return{startPos:0,endPos:p.length,selection:p,errorMsg:null}}return{errorMsg:"We're sorry. We can't figure out what you've selected. Try selecting a more than one character."}}var g="BODY"===s.tagName?null:this.getXPathPosition(s),c="BODY"===a.tagName?null:this.getXPathPosition(a);t=this.getEditorHTML().gsub("&nbsp;"," ");var h=this.splitHtmlIntoArray(t),f=-1,b=-1,v=[-1],m=0,k=!1;if(h.each(function(e){if(""!==e){if(k)return e.endsWith("-->")&&(k=!1),void(m+=e.length);if(e.startsWith("<!--")&&0==e.endsWith("-->"))return k=!0,void(m+=e.length);"<br>"===e||"<hr>"===e||e.startsWith("<meta")||e.startsWith("<!--")&&e.endsWith("-->")?v[v.length-1]++:"</"===e.substring(0,2)?v.pop():"<"===e.substring(0,1)&&"/>"===e.substring(e.length-3)?v[v.length-1]++:"<"===e.substring(0,1)?(v[v.length-1]++,v.push(-1)):e.trim().length>0&&v[v.length-1]++;var t=v.join(",");if(g&&g.join(",")===t&&(f=m+l),c&&c.join(",")===t&&(b=m+u),f>-1||b>-1)throw $break;m+=e.length}}),-1===f&&(f=this.guessSelectionEnd(t,b,d)),-1===b&&(b=this.guessSelectionEnd(t,f,d)),f>b){var y=f;f=b,b=y}var T=this.canInsertTagsAroundSelection(t,f,b);return T.errorMsg?{errorMsg:T.errorMsg}:{startPos:T.aOffset,endPos:T.fOffset,selection:T.selection,errorMsg:null}},YAHOO.widget.SimpleEditor.prototype.filter_safari=function(e){if(this.browser.webkit){e=e.replace(/<span class="Apple-tab-span" style="white-space:pre">([^>])<\/span>/gi,"&nbsp;&nbsp;&nbsp;&nbsp;"),e=e.replace(/Apple-style-span/gi,""),e=e.replace(/style="line-height: normal;"/gi,""),e=e.replace(/yui-wk-div/gi,""),e=e.replace(/yui-wk-p/gi,""),e=e.replace(/<li><\/li>/gi,""),e=e.replace(/<li> <\/li>/gi,""),e=e.replace(/<li>\s+<\/li>/gi,"");var t=e.startsWith("<div"),i=!1,n="<DROPCAPDIV>",r="</DROPCAPDIV>";if(t){var o=e.lastIndexOf("</div>");-1!==o&&(e=n+e.substring(4,o)+r+e.substring(o),i=!0)}else e=e.replace('<div class=" ">',"");this.get("ptags")?(e=e.replace(/<div([^>]*)>/g,"<p$1>"),e=e.replace(/<\/div>/gi,"</p>")):(e=e.replace(/<div([^>]*)>([ tnr]*)<\/div>/gi,"<br>"),e=e.replace(/<\/div>/gi,"")),i&&(e=e.replace(n,"<div"),e=e.replace(r,"</div>"))}return e}},t=function(){void 0===YAHOO.widget.SimpleEditor?setTimeout(t,100):e()};t()})();var RichTextEditor=Class.create({initialize:function(e){this.class_type="RichTextEditor";var t=this,i=e.id,n=e.toolbarGroups,r=e.linkDlgHandler,o=e.footnote,s=void 0,l=void 0,a=void 0,u=void 0;o&&(s=o.callback,l=e.populate_all,a=e.populate_exhibit_only,u=o.progress_img);var d=e.bodyStyle?e.bodyStyle:"",p={group:"fontstyle",label:"Font Name and Size",buttons:[{type:"select",label:"Arial",value:"fontname",disabled:!0,menu:[{text:"Arial",checked:!0},{text:"Arial Black"},{text:"Comic Sans MS"},{text:"Courier New"},{text:"Lucida Console"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Trebuchet MS"},{text:"Verdana"}]},{type:"spin",label:"13",value:"fontsize",range:[9,75],disabled:!0}]},g={group:"textstyle",label:"Font Style",buttons:[{type:"push",label:"Bold CTRL + SHIFT + B",value:"bold"},{type:"push",label:"Italic CTRL + SHIFT + I",value:"italic"},{type:"push",label:"Underline CTRL + SHIFT + U",value:"underline"},{type:"push",label:"Strike Through",value:"strikethrough"}]},c={group:"textstyle",label:"Font Style",buttons:[{type:"push",label:"Bold CTRL + SHIFT + B",value:"bold"},{type:"push",label:"Italic CTRL + SHIFT + I",value:"italic"},{type:"push",label:"Underline CTRL + SHIFT + U",value:"underline"},{type:"push",label:"Strike Through",value:"strikethrough"},{type:"push",label:"First Letter",value:"firstletter"}]},h={group:"alignment",label:"Alignment",buttons:[{type:"push",label:"Align Left CTRL + SHIFT + [",value:"justifyleft"},{type:"push",label:"Align Center CTRL + SHIFT + |",value:"justifycenter"},{type:"push",label:"Align Right CTRL + SHIFT + ]",value:"justifyright"},{type:"push",label:"Justify",value:"justifyfull"}]},f={group:"indentlist",label:"Lists",buttons:[{type:"push",label:"Create an Unordered List",value:"insertunorderedlist"},{type:"push",label:"Create an Ordered List",value:"insertorderedlist"}]},b={group:"insertitem",label:"Insert Item",buttons:[{type:"push",label:"HTML Link CTRL + SHIFT + L",value:"createlink",disabled:!0}]},v={group:"insertitem",label:"Insert Item",buttons:[{type:"push",label:"HTML Link CTRL + SHIFT + L",value:"createlink",disabled:!0},{type:"push",label:"Insert Footnote",value:"createfootnote"}]},m={type:"separator"},k=function(){var e=t.editor;e.on("toolbarLoaded",function(){this.toolbar.on("firstletterClick",function(){var e=this.getEditorHTML(),i=!e.include("drop_cap");if(i)if(e.startsWith("<div")){var n=e.substring(0,e.indexOf(">")),r=n.indexOf("class=");e=-1===r?'<div class="drop_cap" '+e.substring(4)+"</div>":e.substring(0,r+7)+"drop_cap "+e.substring(r+7)}else e="<div class='drop_cap'>"+e+"</div>";else e=e.gsub("drop_cap","");t.updateContents(e)},this,!0)})},y=function(){if(void 0!==o&&null!==o){var e=t.editor;e.on("toolbarLoaded",function(){e.toolbar.on("createfootnoteClick",function(){var i=null,n=function(n){var r=s("add",n),o=e.getEditorHTML().gsub("&nbsp;"," ");o=o.substr(0,i)+r+o.substr(i),t.updateContents(o)},r=e.getRawSelectionPosition(!1);return r?r.errorMsg?(new MessageBoxDlg("Error",r.errorMsg),!1):(i=r.endPos,new RteInputDlg({title:"Add Footnote",okCallback:n,value:"",populate_urls:[a,l],progress_img:u}),!0):(new MessageBoxDlg("Error","IE has not been implemented yet."),!1)},this,!0)},this,!0),e.on("editorContentLoaded",function(){t.initializeFootnoteEvents()},this,!0)}};this.updateContents=function(e){t.editor.setEditorHTML(e),t.initializeFootnoteEvents()},this.initializeFootnoteEvents=function(){var e=$(i+"_editor"),t=e.contentDocument;(void 0===t||null===t)&&(t=e.contentWindow.document);var n=[],r=function(e){$A(e.childNodes).each(function(e){"A"===e.nodeName&&e.className.indexOf("rte_footnote")>=0&&n.push(e),e.childNodes.length>0&&r(e)})};$A(t.childNodes).each(function(e){r(e)});var o=null,d=function(){o&&(o.remove(),o=null)},p=function(e){for(var t=0;null!==e;)t+=e.offsetLeft,e=e.offsetParent;return t},g=function(e){for(var t=0;null!==e;)t+=e.offsetTop,e=e.offsetParent;return t},c=function(t){var i=t.target;void 0===i&&(i=this),$A(i.childNodes).each(function(t){if(t.className.indexOf("tip")>=0){var n=$("gd_modal_dlg_parent"),r=p(i)+p(e.offsetParent)+20,s=g(i)+g(e.offsetParent)+20;o=new Element("div",{style:"z-index:500; border-radius: 3px; position: absolute; top:"+s+"px; left:"+r+"px; width:20em; border:1px solid #888; background-color: whitesmoke; color:#000; text-align: left; font-weight: normal; padding: .3em;"}).update(t.innerHTML),n.appendChild(o)}})},h=function(e){var t=e.target;void 0===t&&(t=this),d();var i=function(e){var i=s("edit",e);t.innerHTML=i},n=function(e,i){i.dlg.cancel(),t.parentNode.removeChild(t)},r=t.childNodes[0];new RteInputDlg({title:"Edit Footnote",okCallback:i,value:r.innerHTML,populate_urls:[a,l],progress_img:u,extraButton:{label:"Delete Footnote",callback:n}})};n.each(function(e){YAHOO.util.Event.addListener(e,"mouseover",c,null),YAHOO.util.Event.addListener(e,"mouseout",d,null),YAHOO.util.Event.addListener(e,"click",h,null)})};var T=function(){if(void 0!==r&&null!==r){var e=t.editor;e.on("editorKeyDown",function(i){var n=function(e){return e=e.gsub("<br>","").gsub("<br/>","").gsub("<br />",""),e=e.gsub(/<a(.*?)href="(.*?)"(.*?)>(.*?)<\/a>/,"#{2}#{4}"),e=e.gsub(/<span (.*?)class="ext_linklike" real_link="(.*?)"(.*?)>(.*?)<\/span>/,"#{2}#{4}"),e=e.gsub(/<span (.*?)class="nines_linklike" real_link="(.*?)"(.*?)>(.*?)<\/span>/,"#{2}#{4}\b"),e=e.gsub(/<span (.*?)real_link="(.*?)" class="ext_linklike"(.*?)>(.*?)<\/span>/,"#{2}#{4}"),e=e.gsub(/<span (.*?)real_link="(.*?)" class="nines_linklike"(.*?)>(.*?)<\/span>/,"#{2}#{4}\b"),e=e.stripTags().stripScripts().gsub("&nbsp;","").escapeHTML(),e=e.gsub("","<br/>"),e=e.gsub(/\x03(.*?)\x04(.*?)\x05/,'<span class="ext_linklike" real_link="#{1}" title="External Link: #{1}">#{2}</span>'),e=e.gsub(/\x06(.*?)\x07(.*?)\x08/,'<span class="nines_linklike" real_link="#{1}" title="NINES Link: #{1}">#{2}</span>'),e+" "},r=i.ev.ctrlKey,o=i.ev.metaKey,s=i.ev.keyCode;if(86===s&&(r||o)){var l=e.getRawSelectionPosition(!1),a=e.getEditorHTML();if(void 0===l.errorMsg){var u=a.substring(0,l.startPos),d=a.substring(l.endPos);setTimeout(function(){var i=e.getEditorHTML(),r=n(i.substring(l.startPos,i.length-d.length));t.updateContents(u+r+d)},10)}else setTimeout(function(){for(var i=e.getEditorHTML(),r=null,o=0;o<a.length&&a[o]===i[o];o++)"<"===a[o]&&(r=o),">"===a[o]&&(r=null);null!==r&&(o=r);for(var s=a.length-1,l=i.length-1;;){if(0>s||0>l)break;if(a[s]!==i[l])break;s--,l--}for(var u=l;u>0&&">"!==i[u];){if("<"===i[u]){for(;l<i.length&&">"!==i[l];)l++;break}u--}l++;var d=i.substring(0,o),p=n(i.substring(o,l)),g=i.substring(l);t.updateContents(d+p+g)},10)}return!0},this,!0),e.on("toolbarLoaded",function(){e.toolbar.on("createlinkClick",function(){var i=e.getRawSelectionPosition(!0);return i?i.errorMsg?(new MessageBoxDlg("Error",i.errorMsg),!1):(r.show(t,e.getEditorHTML(),i.startPos,i.endPos),!1):(new MessageBoxDlg("Error","IE has not been implemented yet."),!1)},this,!0)},this,!0)}};this.attachToDialog=function(e){e.showEvent.subscribe(this.editor.show,this.editor,!0),e.hideEvent.subscribe(this.editor.hide,this.editor,!0)},this.save=function(){var e=this.editor._getDoc().body;void 0!==e&&(this.editor.cleanHTML(),this.editor.saveHTML())};var O={buttonType:"advanced",draggable:!1,buttons:[]},S=!1,x=!0;n.each(function(e){switch(x||O.buttons.push(m),x=!1,e){case"font":O.buttons.push(p);break;case"fontstyle":O.buttons.push(g);break;case"dropcap":S=!0,O.buttons.push(c);break;case"alignment":O.buttons.push(h);break;case"list":O.buttons.push(f);break;case"link":O.buttons.push(b);break;case"link&footnote":O.buttons.push(v)}});var w=null!==e.width?e.width:702,L=" a.rte_footnote { background: url(/assets/rte_footnote.jpg) top right no-repeat; padding-right: 9px; cursor: pointer !important; } a.rte_footnote span { display: none; }",H=" a:link { color: #A60000 !important; text-decoration: none !important; } a:visited { color: #A60000 !important; text-decoration: none !important; } a:hover { color: #A60000 !important; text-decoration: none !important; } .nines_linklike { color: #A60000; background: url(../assets/nines/nines_link.jpg) center right no-repeat; padding-right: 13px; } .ext_linklike { color: #A60000; background: url(../assets/external_link.jpg) center right no-repeat; padding-right: 13px; }",E=' .drop_cap:first-letter {	color:#999999;	float:left;	font-family:"Bell MT","Old English",Georgia,Times,serif;	font-size:420%;	line-height:0.85em;	margin-bottom:-0.15em;	margin-right:0.08em;} .drop_cap p:first-letter {	color:#999999;	float:left;	font-family:"Bell MT","Old English",Georgia,Times,serif;	font-size:420%;	line-height:0.85em;	margin-bottom:-0.15em;	margin-right:0.08em;} ';this.editor=new YAHOO.widget.SimpleEditor(i,{width:w+"px",height:"200px",css:YAHOO.widget.SimpleEditor.prototype._defaultCSS+" "+d+L+H+E,toolbar:O,animate:!0}),S&&k(),this.editor.render(),T(),y()}});