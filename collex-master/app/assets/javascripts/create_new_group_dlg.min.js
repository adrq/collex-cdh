function stopNewGroupUpload(e){return e.startsWith("OK:")?newGroupDlg.fileUploadFinished(e.substring(3)):newGroupDlg.fileUploadError(e),!0}var newGroupDlg=null,CreateGroupWizardDlg=Class.create({initialize:function(e,s,t,o,r,a,n,i,l,u,p,_,g,c,m){this.class_type="CreateGroupWizardDlg";var h=this,d=null,b=function(e,o){var r=o.curr_page,a=o.arg0;if(d.setFlash("",!1),"group_properties"===r){var n=d.getAllData();if(0===n["group[name]"].strip().length)return d.setFlash("Please enter a name for this group before continuing.",!0),!1;if("classroom"===n["group[group_type]"]){if(0===n["group[university]"].strip().length)return d.setFlash("Please enter a university for this classroom group before continuing.",!0),!1;if(0===n["group[course_name]"].strip().length)return d.setFlash("Please enter a course name for this classroom group before continuing.",!0),!1;if(0===n["group[course_mnemonic]"].strip().length)return d.setFlash("Please enter a course mnemonic for this classroom group before continuing.",!0),!1}n["group[owner]"]=s,d.setFlash("Verifying title. Please wait...",!1);var i=function(){d.setFlash("",!1),d.changePage(a,null)};return serverRequest({url:t,params:{name:n["group[name]"].strip()},onSuccess:i}),!1}var l=null;switch(a){case"group_properties":l="group_name";break;case"invite_members":l="emails"}return d.changePage(a,l),!1},w=function(e,s){s?e.each(function(e){e.removeClassName("hidden")}):e.each(function(e){e.addClassName("hidden")})},y=function(e,s){if("classroom"===s){var t=$("group_course_name");if(0===t.value.length){var o=$("group_name"),r=o.value;t.value=r}}var a=$$(".community_only");w(a,"community"===s),a=$$(".classroom_only"),w(a,"classroom"===s),a=$$(".publication_only"),w(a,"peer-reviewed"===s)},f=function(e,s){newGroupDlg=h;var t=s.arg0;d.setFlash("Verifying group creation...",!1);var o=d.getAllData();$("emails").value=o.emails_entry,$("usernames").value=o.usernames_entry,submitForm("group_properties",t)};this.fileUploadError=function(e){d.setFlash(e,!0)},this.fileUploadFinished=function(e){d.setFlash("Group created...",!1),gotoPage(r+e)};var k=function(){var t={page:"group_properties",rows:[[{text:"Creating New Group",klass:"new_exhibit_title"},{hidden:"group[owner]",value:s},{hidden:"emails",value:""},{hidden:"usernames",value:""}],[{text:"Step 1: Group Information",klass:"new_exhibit_label"}],[{text:"Title:",klass:"groups_label"},{input:"group[name]",klass:"new_exhibit_input_long"}],[{text:"Description:",klass:""}],[{textarea:"group[description]",klass:"description groups_textarea"}],[{picture:m,klass:"new_group_membership_pic"},{text:"Show Membership:",klass:"groups_label"},{select:"group[show_membership]",options:[{text:"To All",value:"Yes"},{text:"To Admins",value:"No"}]},{text:"Choose whether visitors to your group will be able to see the membership list displayed at the upper-right of your group page.",klass:"new_group_membership_explanation"}],[{rowClass:"clear_both"},{text:"Type:",klass:"new_group_type_label"},{select:"group[group_type]",klass:"new_group_type",options:a,value:l,callback:y},{text:"The "+u+" default group type, useful for sharing objects and forum threads.",klass:"new_group_membership_explanation community_only"},{text:"Groups for using "+u+" in the classroom.",klass:"new_group_membership_explanation hidden classroom_only"},{text:"&nbsp;",klass:"new_group_membership_explanation hidden publication_only"}],[{rowClass:"clear_both"},{text:"Thumbnail:",klass:"groups_label hidden xcommunity_only"},{image:"image",size:"37",removeButton:"Remove Thumbnail",klass:"hidden xcommunity_only"},{text:"Publication groups work closely with the "+u+" staff to vet their content. If you select this option a notification will be sent to the "+u+" staff, and someone will be in contact with you soon.",klass:"new_group_membership_explanation publication_only hidden"},{text:"Course Mnemonic:",klass:"groups_label classroom_only hidden"},{text:"For easy browsing, use this field to share the course number or mnemonic associated with this class (e.g. ENNC 448).",klass:"groups_explanation classroom_only hidden"},{input:"group[course_mnemonic]",klass:"new_exhibit_input_long classroom_only hidden"}],[{text:"Course Name (if different from Group Title):",klass:"classroom_only hidden"},{input:"group[course_name]",klass:"new_exhibit_input_long classroom_only hidden"}],[{text:"University:",klass:"groups_label classroom_only hidden"},{autocomplete:"group[university]",klass:"new_exhibit_autocomplete classroom_only hidden",url:e}],[{rowClass:"gd_last_row"},{button:"Next",arg0:"invite_members",callback:b},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},r={page:"invite_members",rows:[[{text:"Creating New Group",klass:"new_exhibit_title"}],[{text:"Step 2: Invite people to your group.",klass:"new_exhibit_label"}],[{text:"There are two ways to invite people to join your group in "+u+": email address or username. If you know the participants' usernames, list them in the blank below, one per line.",klass:"invite_users_instructions"}],[{text:"By Username:",klass:"invite_users_label"},{textarea:"usernames_entry",klass:"groups_textarea"}],[{text:"Don't know any usernames? Add email addresses of users you want to invite in the blank below, one per line.",klass:"invite_users_instructions"}],[{text:"By Email Address:",klass:"invite_users_label"},{textarea:"emails_entry",klass:"groups_textarea"}],[{rowClass:"gd_last_row"},{button:"Create Group",arg0:o,callback:f},{button:"Previous",arg0:"group_properties",callback:b},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},n=[t,r],i={this_id:"invite_users_dlg",pages:n,body_style:"invite_users_div",row_style:"new_exhibit_row",title:"New Group Wizard"};d=new GeneralDialog(i),b(null,{curr_page:"",arg0:"group_properties",dlg:d}),d.initTextAreas({onlyClass:"description",toolbarGroups:["fontstyle","link"],linkDlgHandler:new LinkDlgHandler([p],_)}),y("group[group_type]",l),d.center()};k()}});