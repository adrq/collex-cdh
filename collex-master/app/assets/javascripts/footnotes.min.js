var FootnoteAbbrev=Class.create({initialize:function(t){var e=t.startingValue,n=t.field,s=t.populate_all,o=t.populate_exhibit_only,a=t.progress_img,i=null,l=function(t,e,s,o){var a=new Element("a",{id:n+"_"+t,title:e,onclick:"return false;",href:"#"});return a.addClassName(o),s&&a.addClassName("hidden"),a},r=function(){if(e.length>0){$(n+"_add").addClassName("hidden"),$(n+"_edit").removeClassName("hidden"),$(n+"_remove").removeClassName("hidden");var t=$$("."+i)[0];t.removeClassName("hidden"),t.down(".tip").innerHTML=e.stripTags()}else $(n+"_add").removeClassName("hidden"),$(n+"_edit").addClassName("hidden"),$(n+"_remove").addClassName("hidden"),$$("."+i)[0].addClassName("hidden")},d=function(t){e=t,r()},u=function(){return new RteInputDlg({title:"Add Footnote",okCallback:d,value:e,populate_urls:[o,s],progress_img:a}),!1},p=function(){return new RteInputDlg({title:"Edit Footnote",okCallback:d,value:e,populate_urls:[o,s],progress_img:a}),!1},c=null;this.deleteCallback=function(t){c=t};var f=function(){return e="",r(),c&&c(n),!1};this.getMarkup=function(){var t=new Element("div");return t.addClassName("footnote_abbrev_div"),t.appendChild(l("add","Add Footnote",e.length>0,"footnote_button")),t.appendChild(l("edit","Edit Footnote",0===e.length,"footnote_button")),t.appendChild(l("remove","Delete Footnote",0===e.length,"footnote_delete_button")),t},this.getSelection=function(){return{field:n,value:e}},this.delayedSetup=function(){YAHOO.util.Event.addListener(n+"_add","click",u,null),YAHOO.util.Event.addListener(n+"_edit","click",p,null),YAHOO.util.Event.addListener(n+"_remove","click",f,null)},this.createEditButton=function(t){return i=t,e.length>0?{link:"*<span class='tip'>"+e.stripTags()+"</span>",klass:t+" footnote_tip",callback:p}:{link:"*<span class='tip'></span>",klass:t+" footnote_tip hidden",callback:p}}}}),FootnotesInRte=Class.create({initialize:function(){var t='<a href="#" onclick=\'return false; var footnote = $(this).next(); new MessageBoxDlg("Footnote", footnote.innerHTML); return false;\' class="superscript">',e='<a href="#" onclick=\'return false; var footnote = $(this).next(); new MessageBoxDlg("Footnote", footnote.innerHTML); return false;\' class="superscript">',n='<A class=superscript onclick=\'return false; var footnote = $(this).next(); new MessageBoxDlg("Footnote", footnote.innerHTML); return false;\' href="#">',s='</a><span class="hidden">',o="</A><SPAN class=hidden>",a='<a href="#" onclick="return false; var footnote = $(this).next(); new MessageBoxDlg(&quot;Footnote&quot;, footnote.innerHTML); return false;" class="superscript">',i="</span>",l='<a class="rte_footnote">',r="<span>",d='</span><span class="tip"><span class="footnote_edit_hover">Click this footnote to edit</span>',u="</a>",p="</span>",c=function(t){return r+t+d+t.stripTags().truncate(40)+p},f=function(t){return l+c(t)+u},h=function(t){for(var e=t.split("<"),n="",s=0,o=0;o<e.length;o++)if(e[o].startsWith("span")||e[o].startsWith("SPAN"))s++,n+="<"+e[o];else if(e[o].startsWith("/span")||e[o].startsWith("/SPAN")){if(s--,-1===s)break;n+="<"+e[o]}else n+="<"+e[o];n=n.substr(1);for(var a=e[o].substr(6),i=o+1;i<e.length;i++)a+="<"+e[i];return{left:n,right:a}};this.preprocessFootnotes=function(i){var l=i.split(t);1===l.length&&(l=i.split(e)),1===l.length&&(l=i.split(n)),1===l.length&&(l=i.split(a)),i=l[0];for(var r=1;r<l.length;r++){var d=l[r].split(s);1===d.length&&(d=l[r].split(o));var u=h(d[1]),p=u.left,c=u.right;i+=f(p)+c}return i},this.postprocessFootnotes=function(e){var n=e.split(l+r);e=n[0];for(var o=1;o<n.length;o++){var a=n[o].split('</span><span class="tip">'),d=a[0],u=a[1].indexOf("</a>")+4,p=a[1].substr(u);e+=t+"@"+s+d+i+p}return e},this.addFootnote=function(t,e){return 0===e.length&&(e=" "),"add"===t?f(e):"edit"===t?c(e):""}}});