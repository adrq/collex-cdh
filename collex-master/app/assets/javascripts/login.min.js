var SignInDlg=Class.create({initialize:function(){this.class_type="SignInDlg";var a="",e="";this.changeView=function(a,e){var l=e.arg0,n=e.dlg,s=null;switch(l){case"sign_in":s="signin_username";break;case"create_account":s="create_username";break;case"account_help":s="help_username"}return n.changePage(l,s),!1},this.sendWithAjax=function(a,l){var n=l.arg0,s=l.dlg,i=s.getAllData(),t=function(a){s.setFlash(a.responseText,!1),""===e?reloadPage():gotoPage(e)};serverRequest({url:n,params:i,onSuccess:t,dlg:s})},this.setInitialMessage=function(e){a=e},this.setRedirectPage=function(a){e=a},this.setRedirectPageToCurrentWithParam=function(a){var l=""+window.location,n="";l.indexOf("#")>0&&(n=l.substring(l.indexOf("#")),l=l.substring(0,l.indexOf("#"))),l+=l.indexOf("?")>0?"&":"?",l+=a,e=l+n},this.show=function(e){var l={page:"sign_in",rows:[[{text:"Log in",klass:"login_title"}],[{text:"User name:",klass:"login_label"}],[{input:"signin_username",klass:"login_input"}],[{text:"Password:",klass:"login_label"}],[{password:"signin_password",klass:"login_input"}],[{button:"Log in",arg0:window.site_path+"/login/verify_login",callback:this.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}],[{text:"",klass:"login_label"}],[{link:"Create a new account",klass:"nav_link",arg0:"create_account",callback:this.changeView}],[{link:"Forgot user name or password?",klass:"nav_link",arg0:"account_help",callback:this.changeView}]]},n={page:"account_help",rows:[[{text:"I forgot my password.",klass:"login_title"}],[{text:"Enter your user name and we will email a new password to your email account on file.",klass:"login_instructions"}],[{text:"User name:",klass:"login_label"}],[{input:"help_username",klass:"login_input"}],[{button:"Submit",arg0:window.site_path+"/login/reset_password",callback:this.sendWithAjax},{button:"Cancel",callback:GeneralDialog.cancelCallback}],[{text:"",klass:"login_label"}],[{text:"",klass:"login_label"}],[{text:"I forgot my user name.",klass:"login_title"}],[{text:"Enter your email address and we will email you your user name.",klass:"login_instructions"}],[{text:"E-mail address:",klass:"login_label"}],[{input:"help_email",klass:"login_input"}],[{button:"Submit",arg0:"/login/recover_username",callback:this.sendWithAjax},{button:"Cancel",callback:GeneralDialog.cancelCallback}],[{text:"",klass:"login_label"}],[{link:"Create a new account",klass:"nav_link",arg0:"create_account",callback:this.changeView}],[{link:"Log in",klass:"nav_link",arg0:"sign_in",callback:this.changeView}]]},s={page:"create_account",rows:[[{text:"Create a New Account",klass:"login_title"}],[{text:"User name:",klass:"login_label"}],[{input:"create_username",klass:"login_input"}],[{text:"E-mail address:",klass:"login_label"}],[{input:"create_email",klass:"login_input"}],[{text:"Password:",klass:"login_label"}],[{password:"create_password",klass:"login_input"}],[{text:"Re-type password:",klass:"login_label"}],[{password:"create_password2",klass:"login_input"}],[{button:"Sign up",arg0:window.site_path+"/login/submit_signup",callback:this.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}],[{link:"Log in",klass:"nav_link",arg0:"sign_in",callback:this.changeView}]]},i=[l,n,s],t={this_id:"login_dlg",pages:i,flash_notice:a,body_style:"login_div",row_style:"login_row"},o=new GeneralDialog(t);this.changeView(null,{curr_page:"",arg0:e,dlg:o}),o.center()}}}),RedirectIfLoggedIn=Class.create({initialize:function(a,e,l){if(this.class_type="RedirectIfLoggedIn",l)gotoPage(a);else{var n=new SignInDlg;n.setInitialMessage(e),n.setRedirectPage(a),n.show("sign_in")}}});