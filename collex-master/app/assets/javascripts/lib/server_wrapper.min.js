function submitForm(e,t,n){var a=function(e){var t=$$("meta[name=csrf-param]")[0].content,n=$$("meta[name=csrf-token]")[0].content;e.appendChild(new Element("input",{id:t,type:"hidden",name:t,value:n}))},o=$(e);"PUT"===n&&o.appendChild(new Element("input",{id:"_method",type:"hidden",name:"_method",value:"PUT"})),(void 0===n||"PUT"===n)&&(n="POST"),o.writeAttribute({action:t,method:n}),a(o),o.submit()}function reloadPage(){window.location.href=window.location.href}function gotoPage(e){window.location=e}function openInNewWindow(e,t){window.open(t.arg0,"_blank")}function submitFormWithConfirmation(e){var t=e.id,n=e.action,a=e.method?e.method:"POST",o=e.title,i=e.message,r=e.okStr?e.okStr:"Yes",s=e.cancelStr?e.cancelStr:"No",l=function(){submitForm(t,n,a)};new ConfirmDlg(o,i,r,s,l)}function formatFailureMsg(e,t){return 500===e.status?"Sorry! You've hit an error. We apologize for this problem and hope you'll bear with us as we work to make this website better! System administrators have been automatically notified of the error. If you have additional feedback, please e-mail us.":404===e.status?"Sorry! The server didn't understand the request \""+t+'". Either a bad URL was given or there is an internal error. If you think this message is in error, please email the administrators.':0===e.status?"Communication with the server has been temporarily interrupted. Please try again later.":e.responseText}Ajax.Responders.register({onCreate:function(e){var t=$$("meta[name=csrf-token]")[0];if(t){var n="X-CSRF-Token",a=t.readAttribute("content");e.options.requestHeaders||(e.options.requestHeaders={}),e.options.requestHeaders[n]=a}}});var postLink=function(e,t,n){if(window.mockSubmit)window.mockSubmit(e,t,n);else{var a=document.createElement("form");a.style.display="none",document.body.appendChild(a),a.method="POST",a.action=e,n&&(a.target=n);var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","_method"),o.setAttribute("value","post"),a.appendChild(o);var i=$$("meta[name=csrf-param]")[0].content,r=$$("meta[name=csrf-token]")[0].content;a.appendChild(new Element("input",{id:i,type:"hidden",name:i,value:r})),t&&$H(t).each(function(e){"string"==typeof e.value?a.appendChild(new Element("input",{type:"hidden",name:e.key,value:e.value,id:e.key})):"number"==typeof e.value?a.appendChild(new Element("input",{type:"hidden",name:e.key,value:""+e.value,id:e.key})):$H(e.value).each(function(t){a.appendChild(new Element("input",{type:"hidden",name:e.key+"["+t.key+"]",value:t.value,id:t.key}))})}),a.submit()}},ConfirmDlg=Class.create({initialize:function(e,t,n,a,o){this.ok=function(e,t){t.dlg.cancel(),o()};var i={page:"layout",rows:[[{rowClass:"gd_confirm_msg_row"},{text:t,klass:"gd_confirm_label"}],[{rowClass:"gd_last_row"},{button:n,callback:this.ok,isDefault:!0},{button:a,callback:GeneralDialog.cancelCallback}]]},r={this_id:"gd_confirm_dlg",pages:[i],body_style:"gd_confirm_dlg",row_style:"gd_confirm_row",title:e},s=new GeneralDialog(r);s.center()}}),serverAction=function(e){var t=e.confirm,n=e.action,a=e.progress,o=(e.searching,function(e,t){var a=null,i=function(t){var n=$$("meta[name=csrf-param]")[0].content,o=$$("meta[name=csrf-token]")[0].content,i=t.params;if("string"!=typeof a&&(i=Object.clone(i),i._method=a.method,a=a.url),"string"==typeof i?i+=0===i.length?"?"+n+"="+encodeURIComponent(o):"&"+n+"="+encodeURIComponent(o):void 0===i[n]&&(i[n]=o),void 0===t.el||null!==t.el&&0!==t.el.length){var r=function(e){jQuery.ajax({url:e.action,type:"POST",data:e.params,success:function(t,n,a){var o=$(e.el);o&&o.update(a.responseText),e.onSuccess&&e.onSuccess(a)},error:function(t){e.onFailure?e.onFailure(t):genericAjaxFail(e.dlg,t,e.action)}})};r({action:a,params:i,el:t.el,onSuccess:t.onSuccess,dlg:t.dlg,onFailure:t.onFailure})}else if("GET"===i._method){var s=a,l=[];for(var c in i)i.hasOwnProperty(c)&&c!==n&&"_method"!==c&&l.push(c+"="+encodeURI(i[c]));l.length>0&&(s+=s.indexOf("?")>-1?"&":"?",s+=l.join("&")),gotoPage(s)}else postLink(a,i,e.target)};void 0===e.params&&(e.params={});var r=e.actions,s=e.els,l=e.onSuccess,c=e.onFailure,u=e.params;if("string"==typeof r?r=r.split(","):Object.isArray(r)||(r=[r]),"string"==typeof s&&(s=s.split(",")),0===r.length)return void(l&&l(t));a=r.shift();var d=s?s.shift():null,m={action:a,el:d,onSuccess:function(t){o({actions:r,els:s,target:n.target,onSuccess:l,dlg:e.dlg,onFailure:c,params:u},t)},dlg:e.dlg,onFailure:c,params:u};i(m)}),i=n.onSuccess,r=function(e){a&&(window.cancelProgressDialog(),void 0!==a.completeMessage&&new MessageBoxDlg("Success",a.completeMessage)),i&&i(e)},s=function(e){a&&window.cancelProgressDialog(),n.onFailure?n.onFailure(e):genericAjaxFail(n.dlg,e,n.actions)},l=function(){a&&window.showProgressDialog(a.waitMessage),n.actions?o({actions:n.actions,els:n.els,target:n.target,onSuccess:r,dlg:n.dlg,onFailure:s,params:n.params}):r()};if(t){var c=t.cancelLabel;void 0===c&&(c="No");var u=t.okLabel;void 0===u&&(u="Yes"),new ConfirmDlg(t.title,t.message,u,c,l)}else l()},serverNotify=function(e,t){serverAction({action:{actions:e,els:"gd_bit_bucket",params:t}})},serverRequest=function(e){serverAction({action:{actions:e.url,els:"gd_bit_bucket",params:e.params,onSuccess:e.onSuccess,onFailure:e.onFailure,dlg:e.dlg}})};