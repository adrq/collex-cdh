var StartDiscussionWithExhibit=Class.create({initialize:function(e,t,i,s,a,n,l,r,o,c){this.class_type="StartDiscussionWithExhibit";var u=null;if(!n){var _=new SignInDlg;return _.setInitialMessage("Please log in to start a discussion"),_.setRedirectPageToCurrentWithParam("script=StartDiscussionWithExhibit"),void _.show("sign_in")}var p=function(){var t=function(e){var t=[];u.setFlash("",!1);try{e.responseText.length>0&&(t=e.responseText.evalJSON(!0))}catch(i){new MessageBoxDlg("Error",i)}var s=$$(".discussion_topic_select"),a=s[0];a.update(""),t=t.sortBy(function(e){return e.text}),t.each(function(e){a.appendChild(new Element("option",{value:e.value}).update(e.text))}),$("topic_id").writeAttribute("value",t[0].value)};serverRequest({url:e,onSuccess:t})};this.sendWithAjax=function(e,t){var s=t.arg0,n=t.dlg;n.setFlash("Updating Discussion Topics...",!1);var l=n.getAllData();l.inet_thumbnail="",l.thread_id="",l.group_id=o,l.cluster_id=c,l.nines_exhibit=i,l.nines_object="",l.inet_url="",l.inet_title="",l.disc_type="NINES Exhibit";var r=function(e){$(a).hide(),n.cancel(),gotoPage(e.responseText)};serverRequest({url:s,params:l,onSuccess:r})};var d=new ForumLicenseDisplay({populateLicenses:"/exhibits/get_licenses?non_sharing=false",currentLicense:5,id:"license_list"}),h={page:"start_discussion",rows:[[{text:"Starting a discussion of: "+s,klass:"new_exhibit_label"}],[{custom:d,klass:"forum_reply_license title"},{text:"Select the topic you want this discussion to appear under:",klass:"new_exhibit_label"}],[{select:"topic_id",klass:"discussion_topic_select",options:[{value:-1,text:"Loading topics. Please Wait..."}]}],[{text:"Title",klass:"forum_reply_label title "}],[{input:"title",klass:"forum_reply_input title"}],[{textarea:"description"}],[{rowClass:"gd_last_row"},{button:"Ok",arg0:t,callback:this.sendWithAjax,isDefault:!0},{button:"Cancel",callback:GeneralDialog.cancelCallback}]]},g={this_id:"start_discussion_with_object_dlg",pages:[h],body_style:"forum_reply_dlg",row_style:"new_exhibit_row",title:"Start Discussion",focus:"start_discussion_with_object_dlg_sel0"};u=new GeneralDialog(g),u.initTextAreas({toolbarGroups:["fontstyle","link"],linkDlgHandler:new LinkDlgHandler([l],r)}),d.populate(u),u.center(),p(u)}});