<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class ForumController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/forum_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-delete_comment">#delete_comment</a>
    
    <li><a href="#method-i-edit_existing_comment">#edit_existing_comment</a>
    
    <li><a href="#method-i-get_all_topics">#get_all_topics</a>
    
    <li><a href="#method-i-get_exhibit_list">#get_exhibit_list</a>
    
    <li><a href="#method-i-get_nines_obj_list">#get_nines_obj_list</a>
    
    <li><a href="#method-i-get_nines_obj_list_with_image">#get_nines_obj_list_with_image</a>
    
    <li><a href="#method-i-get_object_details">#get_object_details</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-object">#object</a>
    
    <li><a href="#method-i-post_comment_to_existing_thread">#post_comment_to_existing_thread</a>
    
    <li><a href="#method-i-post_comment_to_new_thread">#post_comment_to_new_thread</a>
    
    <li><a href="#method-i-post_object_to_new_thread">#post_object_to_new_thread</a>
    
    <li><a href="#method-i-report_comment">#report_comment</a>
    
    <li><a href="#method-i-result_count">#result_count</a>
    
    <li><a href="#method-i-rss">#rss</a>
    
    <li><a href="#method-i-sort_by_date">#sort_by_date</a>
    
    <li><a href="#method-i-sort_by_topic">#sort_by_topic</a>
    
    <li><a href="#method-i-view_thread">#view_thread</a>
    
    <li><a href="#method-i-view_topic">#view_topic</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Typewright.html">Typewright</a>
  
    <li><a href="./Typewright/AdminController.html">Typewright::AdminController</a>
  
    <li><a href="./Typewright/Document.html">Typewright::Document</a>
  
    <li><a href="./Typewright/DocumentUser.html">Typewright::DocumentUser</a>
  
    <li><a href="./Typewright/DocumentUsersController.html">Typewright::DocumentUsersController</a>
  
    <li><a href="./Typewright/DocumentsController.html">Typewright::DocumentsController</a>
  
    <li><a href="./Typewright/Line.html">Typewright::Line</a>
  
    <li><a href="./Typewright/LinesController.html">Typewright::LinesController</a>
  
    <li><a href="./Typewright/Overview.html">Typewright::Overview</a>
  
    <li><a href="./Typewright/OverviewsController.html">Typewright::OverviewsController</a>
  
    <li><a href="./Typewright/OverviewsHelper.html">Typewright::OverviewsHelper</a>
  
    <li><a href="./Typewright/SoapController.html">Typewright::SoapController</a>
  
    <li><a href="./Typewright/TwFeaturedObject.html">Typewright::TwFeaturedObject</a>
  
    <li><a href="./Typewright/TypewrightHelper.html">Typewright::TypewrightHelper</a>
  
    <li><a href="./Typewright/User.html">Typewright::User</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/BaseController.html">Admin::BaseController</a>
  
    <li><a href="./Admin/DefaultController.html">Admin::DefaultController</a>
  
    <li><a href="./Admin/DefaultHelper.html">Admin::DefaultHelper</a>
  
    <li><a href="./Admin/DefaultHelper/Session.html">Admin::DefaultHelper::Session</a>
  
    <li><a href="./Admin/DiscussionTopicsController.html">Admin::DiscussionTopicsController</a>
  
    <li><a href="./Admin/DiscussionTopicsHelper.html">Admin::DiscussionTopicsHelper</a>
  
    <li><a href="./Admin/FeaturesController.html">Admin::FeaturesController</a>
  
    <li><a href="./Admin/FeaturesHelper.html">Admin::FeaturesHelper</a>
  
    <li><a href="./Admin/SetupsController.html">Admin::SetupsController</a>
  
    <li><a href="./Admin/SetupsHelper.html">Admin::SetupsHelper</a>
  
    <li><a href="./Admin/SiteHelper.html">Admin::SiteHelper</a>
  
    <li><a href="./Admin/UserRolesController.html">Admin::UserRolesController</a>
  
    <li><a href="./Admin/UserRolesHelper.html">Admin::UserRolesHelper</a>
  
    <li><a href="./Catalog.html">Catalog</a>
  
    <li><a href="./Catalog/Error.html">Catalog::Error</a>
  
    <li><a href="./GroupsController.html">GroupsController</a>
  
    <li><a href="./GroupsController/RolesUser.html">GroupsController::RolesUser</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Branding.html">Branding</a>
  
    <li><a href="./BuilderController.html">BuilderController</a>
  
    <li><a href="./BuilderHelper.html">BuilderHelper</a>
  
    <li><a href="./CachedProperty.html">CachedProperty</a>
  
    <li><a href="./CachedResource.html">CachedResource</a>
  
    <li><a href="./CharSetAlter.html">CharSetAlter</a>
  
    <li><a href="./ClassroomController.html">ClassroomController</a>
  
    <li><a href="./ClassroomHelper.html">ClassroomHelper</a>
  
    <li><a href="./Cluster.html">Cluster</a>
  
    <li><a href="./ClustersController.html">ClustersController</a>
  
    <li><a href="./CollectedItem.html">CollectedItem</a>
  
    <li><a href="./CommentReport.html">CommentReport</a>
  
    <li><a href="./CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="./CommunitiesHelper.html">CommunitiesHelper</a>
  
    <li><a href="./Constraint.html">Constraint</a>
  
    <li><a href="./DiscussionComment.html">DiscussionComment</a>
  
    <li><a href="./DiscussionThread.html">DiscussionThread</a>
  
    <li><a href="./DiscussionThreadsHelper.html">DiscussionThreadsHelper</a>
  
    <li><a href="./DiscussionTopic.html">DiscussionTopic</a>
  
    <li><a href="./DiscussionVisit.html">DiscussionVisit</a>
  
    <li><a href="./DocumentCompleteMailer.html">DocumentCompleteMailer</a>
  
    <li><a href="./Exhibit.html">Exhibit</a>
  
    <li><a href="./ExhibitElement.html">ExhibitElement</a>
  
    <li><a href="./ExhibitElementsController.html">ExhibitElementsController</a>
  
    <li><a href="./ExhibitElementsHelper.html">ExhibitElementsHelper</a>
  
    <li><a href="./ExhibitFootnote.html">ExhibitFootnote</a>
  
    <li><a href="./ExhibitIllustration.html">ExhibitIllustration</a>
  
    <li><a href="./ExhibitIllustrationsController.html">ExhibitIllustrationsController</a>
  
    <li><a href="./ExhibitObject.html">ExhibitObject</a>
  
    <li><a href="./ExhibitPage.html">ExhibitPage</a>
  
    <li><a href="./ExhibitPagesController.html">ExhibitPagesController</a>
  
    <li><a href="./ExhibitsController.html">ExhibitsController</a>
  
    <li><a href="./ExpressionConstraint.html">ExpressionConstraint</a>
  
    <li><a href="./FacetConstraint.html">FacetConstraint</a>
  
    <li><a href="./FeaturedObject.html">FeaturedObject</a>
  
    <li><a href="./FederationConstraint.html">FederationConstraint</a>
  
    <li><a href="./ForumController.html">ForumController</a>
  
    <li><a href="./FreeCultureConstraint.html">FreeCultureConstraint</a>
  
    <li><a href="./FullTextConstraint.html">FullTextConstraint</a>
  
    <li><a href="./GenericMailer.html">GenericMailer</a>
  
    <li><a href="./GetIncludeFileList.html">GetIncludeFileList</a>
  
    <li><a href="./Group.html">Group</a>
  
    <li><a href="./GroupsHelper.html">GroupsHelper</a>
  
    <li><a href="./GroupsUser.html">GroupsUser</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./Image.html">Image</a>
  
    <li><a href="./ImageFull.html">ImageFull</a>
  
    <li><a href="./IsoLanguage.html">IsoLanguage</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LoginHelper.html">LoginHelper</a>
  
    <li><a href="./LoginInfo.html">LoginInfo</a>
  
    <li><a href="./MyCollexController.html">MyCollexController</a>
  
    <li><a href="./MyCollexHelper.html">MyCollexHelper</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./ObjectActivity.html">ObjectActivity</a>
  
    <li><a href="./PeerReview.html">PeerReview</a>
  
    <li><a href="./PublicationImage.html">PublicationImage</a>
  
    <li><a href="./PublicationsController.html">PublicationsController</a>
  
    <li><a href="./PublicationsHelper.html">PublicationsHelper</a>
  
    <li><a href="./ResultsController.html">ResultsController</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./SavedSearchConstraint.html">SavedSearchConstraint</a>
  
    <li><a href="./Search.html">Search</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SearchUserContent.html">SearchUserContent</a>
  
    <li><a href="./Session.html">Session</a>
  
    <li><a href="./Setup.html">Setup</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagController.html">TagController</a>
  
    <li><a href="./TagHelper.html">TagHelper</a>
  
    <li><a href="./Tagassign.html">Tagassign</a>
  
    <li><a href="./TestJsController.html">TestJsController</a>
  
    <li><a href="./TestJsHelper.html">TestJsHelper</a>
  
    <li><a href="./TypeWrightConstraint.html">TypeWrightConstraint</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsernameAlreadyExistsException.html">UsernameAlreadyExistsException</a>
  
    <li><a href="./VicConference.html">VicConference</a>
  
    <li><a href="./VicConferenceController.html">VicConferenceController</a>
  
    <li><a href="./WebUtils.html">WebUtils</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ForumController</h1>

  <div id="description" class="description">
    
<p>Copyright 2009 Applied Research in Patacriticism and the University of
Virginia</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not
use this file except in compliance with the License. You may obtain a copy
of the License at</p>

<pre>http://www.apache.org/licenses/LICENSE-2.0</pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="MAX_ITEMS_PER_PAGE">MAX_ITEMS_PER_PAGE
        
        <dd class="description">
        
      
        <dt id="MIN_ITEMS_PER_PAGE">MIN_ITEMS_PER_PAGE
        
        <dd class="description"><p>Number of search results to display by default</p>
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-delete_comment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_comment</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete_comment-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 472</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_comment</span>
  <span class="ruby-identifier">thread_id</span> = <span class="ruby-value">-1</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_signed_in?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'You must be signed in to delete a comment.'</span>
  <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">thread_id</span> = <span class="ruby-constant">DiscussionComment</span>.<span class="ruby-identifier">delete_comment</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>], <span class="ruby-identifier">current_user</span>, <span class="ruby-identifier">is_admin?</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">thread_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">-1</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:index</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:view_thread</span>, <span class="ruby-value">:thread</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">thread_id</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_comment-source -->
          
        </div>

        

        
      </div><!-- delete_comment-method -->

    
      <div id="method-i-edit_existing_comment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_existing_comment</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_existing_comment-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_existing_comment</span>
  <span class="ruby-identifier">comment_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:comment_id</span>]
  <span class="ruby-identifier">inet_thumbnail</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:inet_thumbnail</span>]
  <span class="ruby-identifier">inet_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:inet_url</span>]
  <span class="ruby-identifier">inet_title</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:inet_title</span>]
  <span class="ruby-identifier">nines_object</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:nines_obj_list</span>]
  <span class="ruby-identifier">nines_exhibit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:exhibit_list</span>]
  <span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reply</span>]
  <span class="ruby-identifier">disc_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:obj_type</span>]
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>]
  <span class="ruby-identifier">license</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:license_list</span>]
  <span class="ruby-identifier">can_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:can_delete</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'true'</span>
  
  <span class="ruby-identifier">comment</span> = <span class="ruby-constant">DiscussionComment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">comment_id</span>)
  <span class="ruby-comment"># If an attachment was not selected, but the type expected an attachment, just change the type to regular comment</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">disc_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'mycollection'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">nines_object</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">disc_type</span> = <span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">disc_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'exhibit'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">nines_exhibit</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">disc_type</span> = <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">disc_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:comment_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'comment'</span>, <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>, <span class="ruby-value">:user_modified_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">disc_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'mycollection'</span>
    <span class="ruby-identifier">cr</span> = <span class="ruby-constant">CachedResource</span>.<span class="ruby-identifier">find_by_uri</span>(<span class="ruby-identifier">nines_object</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cr</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>  <span class="ruby-comment"># if the object hadn't been collected, let's just go ahead an collect it</span>
      <span class="ruby-identifier">cr</span> = <span class="ruby-constant">CollectedItem</span>.<span class="ruby-identifier">collect_item</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">nines_object</span>, <span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:comment_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'nines_object'</span>, <span class="ruby-value">:cached_resource_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cr</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>, <span class="ruby-value">:user_modified_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">disc_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'exhibit'</span>
    <span class="ruby-identifier">a</span> = <span class="ruby-identifier">nines_exhibit</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'_'</span>)
    <span class="ruby-identifier">exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>])
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:comment_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'nines_exhibit'</span>, <span class="ruby-value">:exhibit_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>, <span class="ruby-value">:user_modified_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">disc_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'weblink'</span>
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:comment_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'inet_object'</span>, <span class="ruby-value">:link_title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">inet_title</span>, <span class="ruby-value">:link_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">inet_url</span>, <span class="ruby-value">:image_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">inet_thumbnail</span>, <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>, <span class="ruby-value">:user_modified_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">position</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">thread</span> = <span class="ruby-constant">DiscussionThread</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">comment</span>.<span class="ruby-identifier">discussion_thread_id</span>)
    <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:license</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">license</span>.<span class="ruby-identifier">to_i</span>)
    <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'comment'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>, <span class="ruby-value">:thread_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">discussion_thread_id</span>, <span class="ruby-value">:can_delete</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">can_delete</span>, <span class="ruby-value">:can_edit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:is_main</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">position</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_existing_comment-source -->
          
        </div>

        

        
      </div><!-- edit_existing_comment-method -->

    
      <div id="method-i-get_all_topics" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_topics</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_all_topics-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 560</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_all_topics</span>
  <span class="ruby-identifier">ret</span> = []
  <span class="ruby-comment"># this returns a json object of all the topics and their ids</span>
  <span class="ruby-identifier">topics</span> = <span class="ruby-constant">DiscussionTopic</span>.<span class="ruby-identifier">all</span>
  <span class="ruby-identifier">topics</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">topic</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">topic</span> })
  }
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">to_json</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_all_topics-source -->
          
        </div>

        

        
      </div><!-- get_all_topics-method -->

    
      <div id="method-i-get_exhibit_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_exhibit_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_exhibit_list-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_exhibit_list</span>
  <span class="ruby-comment"># This is called through ajax and wants a json object back.</span>
  <span class="ruby-identifier">exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">get_all_published</span>()
  <span class="ruby-identifier">ret</span> = []
  <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exhibit</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">obj</span> = {}
    <span class="ruby-identifier">obj</span>[<span class="ruby-value">:id</span>] = <span class="ruby-node">&quot;id_#{exhibit.id}&quot;</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-value">:img</span>] = <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">thumbnail</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-value">:img</span>] = <span class="ruby-identifier">view_context</span>.<span class="ruby-identifier">image_path</span>(<span class="ruby-constant">DEFAULT_THUMBNAIL_IMAGE_PATH</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">:img</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">:img</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-value">:title</span>] = <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">title</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-value">:strFirstLine</span>] = <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">title</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-value">:strSecondLine</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">obj</span>)
  }
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">to_json</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_exhibit_list-source -->
          
        </div>

        

        
      </div><!-- get_exhibit_list-method -->

    
      <div id="method-i-get_nines_obj_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_nines_obj_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_nines_obj_list-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 276</span>
        <span class="ruby-keyword">def</span> <span class="ruby-identifier">get_nines_obj_list</span>
                <span class="ruby-comment"># This returns a json object with an array of hits.</span>
                <span class="ruby-comment"># The hits might be all the objects that have been collected by the current user, or</span>
                <span class="ruby-comment"># all the objects that are in a particular exhibit.</span>
                <span class="ruby-comment"># If illustration_id is passed, then the exhibit_id is figured out from it.</span>
                <span class="ruby-comment"># If exhibit_id is passed, then that is used to limit the objects to only those in the exhibit.</span>
                <span class="ruby-comment"># If is is not passed, then all of the user's collected objects are returned.</span>
                <span class="ruby-comment"># Except, if only_images is passed, then items without a thumbnail are skipped.</span>
                <span class="ruby-identifier">only_images</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:only_images</span>]
                <span class="ruby-identifier">ret</span> = []
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_signed_in?</span>
                        <span class="ruby-comment"># if an element id is passed, then only the objects that are in that exhibit are returned.</span>
                        <span class="ruby-identifier">illustration_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:illustration_id</span>]
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration_id</span>
                                <span class="ruby-identifier">illustration</span> = <span class="ruby-constant">ExhibitIllustration</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">illustration_id</span>)
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>
                                        <span class="ruby-identifier">element_id</span> = <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">exhibit_element_id</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">element_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:element_id</span>]
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">element_id</span>
                                <span class="ruby-identifier">element</span> = <span class="ruby-constant">ExhibitElement</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">element_id</span>)
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>
                                        <span class="ruby-identifier">page</span> = <span class="ruby-constant">ExhibitPage</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_page_id</span>)
                                        <span class="ruby-identifier">exhibit_id</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_id</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">exhibit_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:exhibit_id</span>]
                        <span class="ruby-keyword">end</span>
                        
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit_id</span>
                                <span class="ruby-identifier">exhibits_objects</span> = <span class="ruby-constant">ExhibitObject</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">exhibit_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">exhibit_id</span>})
                                <span class="ruby-comment"># TODO-PER: There is probably a cleaner way to do this, just convert a list of URI to cached_resource_id</span>
                                <span class="ruby-comment">#objs = []</span>
                                <span class="ruby-identifier">exhibits_objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">eo</span><span class="ruby-operator">|</span>
                                        <span class="ruby-identifier">cr</span> = <span class="ruby-constant">CachedResource</span>.<span class="ruby-identifier">find_by_uri</span>(<span class="ruby-identifier">eo</span>[<span class="ruby-value">:uri</span>])
<span class="ruby-comment">#                                       o = CollectedItem.new</span>
<span class="ruby-comment">#                                       o.cached_resource_id = cr.id</span>
<span class="ruby-comment">#                                       objs.push(o)</span>
<span class="ruby-comment">#                                       objs.each {|obj|</span>
                                                <span class="ruby-identifier">hit</span> = <span class="ruby-constant">CachedResource</span>.<span class="ruby-identifier">get_hit_from_resource_id</span>(<span class="ruby-identifier">cr</span>.<span class="ruby-identifier">id</span>)
                                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">hit</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                                                        <span class="ruby-identifier">image</span> = <span class="ruby-constant">CachedResource</span>.<span class="ruby-identifier">get_thumbnail_from_hit</span>(<span class="ruby-identifier">hit</span>)
                                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_images</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">true</span>
                                                                <span class="ruby-identifier">image</span> = <span class="ruby-identifier">view_context</span>.<span class="ruby-identifier">image_path</span>(<span class="ruby-constant">DEFAULT_THUMBNAIL_IMAGE_PATH</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">image</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">image</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                                                        <span class="ruby-keyword">end</span>
                                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">image</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">image</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                                                <span class="ruby-identifier">obj</span> = {}
                                                                <span class="ruby-identifier">obj</span>[<span class="ruby-value">:id</span>] = <span class="ruby-identifier">hit</span>[<span class="ruby-string">'uri'</span>]
                                                                <span class="ruby-identifier">obj</span>[<span class="ruby-value">:img</span>] = <span class="ruby-identifier">image</span>
                                                                <span class="ruby-identifier">obj</span>[<span class="ruby-value">:title</span>] = <span class="ruby-identifier">hit</span>[<span class="ruby-string">'title'</span>]
                                                                <span class="ruby-identifier">obj</span>[<span class="ruby-value">:strFirstLine</span>] = <span class="ruby-identifier">hit</span>[<span class="ruby-string">'title'</span>]
                                                                <span class="ruby-identifier">obj</span>[<span class="ruby-value">:strSecondLine</span>] = <span class="ruby-identifier">hit</span>[<span class="ruby-string">'role_AUT'</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">'role_AUT'</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">', '</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">'role_ART'</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">'role_ART'</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">', '</span>) <span class="ruby-operator">:</span> <span class="ruby-string">''</span>
                                                                <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">obj</span>)
                                                        <span class="ruby-keyword">end</span>
                                                <span class="ruby-keyword">end</span>
<span class="ruby-comment">#                                       }</span>
                                }
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">all_collected</span> = <span class="ruby-constant">CollectedItem</span>.<span class="ruby-identifier">get_collected_objects</span>(<span class="ruby-identifier">get_curr_user_id</span>)
                                <span class="ruby-identifier">all_collected</span>.<span class="ruby-identifier">each</span>  { <span class="ruby-operator">|</span><span class="ruby-identifier">uri</span>,<span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
                                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">only_images</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">col</span>[<span class="ruby-string">'thumbnail'</span>]
                                                <span class="ruby-identifier">image</span> = <span class="ruby-constant">CachedResource</span>.<span class="ruby-identifier">get_thumbnail_from_hit</span>(<span class="ruby-identifier">col</span>)
                                                <span class="ruby-identifier">image</span> = <span class="ruby-identifier">view_context</span>.<span class="ruby-identifier">image_path</span>(<span class="ruby-constant">DEFAULT_THUMBNAIL_IMAGE_PATH</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">image</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">image</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                                                <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">uri</span>, <span class="ruby-value">:img</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">image</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">col</span>[<span class="ruby-string">'title'</span>], <span class="ruby-value">:strFirstLine</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">col</span>[<span class="ruby-string">'title'</span>], <span class="ruby-value">:strSecondLine</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">col</span>[<span class="ruby-string">'author'</span>] })
                                        <span class="ruby-keyword">end</span>
                                }
                        <span class="ruby-keyword">end</span>

                        <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">to_json</span>()
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Your session has expired. Please log in again.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span></pre>
          </div><!-- get_nines_obj_list-source -->
          
        </div>

        

        
      </div><!-- get_nines_obj_list-method -->

    
      <div id="method-i-get_nines_obj_list_with_image" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_nines_obj_list_with_image</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_nines_obj_list_with_image-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 352</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_nines_obj_list_with_image</span>
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:only_images</span>] = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">get_nines_obj_list</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_nines_obj_list_with_image-source -->
          
        </div>

        

        
      </div><!-- get_nines_obj_list_with_image-method -->

    
      <div id="method-i-get_object_details" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_object_details</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_object_details-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 267</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_object_details</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uri</span>]
                      <span class="ruby-identifier">hit</span> = <span class="ruby-constant">CachedResource</span>.<span class="ruby-identifier">get_hit_from_uri</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:uri</span>])
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'/results/result_row_for_popup'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:hit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>, <span class="ruby-value">:extra_button_data</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:partial</span>], <span class="ruby-value">:index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:index</span>], <span class="ruby-value">:target_el</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:target_el</span>]} }
              <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'We\re sorry! We can\t find the object that you requested. Reason: internal error (incorrect parameters). Please contact the #{Setup.site_name()} webmaster using the email at the bottom of the page'</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
              <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_object_details-source -->
          
        </div>

        

        
      </div><!-- get_object_details-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 536</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>]
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>]
      <span class="ruby-ivar">@script</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>]
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:discussion_topic_sort</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">'date'</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-object" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">object</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="object-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">object</span>     <span class="ruby-comment"># called from RSS</span>
        <span class="ruby-identifier">id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-identifier">comment</span> = <span class="ruby-constant">DiscussionComment</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'forum'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'view_thread'</span>, <span class="ruby-value">:thread</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">discussion_thread_id</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bad Request&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bad Request&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- object-source -->
          
        </div>

        

        
      </div><!-- object-method -->

    
      <div id="method-i-post_comment_to_existing_thread" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post_comment_to_existing_thread</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="post_comment_to_existing_thread-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_comment_to_existing_thread</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_signed_in?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'You must be signed in to reply to a thread.'</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
  <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">params</span>[<span class="ruby-value">:reply</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reply</span>].<span class="ruby-identifier">strip</span>()
                      <span class="ruby-identifier">err_msg</span> = <span class="ruby-identifier">has_body</span>(<span class="ruby-identifier">params</span>)
                      <span class="ruby-keyword">if</span> <span class="ruby-identifier">err_msg</span>
                              <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err_msg</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">create_comment</span>(<span class="ruby-identifier">params</span>, <span class="ruby-value">:existing</span>)
                              <span class="ruby-identifier">retrieve_thread</span>({ <span class="ruby-value">:thread</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:thread_id</span>], <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'-1'</span> })
                              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@thread</span>
                                      <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'replies'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:total</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@total</span>, <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@page</span>, <span class="ruby-value">:replies</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@replies</span>, <span class="ruby-value">:num_pages</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@num_pages</span>, <span class="ruby-value">:thread</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@thread</span> }
                              <span class="ruby-keyword">else</span>
                                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Sorry! This thread no longer exists.'</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                              <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- post_comment_to_existing_thread-source -->
          
        </div>

        

        
      </div><!-- post_comment_to_existing_thread-method -->

    
      <div id="method-i-post_comment_to_new_thread" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post_comment_to_new_thread</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="post_comment_to_new_thread-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_comment_to_new_thread</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_signed_in?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'You must be signed in to start a discussion.'</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
  <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>].<span class="ruby-identifier">strip</span>()
                      <span class="ruby-identifier">params</span>[<span class="ruby-value">:reply</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reply</span>].<span class="ruby-identifier">strip</span>()
                      <span class="ruby-identifier">err_msg</span> = <span class="ruby-identifier">has_title</span>(<span class="ruby-identifier">params</span>)
                      <span class="ruby-identifier">err_msg</span> = <span class="ruby-identifier">has_body</span>(<span class="ruby-identifier">params</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>

                      <span class="ruby-keyword">if</span> <span class="ruby-identifier">err_msg</span>
                              <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err_msg</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">rec</span> = { <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>], <span class="ruby-value">:license</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:license_list</span>], <span class="ruby-value">:discussion_topic_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:topic_id</span>] }
                              <span class="ruby-identifier">rec</span>[<span class="ruby-value">:group_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                              <span class="ruby-identifier">rec</span>[<span class="ruby-value">:cluster_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                              <span class="ruby-identifier">thread</span> = <span class="ruby-constant">DiscussionThread</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">rec</span>)

                              <span class="ruby-identifier">params</span>[<span class="ruby-value">:thread_id</span>] = <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">id</span>
                              <span class="ruby-identifier">create_comment</span>(<span class="ruby-identifier">params</span>, <span class="ruby-value">:new</span>)

                  <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:index</span>
                      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- post_comment_to_new_thread-source -->
          
        </div>

        

        
      </div><!-- post_comment_to_new_thread-method -->

    
      <div id="method-i-post_object_to_new_thread" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post_object_to_new_thread</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="post_object_to_new_thread-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 220</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_object_to_new_thread</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_signed_in?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:topic_id</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_method</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'POST'</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'You must be signed in to start a discussion.'</span>
        <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:back</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># There are two records that must be updated to create the new thread. If the second record</span>
    <span class="ruby-comment"># isn't created, then we need to back off the first one.</span>
    <span class="ruby-identifier">topic_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:topic_id</span>]
        <span class="ruby-identifier">topic_id</span> = <span class="ruby-constant">DiscussionTopic</span>.<span class="ruby-identifier">first</span>().<span class="ruby-identifier">id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:topic_id</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:topic_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">license</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:license_list</span>]
                      <span class="ruby-identifier">rec</span> = { <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>], <span class="ruby-value">:license</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">license</span>, <span class="ruby-value">:discussion_topic_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">topic_id</span> }
                      <span class="ruby-identifier">rec</span>[<span class="ruby-value">:group_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                      <span class="ruby-identifier">rec</span>[<span class="ruby-value">:cluster_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">thread</span> = <span class="ruby-constant">DiscussionThread</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">rec</span>)

    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">post_object</span>(<span class="ruby-identifier">thread</span>, <span class="ruby-identifier">params</span>, <span class="ruby-value">:new</span>)
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">destroy</span>() <span class="ruby-keyword">if</span> <span class="ruby-identifier">thread</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;We're sorry. An error occurred when attempting to start the discussion thread.&quot;</span>
    <span class="ruby-keyword">end</span>

              <span class="ruby-comment"># now tell the caller where the post landed so they can go there.</span>
              <span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">MIN_ITEMS_PER_PAGE</span>
              <span class="ruby-identifier">threads</span> = <span class="ruby-constant">DiscussionTopic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">topic_id</span>).<span class="ruby-identifier">discussion_threads</span>
              <span class="ruby-comment">#num_pages = threads.length.quo(session[:items_per_page]).ceil</span>
              <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;/forum/view_topic?page=1&amp;topic=#{topic_id}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- post_object_to_new_thread-source -->
          
        </div>

        

        
      </div><!-- post_object_to_new_thread-method -->

    
      <div id="method-i-report_comment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">report_comment</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="report_comment-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 487</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">report_comment</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_signed_in?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'You must be signed in to report a comment.'</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">comment_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;comment_id&quot;</span>]
    <span class="ruby-identifier">reason</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'reason'</span>]
    <span class="ruby-identifier">can_edit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'can_edit'</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'true'</span>
    <span class="ruby-identifier">can_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'can_delete'</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'true'</span>
    <span class="ruby-identifier">is_main</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'is_main'</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'true'</span>
    <span class="ruby-identifier">comment</span> = <span class="ruby-constant">DiscussionComment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">comment_id</span>)
                      <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">has_been_reported_by</span>(<span class="ruby-identifier">get_curr_user_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
                              <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">add_reporter</span>(<span class="ruby-identifier">get_curr_user_id</span>, <span class="ruby-identifier">reason</span>)
                              <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">save</span>
                              <span class="ruby-keyword">begin</span>
                                <span class="ruby-identifier">admins</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">get_administrators</span>
                                <span class="ruby-identifier">admins</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">admin</span> <span class="ruby-operator">|</span>
                                              <span class="ruby-identifier">body</span> = <span class="ruby-node">&quot;A comment by #{User.find(comment.user_id).fullname} has been reported by #{get_curr_user_name}. The text of the message is:\n\n&quot;</span>
                                              <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;#{self.class.helpers.strip_tags(comment.comment)}\n\n&quot;</span>
                                              <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;The reason for this report is:\n\n#{reason}&quot;</span>
                                              <span class="ruby-constant">GenericMailer</span>.<span class="ruby-identifier">generic</span>(<span class="ruby-constant">Setup</span>.<span class="ruby-identifier">site_name</span>(), <span class="ruby-constant">Setup</span>.<span class="ruby-identifier">return_email</span>(), <span class="ruby-identifier">admin</span>.<span class="ruby-identifier">fullname</span>, <span class="ruby-identifier">admin</span>.<span class="ruby-identifier">email</span>,
                                                <span class="ruby-string">&quot;Comment Abuse Reported&quot;</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>), <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">deliver</span>
                                      <span class="ruby-keyword">end</span>
                              <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">msg</span>
                                      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-string">&quot;**** ERROR: Can't send email: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">message</span>)
                              <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'comment'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>, <span class="ruby-value">:can_edit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">can_edit</span>, <span class="ruby-value">:can_delete</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">can_delete</span>, <span class="ruby-value">:is_main</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">is_main</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- report_comment-source -->
          
        </div>

        

        
      </div><!-- report_comment-method -->

    
      <div id="method-i-result_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">result_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="result_count-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 529</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">result_count</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">MIN_ITEMS_PER_PAGE</span>
  <span class="ruby-identifier">requested_items_per_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'search'</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">'search'</span>][<span class="ruby-string">'result_count'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>] 
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>] = (<span class="ruby-identifier">requested_items_per_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">MAX_ITEMS_PER_PAGE</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">requested_items_per_page</span> <span class="ruby-operator">:</span> <span class="ruby-constant">MAX_ITEMS_PER_PAGE</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:back</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- result_count-source -->
          
        </div>

        

        
      </div><!-- result_count-method -->

    
      <div id="method-i-rss" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rss</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="rss-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 517</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rss</span>
               <span class="ruby-keyword">if</span> <span class="ruby-constant">DISALLOW_RSS</span>
                       <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'RSS disabled for this installation'</span>
                       <span class="ruby-keyword">return</span>
               <span class="ruby-keyword">end</span>
   <span class="ruby-identifier">thread_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:thread</span>]
   <span class="ruby-identifier">thread</span> = <span class="ruby-constant">DiscussionThread</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">thread_id</span>)
   
   <span class="ruby-comment">#@items = [ { :title =&gt; 'first', :description =&gt; 'this is the first'}, { :title =&gt; 'second', :description =&gt; 'another entry' } ]</span>
   <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'rss'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:thread</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">thread</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- rss-source -->
          
        </div>

        

        
      </div><!-- rss-method -->

    
      <div id="method-i-sort_by_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sort_by_date</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="sort_by_date-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sort_by_date</span>
   <span class="ruby-identifier">session</span>[<span class="ruby-value">:discussion_topic_sort</span>] = <span class="ruby-string">'date'</span>
   <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:back</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sort_by_date-source -->
          
        </div>

        

        
      </div><!-- sort_by_date-method -->

    
      <div id="method-i-sort_by_topic" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sort_by_topic</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="sort_by_topic-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 550</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sort_by_topic</span>
   <span class="ruby-identifier">session</span>[<span class="ruby-value">:discussion_topic_sort</span>] = <span class="ruby-string">'topic'</span>
   <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:back</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sort_by_topic-source -->
          
        </div>

        

        
      </div><!-- sort_by_topic-method -->

    
      <div id="method-i-view_thread" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">view_thread</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="view_thread-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 416</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">view_thread</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>]
                      <span class="ruby-identifier">session</span>[<span class="ruby-value">:uri</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:uri</span>]
                      <span class="ruby-identifier">session</span>[<span class="ruby-value">:row_num</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:row_num</span>]
                      <span class="ruby-identifier">session</span>[<span class="ruby-value">:row_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:row_id</span>]
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:uri</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:row_num</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:row_id</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>]
      <span class="ruby-ivar">@script</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>]
                              <span class="ruby-ivar">@uri</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:uri</span>]
                              <span class="ruby-ivar">@row_num</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:row_num</span>]
                              <span class="ruby-ivar">@row_id</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:row_id</span>]

      <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>] = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:uri</span>] = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:row_num</span>] = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:row_id</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">retrieve_thread</span>(<span class="ruby-identifier">params</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@thread</span>
                <span class="ruby-identifier">num_views</span> = <span class="ruby-ivar">@thread</span>.<span class="ruby-identifier">number_of_views</span>
                <span class="ruby-identifier">num_views</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">num_views</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-identifier">num_views</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                <span class="ruby-ivar">@thread</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:number_of_views</span>, <span class="ruby-identifier">num_views</span>)
                              <span class="ruby-constant">DiscussionVisit</span>.<span class="ruby-identifier">visited</span>(<span class="ruby-ivar">@thread</span>, <span class="ruby-identifier">current_user</span>)
                              <span class="ruby-ivar">@subtitle</span> = <span class="ruby-node">&quot; : #{@thread.get_title()}&quot;</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-comment"># the thread has disappeared</span>
                <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'forum'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>
        <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- view_thread-source -->
          
        </div>

        

        
      </div><!-- view_thread-method -->

    
      <div id="method-i-view_topic" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">view_topic</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="view_topic-source">
            <pre><span class="ruby-comment"># File app/controllers/forum_controller.rb, line 389</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">view_topic</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>]
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:script</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>]
      <span class="ruby-ivar">@script</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>]
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:script</span>] = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">MIN_ITEMS_PER_PAGE</span>
    <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>
    <span class="ruby-ivar">@topic</span> = <span class="ruby-constant">DiscussionTopic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:topic</span>])
    <span class="ruby-ivar">@threads</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">discussion_threads</span>
    <span class="ruby-ivar">@threads</span> = <span class="ruby-constant">DiscussionThread</span>.<span class="ruby-identifier">sort_by_time</span>(<span class="ruby-ivar">@threads</span>)
                      <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">get_curr_user_id</span>()
                      <span class="ruby-ivar">@threads</span> = <span class="ruby-ivar">@threads</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">thread</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-constant">Group</span>.<span class="ruby-identifier">can_read</span>(<span class="ruby-identifier">thread</span>, <span class="ruby-identifier">user_id</span>) }

    <span class="ruby-ivar">@total</span> = <span class="ruby-ivar">@threads</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-ivar">@num_pages</span> = <span class="ruby-ivar">@total</span>.<span class="ruby-identifier">quo</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>]).<span class="ruby-identifier">ceil</span>
    <span class="ruby-ivar">@page</span> = <span class="ruby-ivar">@num_pages</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@page</span> <span class="ruby-operator">==</span> <span class="ruby-value">-1</span>
    <span class="ruby-ivar">@page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@page</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">start</span> = (<span class="ruby-ivar">@page</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>) * <span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>]
    <span class="ruby-ivar">@threads</span> = <span class="ruby-ivar">@threads</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-identifier">start</span>,<span class="ruby-identifier">session</span>[<span class="ruby-value">:items_per_page</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- view_topic-source -->
          
        </div>

        

        
      </div><!-- view_topic-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

