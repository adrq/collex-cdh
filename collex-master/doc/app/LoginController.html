<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class LoginController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/login_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-get_page_to_return_to">#get_page_to_return_to</a>
    
    <li><a href="#method-i-init_view_options">#init_view_options</a>
    
    <li><a href="#method-i-login_controls">#login_controls</a>
    
    <li><a href="#method-i-logout">#logout</a>
    
    <li><a href="#method-i-recover_username">#recover_username</a>
    
    <li><a href="#method-i-reset_password">#reset_password</a>
    
    <li><a href="#method-i-submit_signup">#submit_signup</a>
    
    <li><a href="#method-i-verify_login">#verify_login</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Typewright.html">Typewright</a>
  
    <li><a href="./Typewright/AdminController.html">Typewright::AdminController</a>
  
    <li><a href="./Typewright/Document.html">Typewright::Document</a>
  
    <li><a href="./Typewright/DocumentUser.html">Typewright::DocumentUser</a>
  
    <li><a href="./Typewright/DocumentUsersController.html">Typewright::DocumentUsersController</a>
  
    <li><a href="./Typewright/DocumentsController.html">Typewright::DocumentsController</a>
  
    <li><a href="./Typewright/Line.html">Typewright::Line</a>
  
    <li><a href="./Typewright/LinesController.html">Typewright::LinesController</a>
  
    <li><a href="./Typewright/Overview.html">Typewright::Overview</a>
  
    <li><a href="./Typewright/OverviewsController.html">Typewright::OverviewsController</a>
  
    <li><a href="./Typewright/OverviewsHelper.html">Typewright::OverviewsHelper</a>
  
    <li><a href="./Typewright/SoapController.html">Typewright::SoapController</a>
  
    <li><a href="./Typewright/TwFeaturedObject.html">Typewright::TwFeaturedObject</a>
  
    <li><a href="./Typewright/TypewrightHelper.html">Typewright::TypewrightHelper</a>
  
    <li><a href="./Typewright/User.html">Typewright::User</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/BaseController.html">Admin::BaseController</a>
  
    <li><a href="./Admin/DefaultController.html">Admin::DefaultController</a>
  
    <li><a href="./Admin/DefaultHelper.html">Admin::DefaultHelper</a>
  
    <li><a href="./Admin/DefaultHelper/Session.html">Admin::DefaultHelper::Session</a>
  
    <li><a href="./Admin/DiscussionTopicsController.html">Admin::DiscussionTopicsController</a>
  
    <li><a href="./Admin/DiscussionTopicsHelper.html">Admin::DiscussionTopicsHelper</a>
  
    <li><a href="./Admin/FeaturesController.html">Admin::FeaturesController</a>
  
    <li><a href="./Admin/FeaturesHelper.html">Admin::FeaturesHelper</a>
  
    <li><a href="./Admin/SetupsController.html">Admin::SetupsController</a>
  
    <li><a href="./Admin/SetupsHelper.html">Admin::SetupsHelper</a>
  
    <li><a href="./Admin/SiteHelper.html">Admin::SiteHelper</a>
  
    <li><a href="./Admin/UserRolesController.html">Admin::UserRolesController</a>
  
    <li><a href="./Admin/UserRolesHelper.html">Admin::UserRolesHelper</a>
  
    <li><a href="./Catalog.html">Catalog</a>
  
    <li><a href="./Catalog/Error.html">Catalog::Error</a>
  
    <li><a href="./GroupsController.html">GroupsController</a>
  
    <li><a href="./GroupsController/RolesUser.html">GroupsController::RolesUser</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Branding.html">Branding</a>
  
    <li><a href="./BuilderController.html">BuilderController</a>
  
    <li><a href="./BuilderHelper.html">BuilderHelper</a>
  
    <li><a href="./CachedProperty.html">CachedProperty</a>
  
    <li><a href="./CachedResource.html">CachedResource</a>
  
    <li><a href="./CharSetAlter.html">CharSetAlter</a>
  
    <li><a href="./ClassroomController.html">ClassroomController</a>
  
    <li><a href="./ClassroomHelper.html">ClassroomHelper</a>
  
    <li><a href="./Cluster.html">Cluster</a>
  
    <li><a href="./ClustersController.html">ClustersController</a>
  
    <li><a href="./CollectedItem.html">CollectedItem</a>
  
    <li><a href="./CommentReport.html">CommentReport</a>
  
    <li><a href="./CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="./CommunitiesHelper.html">CommunitiesHelper</a>
  
    <li><a href="./Constraint.html">Constraint</a>
  
    <li><a href="./DiscussionComment.html">DiscussionComment</a>
  
    <li><a href="./DiscussionThread.html">DiscussionThread</a>
  
    <li><a href="./DiscussionThreadsHelper.html">DiscussionThreadsHelper</a>
  
    <li><a href="./DiscussionTopic.html">DiscussionTopic</a>
  
    <li><a href="./DiscussionVisit.html">DiscussionVisit</a>
  
    <li><a href="./DocumentCompleteMailer.html">DocumentCompleteMailer</a>
  
    <li><a href="./Exhibit.html">Exhibit</a>
  
    <li><a href="./ExhibitElement.html">ExhibitElement</a>
  
    <li><a href="./ExhibitElementsController.html">ExhibitElementsController</a>
  
    <li><a href="./ExhibitElementsHelper.html">ExhibitElementsHelper</a>
  
    <li><a href="./ExhibitFootnote.html">ExhibitFootnote</a>
  
    <li><a href="./ExhibitIllustration.html">ExhibitIllustration</a>
  
    <li><a href="./ExhibitIllustrationsController.html">ExhibitIllustrationsController</a>
  
    <li><a href="./ExhibitObject.html">ExhibitObject</a>
  
    <li><a href="./ExhibitPage.html">ExhibitPage</a>
  
    <li><a href="./ExhibitPagesController.html">ExhibitPagesController</a>
  
    <li><a href="./ExhibitsController.html">ExhibitsController</a>
  
    <li><a href="./ExpressionConstraint.html">ExpressionConstraint</a>
  
    <li><a href="./FacetConstraint.html">FacetConstraint</a>
  
    <li><a href="./FeaturedObject.html">FeaturedObject</a>
  
    <li><a href="./FederationConstraint.html">FederationConstraint</a>
  
    <li><a href="./ForumController.html">ForumController</a>
  
    <li><a href="./FreeCultureConstraint.html">FreeCultureConstraint</a>
  
    <li><a href="./FullTextConstraint.html">FullTextConstraint</a>
  
    <li><a href="./GenericMailer.html">GenericMailer</a>
  
    <li><a href="./GetIncludeFileList.html">GetIncludeFileList</a>
  
    <li><a href="./Group.html">Group</a>
  
    <li><a href="./GroupsHelper.html">GroupsHelper</a>
  
    <li><a href="./GroupsUser.html">GroupsUser</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./Image.html">Image</a>
  
    <li><a href="./ImageFull.html">ImageFull</a>
  
    <li><a href="./IsoLanguage.html">IsoLanguage</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LoginHelper.html">LoginHelper</a>
  
    <li><a href="./LoginInfo.html">LoginInfo</a>
  
    <li><a href="./MyCollexController.html">MyCollexController</a>
  
    <li><a href="./MyCollexHelper.html">MyCollexHelper</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./ObjectActivity.html">ObjectActivity</a>
  
    <li><a href="./PeerReview.html">PeerReview</a>
  
    <li><a href="./PublicationImage.html">PublicationImage</a>
  
    <li><a href="./PublicationsController.html">PublicationsController</a>
  
    <li><a href="./PublicationsHelper.html">PublicationsHelper</a>
  
    <li><a href="./ResultsController.html">ResultsController</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./SavedSearchConstraint.html">SavedSearchConstraint</a>
  
    <li><a href="./Search.html">Search</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SearchUserContent.html">SearchUserContent</a>
  
    <li><a href="./Session.html">Session</a>
  
    <li><a href="./Setup.html">Setup</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagController.html">TagController</a>
  
    <li><a href="./TagHelper.html">TagHelper</a>
  
    <li><a href="./Tagassign.html">Tagassign</a>
  
    <li><a href="./TestJsController.html">TestJsController</a>
  
    <li><a href="./TestJsHelper.html">TestJsHelper</a>
  
    <li><a href="./TypeWrightConstraint.html">TypeWrightConstraint</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsernameAlreadyExistsException.html">UsernameAlreadyExistsException</a>
  
    <li><a href="./VicConference.html">VicConference</a>
  
    <li><a href="./VicConferenceController.html">VicConferenceController</a>
  
    <li><a href="./WebUtils.html">WebUtils</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class LoginController</h1>

  <div id="description" class="description">
    
<p>Copyright 2007 Applied Research in Patacriticism and the University of
Virginia</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not
use this file except in compliance with the License. You may obtain a copy
of the License at</p>

<pre>http://www.apache.org/licenses/LICENSE-2.0</pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-get_page_to_return_to" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_page_to_return_to</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_page_to_return_to-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_page_to_return_to</span>()
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp">/login/</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;/&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_page_to_return_to-source -->
          
        </div>

        

        
      </div><!-- get_page_to_return_to-method -->

    
      <div id="method-i-init_view_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">init_view_options</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="init_view_options-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">init_view_options</span> <span class="ruby-comment"># This controls how the layout portion of the page looks.</span>
  <span class="ruby-ivar">@site_section</span> = <span class="ruby-value">:login</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- init_view_options-source -->
          
        </div>

        

        
      </div><!-- init_view_options-method -->

    
      <div id="method-i-login_controls" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">login_controls</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="login_controls-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">login_controls</span>  <span class="ruby-comment"># This is called by html pages using ajax to render the login controls</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'/common/login_slider'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:current_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'about'</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- login_controls-source -->
          
        </div>

        

        
      </div><!-- login_controls-method -->

    
      <div id="method-i-logout" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">logout</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="logout-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 57</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">logout</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_signed_in?</span>
              <span class="ruby-constant">LoginInfo</span>.<span class="ruby-identifier">record_logout</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">username</span>)
              <span class="ruby-identifier">set_current_user</span>(<span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">get_page_to_return_to</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- logout-source -->
          
        </div>

        

        
      </div><!-- logout-method -->

    
      <div id="method-i-recover_username" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recover_username</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="recover_username-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">recover_username</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:help_email</span>] <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:help_email</span>].<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                      <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:help_email</span>])
                      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                              <span class="ruby-keyword">begin</span>
                                      <span class="ruby-identifier">body</span> = <span class="ruby-node">&quot;Here is your #{Setup.site_name()} user name:\n\n&quot;</span>
                                      <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;  #{@user[:username]}\n\n&quot;</span>
                                      <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;To log in, visit this link:\n\n&quot;</span>
                                      <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    #{url_for :controller =&gt; 'home', :action =&gt; 'index', :only_path =&gt; false}\n\n&quot;</span>
                                      <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;Click \&quot;Log In\&quot; at the top right corner of the page and enter your username and password.\n\n&quot;</span>
                                      <span class="ruby-constant">GenericMailer</span>.<span class="ruby-identifier">generic</span>(<span class="ruby-constant">Setup</span>.<span class="ruby-identifier">site_name</span>(), <span class="ruby-constant">Setup</span>.<span class="ruby-identifier">return_email</span>(), <span class="ruby-ivar">@user</span>[<span class="ruby-value">:fullname</span>], 
                                          <span class="ruby-ivar">@user</span>[<span class="ruby-value">:email</span>], <span class="ruby-string">&quot;Recover User Name&quot;</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, 
                                          <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>), <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">deliver</span>
                                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Your user name has been e-mailed to your registered address.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                              <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">msg</span>
                                      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-string">&quot;**** ERROR: Can't send email: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">message</span>)
                                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;There was a problem sending email. If this persists, report the problem to the administrator.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                              <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;There is no user with that email address.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                      <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Please enter an email address.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
              <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- recover_username-source -->
          
        </div>

        

        
      </div><!-- recover_username-method -->

    
      <div id="method-i-reset_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="reset_password-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_password</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:help_username</span>] <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:help_username</span>].<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                      <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">reset_password</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:help_username</span>])
                      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>
                              <span class="ruby-keyword">begin</span>
                                      <span class="ruby-identifier">body</span> = <span class="ruby-node">&quot;Your #{Setup.site_name()} password has been reset.\n\n&quot;</span>

        <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;Your new password is:\n&quot;</span>
        <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\t#{@user[:new_password]}\n\n&quot;</span>

                                      <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;Click #{url_for :controller =&gt; 'home', :action =&gt; 'index', :only_path =&gt; false} to return to #{Setup.site_name()}.\n\n&quot;</span>

        <span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;We strongly recommend that you change your password by going to the #{Setup.site_name()} site and clicking the #{Setup.my_collex()} tab. Then select EDIT PROFILE.&quot;</span>

                                      <span class="ruby-constant">GenericMailer</span>.<span class="ruby-identifier">generic</span>(<span class="ruby-constant">Setup</span>.<span class="ruby-identifier">site_name</span>(), <span class="ruby-constant">Setup</span>.<span class="ruby-identifier">return_email</span>(), <span class="ruby-ivar">@user</span>[<span class="ruby-value">:fullname</span>], <span class="ruby-ivar">@user</span>[<span class="ruby-value">:email</span>], 
                                         <span class="ruby-string">&quot;Password Reset&quot;</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>), <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">deliver</span>
                                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;A new password will be e-mailed to your registered address.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                              <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">msg</span>
                                      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-string">&quot;**** ERROR: Can't send email: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">message</span>)
                                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;There was a problem sending email. If this persists, report the problem to the administrator.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                              <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;There is no user by that name.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                      <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Please enter a user name.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
              <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_password-source -->
          
        </div>

        

        
      </div><!-- reset_password-method -->

    
      <div id="method-i-submit_signup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">submit_signup</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="submit_signup-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">submit_signup</span>
              <span class="ruby-identifier">err_msg</span> = <span class="ruby-identifier">verify_signup_params</span>(<span class="ruby-identifier">params</span>)
              <span class="ruby-keyword">if</span> (<span class="ruby-identifier">err_msg</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>)
                      <span class="ruby-constant">LoginInfo</span>.<span class="ruby-identifier">record_signup</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:create_username</span>])
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Creating account...&quot;</span> <span class="ruby-comment"># since this doesn't set the status, the Ajax handler will request the page again</span>
              <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err_msg</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
              <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- submit_signup-source -->
          
        </div>

        

        
      </div><!-- submit_signup-method -->

    
      <div id="method-i-verify_login" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">verify_login</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="verify_login-source">
            <pre><span class="ruby-comment"># File app/controllers/login_controller.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verify_login</span>
              <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:signin_username</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:signin_username</span>] <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">pass</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:signin_password</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:signin_password</span>] <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>

              <span class="ruby-identifier">logged_in_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">login</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">pass</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">logged_in_user</span>
                      <span class="ruby-identifier">set_current_user</span>(<span class="ruby-identifier">logged_in_user</span>)
                      <span class="ruby-constant">LoginInfo</span>.<span class="ruby-identifier">record_login</span>(<span class="ruby-identifier">logged_in_user</span>)
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Logging in...&quot;</span> <span class="ruby-comment"># since this doesn't set the status, the Ajax handler will request the page again</span>
              <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">ip</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'REMOTE_ADDR'</span>]
                      <span class="ruby-constant">LoginInfo</span>.<span class="ruby-identifier">record_bad_login</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ip</span>)
                      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Invalid user/password combination&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
              <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- verify_login-source -->
          
        </div>

        

        
      </div><!-- verify_login-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

