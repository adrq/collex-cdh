<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class ClustersController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/clusters_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-check_url">#check_url</a>
    
    <li><a href="#method-i-cluster_exhibits_list">#cluster_exhibits_list</a>
    
    <li><a href="#method-i-create">#create</a>
    
    <li><a href="#method-i-destroy">#destroy</a>
    
    <li><a href="#method-i-edit_thumbnail">#edit_thumbnail</a>
    
    <li><a href="#method-i-move_exhibit">#move_exhibit</a>
    
    <li><a href="#method-i-remove_profile_picture">#remove_profile_picture</a>
    
    <li><a href="#method-i-show">#show</a>
    
    <li><a href="#method-i-update">#update</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Typewright.html">Typewright</a>
  
    <li><a href="./Typewright/AdminController.html">Typewright::AdminController</a>
  
    <li><a href="./Typewright/Document.html">Typewright::Document</a>
  
    <li><a href="./Typewright/DocumentUser.html">Typewright::DocumentUser</a>
  
    <li><a href="./Typewright/DocumentUsersController.html">Typewright::DocumentUsersController</a>
  
    <li><a href="./Typewright/DocumentsController.html">Typewright::DocumentsController</a>
  
    <li><a href="./Typewright/Line.html">Typewright::Line</a>
  
    <li><a href="./Typewright/LinesController.html">Typewright::LinesController</a>
  
    <li><a href="./Typewright/Overview.html">Typewright::Overview</a>
  
    <li><a href="./Typewright/OverviewsController.html">Typewright::OverviewsController</a>
  
    <li><a href="./Typewright/OverviewsHelper.html">Typewright::OverviewsHelper</a>
  
    <li><a href="./Typewright/SoapController.html">Typewright::SoapController</a>
  
    <li><a href="./Typewright/TwFeaturedObject.html">Typewright::TwFeaturedObject</a>
  
    <li><a href="./Typewright/TypewrightHelper.html">Typewright::TypewrightHelper</a>
  
    <li><a href="./Typewright/User.html">Typewright::User</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/BaseController.html">Admin::BaseController</a>
  
    <li><a href="./Admin/DefaultController.html">Admin::DefaultController</a>
  
    <li><a href="./Admin/DefaultHelper.html">Admin::DefaultHelper</a>
  
    <li><a href="./Admin/DefaultHelper/Session.html">Admin::DefaultHelper::Session</a>
  
    <li><a href="./Admin/DiscussionTopicsController.html">Admin::DiscussionTopicsController</a>
  
    <li><a href="./Admin/DiscussionTopicsHelper.html">Admin::DiscussionTopicsHelper</a>
  
    <li><a href="./Admin/FeaturesController.html">Admin::FeaturesController</a>
  
    <li><a href="./Admin/FeaturesHelper.html">Admin::FeaturesHelper</a>
  
    <li><a href="./Admin/SetupsController.html">Admin::SetupsController</a>
  
    <li><a href="./Admin/SetupsHelper.html">Admin::SetupsHelper</a>
  
    <li><a href="./Admin/SiteHelper.html">Admin::SiteHelper</a>
  
    <li><a href="./Admin/UserRolesController.html">Admin::UserRolesController</a>
  
    <li><a href="./Admin/UserRolesHelper.html">Admin::UserRolesHelper</a>
  
    <li><a href="./Catalog.html">Catalog</a>
  
    <li><a href="./Catalog/Error.html">Catalog::Error</a>
  
    <li><a href="./GroupsController.html">GroupsController</a>
  
    <li><a href="./GroupsController/RolesUser.html">GroupsController::RolesUser</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Branding.html">Branding</a>
  
    <li><a href="./BuilderController.html">BuilderController</a>
  
    <li><a href="./BuilderHelper.html">BuilderHelper</a>
  
    <li><a href="./CachedProperty.html">CachedProperty</a>
  
    <li><a href="./CachedResource.html">CachedResource</a>
  
    <li><a href="./CharSetAlter.html">CharSetAlter</a>
  
    <li><a href="./ClassroomController.html">ClassroomController</a>
  
    <li><a href="./ClassroomHelper.html">ClassroomHelper</a>
  
    <li><a href="./Cluster.html">Cluster</a>
  
    <li><a href="./ClustersController.html">ClustersController</a>
  
    <li><a href="./CollectedItem.html">CollectedItem</a>
  
    <li><a href="./CommentReport.html">CommentReport</a>
  
    <li><a href="./CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="./CommunitiesHelper.html">CommunitiesHelper</a>
  
    <li><a href="./Constraint.html">Constraint</a>
  
    <li><a href="./DiscussionComment.html">DiscussionComment</a>
  
    <li><a href="./DiscussionThread.html">DiscussionThread</a>
  
    <li><a href="./DiscussionThreadsHelper.html">DiscussionThreadsHelper</a>
  
    <li><a href="./DiscussionTopic.html">DiscussionTopic</a>
  
    <li><a href="./DiscussionVisit.html">DiscussionVisit</a>
  
    <li><a href="./DocumentCompleteMailer.html">DocumentCompleteMailer</a>
  
    <li><a href="./Exhibit.html">Exhibit</a>
  
    <li><a href="./ExhibitElement.html">ExhibitElement</a>
  
    <li><a href="./ExhibitElementsController.html">ExhibitElementsController</a>
  
    <li><a href="./ExhibitElementsHelper.html">ExhibitElementsHelper</a>
  
    <li><a href="./ExhibitFootnote.html">ExhibitFootnote</a>
  
    <li><a href="./ExhibitIllustration.html">ExhibitIllustration</a>
  
    <li><a href="./ExhibitIllustrationsController.html">ExhibitIllustrationsController</a>
  
    <li><a href="./ExhibitObject.html">ExhibitObject</a>
  
    <li><a href="./ExhibitPage.html">ExhibitPage</a>
  
    <li><a href="./ExhibitPagesController.html">ExhibitPagesController</a>
  
    <li><a href="./ExhibitsController.html">ExhibitsController</a>
  
    <li><a href="./ExpressionConstraint.html">ExpressionConstraint</a>
  
    <li><a href="./FacetConstraint.html">FacetConstraint</a>
  
    <li><a href="./FeaturedObject.html">FeaturedObject</a>
  
    <li><a href="./FederationConstraint.html">FederationConstraint</a>
  
    <li><a href="./ForumController.html">ForumController</a>
  
    <li><a href="./FreeCultureConstraint.html">FreeCultureConstraint</a>
  
    <li><a href="./FullTextConstraint.html">FullTextConstraint</a>
  
    <li><a href="./GenericMailer.html">GenericMailer</a>
  
    <li><a href="./GetIncludeFileList.html">GetIncludeFileList</a>
  
    <li><a href="./Group.html">Group</a>
  
    <li><a href="./GroupsHelper.html">GroupsHelper</a>
  
    <li><a href="./GroupsUser.html">GroupsUser</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./Image.html">Image</a>
  
    <li><a href="./ImageFull.html">ImageFull</a>
  
    <li><a href="./IsoLanguage.html">IsoLanguage</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LoginHelper.html">LoginHelper</a>
  
    <li><a href="./LoginInfo.html">LoginInfo</a>
  
    <li><a href="./MyCollexController.html">MyCollexController</a>
  
    <li><a href="./MyCollexHelper.html">MyCollexHelper</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./ObjectActivity.html">ObjectActivity</a>
  
    <li><a href="./PeerReview.html">PeerReview</a>
  
    <li><a href="./PublicationImage.html">PublicationImage</a>
  
    <li><a href="./PublicationsController.html">PublicationsController</a>
  
    <li><a href="./PublicationsHelper.html">PublicationsHelper</a>
  
    <li><a href="./ResultsController.html">ResultsController</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./SavedSearchConstraint.html">SavedSearchConstraint</a>
  
    <li><a href="./Search.html">Search</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SearchUserContent.html">SearchUserContent</a>
  
    <li><a href="./Session.html">Session</a>
  
    <li><a href="./Setup.html">Setup</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagController.html">TagController</a>
  
    <li><a href="./TagHelper.html">TagHelper</a>
  
    <li><a href="./Tagassign.html">Tagassign</a>
  
    <li><a href="./TestJsController.html">TestJsController</a>
  
    <li><a href="./TestJsHelper.html">TestJsHelper</a>
  
    <li><a href="./TypeWrightConstraint.html">TypeWrightConstraint</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsernameAlreadyExistsException.html">UsernameAlreadyExistsException</a>
  
    <li><a href="./VicConference.html">VicConference</a>
  
    <li><a href="./VicConferenceController.html">VicConferenceController</a>
  
    <li><a href="./WebUtils.html">WebUtils</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ClustersController</h1>

  <div id="description" class="description">
    
<p>Copyright 2009 Applied Research in Patacriticism and the University of
Virginia</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not
use this file except in compliance with the License. You may obtain a copy
of the License at</p>

<pre>http://www.apache.org/licenses/LICENSE-2.0</pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-check_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_url</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="check_url-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_url</span>
        <span class="ruby-identifier">url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>][<span class="ruby-string">'visible_url'</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">url</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;No URL given. Please enter one.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                <span class="ruby-keyword">return</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">url_int</span> = <span class="ruby-identifier">url</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">url_int</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Numbers are not allowed as URLs.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                <span class="ruby-keyword">return</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">index</span>(<span class="ruby-regexp">/\W/</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Only letters, numbers, and underscores are allowed as URLs.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
                <span class="ruby-keyword">return</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
        <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-identifier">group_id</span> = <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">group_id</span>
        <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find_by_group_id_and_visible_url</span>(<span class="ruby-identifier">group_id</span>, <span class="ruby-identifier">url</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;The URL matches another #{Group.get_clusters_label(group_id)}. Choose a different one.&quot;</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bad_request</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'The URL is accepted. Please wait.'</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_url-source -->
          
        </div>

        

        
      </div><!-- check_url-method -->

    
      <div id="method-i-cluster_exhibits_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cluster_exhibits_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="cluster_exhibits_list-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cluster_exhibits_list</span>
        <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
        <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'cluster_exhibits_list'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">group_id</span>), <span class="ruby-value">:cluster</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cluster</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">get_curr_user_id</span>() }
<span class="ruby-keyword">end</span></pre>
          </div><!-- cluster_exhibits_list-source -->
          
        </div>

        

        
      </div><!-- cluster_exhibits_list-method -->

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>POST /clusters POST /clusters.xml</p>
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 171</span>
        <span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
                <span class="ruby-comment"># TODO-PER: the error processing can probably be simplified now that the image handling is in save_image.</span>
                <span class="ruby-identifier">err</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">save_image</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'image'</span>], <span class="ruby-keyword">nil</span>)
                <span class="ruby-identifier">img_id</span> = <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">case</span> <span class="ruby-identifier">err</span>[<span class="ruby-value">:status</span>]
                        <span class="ruby-keyword">when</span> <span class="ruby-value">:error</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-identifier">err</span>[<span class="ruby-value">:log_error</span>])
                                <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">respond_to_file_upload</span>(<span class="ruby-string">&quot;stopNewClusterUpload&quot;</span>, <span class="ruby-identifier">err</span>[<span class="ruby-value">:user_error</span>])  <span class="ruby-comment"># This is loaded in the iframe and tells the dialog that the upload is complete.</span>
                                <span class="ruby-keyword">return</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-value">:saved</span>
                                <span class="ruby-identifier">img_id</span> = <span class="ruby-identifier">err</span>[<span class="ruby-value">:id</span>]
                <span class="ruby-keyword">end</span>
<span class="ruby-comment">#               begin</span>
<span class="ruby-comment">#                       if params['image'] &amp;&amp; params['image'].length &gt; 0</span>
<span class="ruby-comment">#                               image = Image.new({ :uploaded_data =&gt; params['image'] })</span>
<span class="ruby-comment">#                       end</span>
                        <span class="ruby-comment">#params[:cluster]['visibility'] = 'everyone'</span>
                        <span class="ruby-identifier">group_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>][<span class="ruby-value">:group_id</span>]
                        <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>][<span class="ruby-value">:name</span>]
                        <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find_by_group_id_and_name</span>(<span class="ruby-identifier">group_id</span>, <span class="ruby-identifier">name</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                                <span class="ruby-identifier">flash</span> = <span class="ruby-node">&quot;Duplicate #{Group.get_clusters_label(group_id)} name. Please choose another.&quot;</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-ivar">@cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>])
                                <span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">image_id</span> = <span class="ruby-identifier">img_id</span>
                                <span class="ruby-comment">#err = false</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">save</span>
<span class="ruby-comment">#                                       begin</span>
<span class="ruby-comment">#                                               @cluster.image.save! if @cluster.image</span>
<span class="ruby-comment">#                                       rescue</span>
<span class="ruby-comment">#                                               err = true</span>
<span class="ruby-comment">#                                               @cluster.delete</span>
<span class="ruby-comment">#                                               flash = &quot;ERROR: The image you have uploaded is too large or of the wrong type.&lt;br /&gt;The file name must end in .jpg, .png or .gif, and cannot exceed 1MB in size.&quot;</span>
<span class="ruby-comment">#                                       end</span>
<span class="ruby-comment">#                                       if err == false</span>
                                                <span class="ruby-constant">GroupsUser</span>.<span class="ruby-identifier">email_hook</span>(<span class="ruby-string">&quot;group&quot;</span>, <span class="ruby-identifier">group_id</span>, <span class="ruby-node">&quot;New #{Group.get_clusters_label(group_id)} in #{Group.find(group_id).name}&quot;</span>, <span class="ruby-node">&quot;#{get_curr_user_name} has created the #{Group.get_clusters_label(group_id)} \&quot;#{@cluster.name}\&quot;.&quot;</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>))
                                                <span class="ruby-identifier">flash</span> = <span class="ruby-node">&quot;OK:#{@cluster.id}&quot;</span>
<span class="ruby-comment">#                                       end</span>
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-identifier">flash</span> = <span class="ruby-node">&quot;Error creating #{Group.get_clusters_label(group_id)}&quot;</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
<span class="ruby-comment">#               rescue</span>
<span class="ruby-comment">#                       flash = &quot;Server error when creating #{Group.get_clusters_label(group_id)}.&quot;</span>
<span class="ruby-comment">#               end</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">respond_to_file_upload</span>(<span class="ruby-string">&quot;stopNewClusterUpload&quot;</span>, <span class="ruby-identifier">flash</span>)  <span class="ruby-comment"># This is loaded in the iframe and tells the dialog that the upload is complete.</span>
  <span class="ruby-keyword">end</span></pre>
          </div><!-- create-source -->
          
        </div>

        

        
      </div><!-- create-method -->

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>DELETE /clusters/1 DELETE /clusters/1.xml</p>
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-ivar">@cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
              <span class="ruby-identifier">group_id</span> = <span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">group_id</span>
              <span class="ruby-constant">GroupsUser</span>.<span class="ruby-identifier">email_hook</span>(<span class="ruby-string">&quot;group&quot;</span>, <span class="ruby-identifier">group_id</span>, <span class="ruby-node">&quot;#{Group.get_clusters_label(@cluster.group_id)} deleted in #{Group.find(@cluster.group_id).name}&quot;</span>, <span class="ruby-node">&quot;#{get_curr_user_name} has deleted the #{Group.get_clusters_label(@cluster.group_id)} \&quot;#{@cluster.name}\&quot;.&quot;</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>))
  <span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">destroy</span>

              <span class="ruby-comment"># Also remove the exhibits and discussions from being in the cluster.</span>
              <span class="ruby-identifier">exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">cluster_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]})
              <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exhibit</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">cluster_id</span> = <span class="ruby-keyword">nil</span>
                      <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">save!</span>
              }
              <span class="ruby-identifier">threads</span> = <span class="ruby-constant">DiscussionThread</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">cluster_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]})
              <span class="ruby-identifier">threads</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">thread</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">cluster_id</span> = <span class="ruby-keyword">nil</span>
                      <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">save!</span>
              }
              <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'groups'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;show&quot;</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group_id</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy-source -->
          
        </div>

        

        
      </div><!-- destroy-method -->

    
      <div id="method-i-edit_thumbnail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_thumbnail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_thumbnail-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 85</span>
        <span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_thumbnail</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_signed_in?</span>
                        <span class="ruby-identifier">flash</span> = <span class="ruby-string">&quot;You are not logged in. Has your session expired?&quot;</span>
                        <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">respond_to_file_upload</span>(<span class="ruby-string">&quot;stopEditGroupThumbnailUpload&quot;</span>, <span class="ruby-identifier">flash</span>)
                        <span class="ruby-keyword">return</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">cluster_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
                <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cluster_id</span>)
                <span class="ruby-identifier">err</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">save_image</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'image'</span>], <span class="ruby-identifier">cluster</span>)
                <span class="ruby-keyword">case</span> <span class="ruby-identifier">err</span>[<span class="ruby-value">:status</span>]
                <span class="ruby-keyword">when</span> <span class="ruby-value">:error</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">flash</span> = <span class="ruby-identifier">err</span>[<span class="ruby-value">:user_error</span>]
                        <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-identifier">err</span>[<span class="ruby-value">:log_error</span>])
                <span class="ruby-keyword">when</span> <span class="ruby-value">:saved</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">flash</span> = <span class="ruby-string">&quot;OK:Thumbnail updated&quot;</span>
                        <span class="ruby-constant">GroupsUser</span>.<span class="ruby-identifier">email_hook</span>(<span class="ruby-string">&quot;group&quot;</span>, <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">group_id</span>, <span class="ruby-node">&quot;Profile thumbnail changed in #{Group.get_clusters_label(cluster.group_id)} in #{Group.find(cluster.group_id).name}&quot;</span>, <span class="ruby-node">&quot;#{get_curr_user_name} has uploaded a new thumbnail picture to the #{Group.get_clusters_label(cluster.group_id)} \&quot;#{cluster.name}\&quot;.&quot;</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>))
                <span class="ruby-keyword">when</span> <span class="ruby-value">:no_image</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">flash</span> = <span class="ruby-string">&quot;ERROR: No image specified&quot;</span>
                <span class="ruby-keyword">end</span>
<span class="ruby-comment">#               image = params['image']</span>
<span class="ruby-comment">#               if image &amp;&amp; image</span>
<span class="ruby-comment">#                       image = Image.new({ :uploaded_data =&gt; image })</span>
<span class="ruby-comment">#                       end</span>
<span class="ruby-comment">#               begin</span>
<span class="ruby-comment">#                       cluster.image = image</span>
<span class="ruby-comment">#                       if cluster.save</span>
<span class="ruby-comment">#                               cluster.image.save! if cluster.image</span>
<span class="ruby-comment">#                               flash = &quot;OK:Thumbnail updated&quot;</span>
<span class="ruby-comment">#                               GroupsUser.email_hook(&quot;group&quot;, cluster.group_id, &quot;Profile thumbnail changed in #{Group.get_clusters_label(cluster.group_id)} in #{Group.find(cluster.group_id).name}&quot;, &quot;#{get_curr_user_name} has uploaded a new thumbnail picture to the #{Group.get_clusters_label(cluster.group_id)} \&quot;#{cluster.name}\&quot;.&quot;, url_for(:controller =&gt; 'home', :action =&gt; 'index', :only_path =&gt; false))</span>
<span class="ruby-comment">#                       else</span>
<span class="ruby-comment">#                               flash = &quot;Error updating thumbnail&quot;</span>
<span class="ruby-comment">#                       end</span>
<span class="ruby-comment">#               rescue</span>
<span class="ruby-comment">#                       flash = &quot;ERROR: The image you have uploaded is too large or of the wrong type.&lt;br /&gt;The file name must end in .jpg, .png or .gif, and cannot exceed 1MB in size.&quot;</span>
<span class="ruby-comment">#               end</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">respond_to_file_upload</span>(<span class="ruby-string">&quot;stopEditGroupThumbnailUpload&quot;</span>, <span class="ruby-identifier">flash</span>)  <span class="ruby-comment"># This is loaded in the iframe and tells the dialog that the upload is complete.</span>
        <span class="ruby-keyword">end</span></pre>
          </div><!-- edit_thumbnail-source -->
          
        </div>

        

        
      </div><!-- edit_thumbnail-method -->

    
      <div id="method-i-move_exhibit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">move_exhibit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="move_exhibit-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 54</span>
        <span class="ruby-keyword">def</span> <span class="ruby-identifier">move_exhibit</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;You are not logged in. Has your session expired?&quot;</span>
                        <span class="ruby-keyword">return</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">exhibit_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:exhibit_id</span>]
                <span class="ruby-identifier">group_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>]
                <span class="ruby-identifier">cluster_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>]
                <span class="ruby-identifier">dest_cluster</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:dest_cluster</span>]
                <span class="ruby-identifier">exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">exhibit_id</span>)
                <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">cluster_id</span> = <span class="ruby-identifier">dest_cluster</span> <span class="ruby-operator">==</span> <span class="ruby-string">'0'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">dest_cluster</span>
                <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">save!</span>
                <span class="ruby-identifier">cluster</span> = <span class="ruby-identifier">cluster_id</span> <span class="ruby-operator">==</span> <span class="ruby-string">'0'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cluster_id</span>)
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">group_id</span>)
                <span class="ruby-constant">GroupsUser</span>.<span class="ruby-identifier">email_hook</span>(<span class="ruby-string">&quot;exhibit&quot;</span>, <span class="ruby-identifier">group_id</span>, <span class="ruby-node">&quot;An #{group.get_exhibits_label()} in #{Group.find(group_id).name} has been moved&quot;</span>, <span class="ruby-node">&quot;#{get_curr_user_name} has moved the #{group.get_exhibits_label()} \&quot;#{exhibit.title}\&quot; to #{Group.get_clusters_label(group_id)} \&quot;#{cluster ? cluster.name : &quot;no #{Group.get_clusters_label(group_id)}&quot; }\&quot;.&quot;</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>))
                <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'/groups/group_exhibits_list'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">group_id</span>), <span class="ruby-value">:cluster</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cluster</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">get_curr_user_id</span>() }
<span class="ruby-keyword">end</span></pre>
          </div><!-- move_exhibit-source -->
          
        </div>

        

        
      </div><!-- move_exhibit-method -->

    
      <div id="method-i-remove_profile_picture" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_profile_picture</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="remove_profile_picture-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 72</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_profile_picture</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;You are not logged in. Has your session expired?&quot;</span>
                    <span class="ruby-keyword">return</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
            <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>)
            <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">image</span> = <span class="ruby-keyword">nil</span>
            <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-constant">GroupsUser</span>.<span class="ruby-identifier">email_hook</span>(<span class="ruby-string">&quot;group&quot;</span>, <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">group_id</span>, <span class="ruby-node">&quot;Profile thumbnail removed in #{Group.find(cluster.group_id).name}&quot;</span>, <span class="ruby-node">&quot;#{get_curr_user_name} has removed the separate thumbnail from the #{Group.get_clusters_label(cluster.group_id)} \&quot;#{cluster.name}\&quot;.&quot;</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>))
<span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:back</span>
    <span class="ruby-keyword">end</span></pre>
          </div><!-- remove_profile_picture-source -->
          
        </div>

        

        
      </div><!-- remove_profile_picture-method -->

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /clusters/1 GET /clusters/1.xml</p>
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>
              <span class="ruby-comment"># This can be called the conventional way with an id, or it can be called with a group/cluster path.</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                      <span class="ruby-comment"># we were given a group and cluster name instead</span>
                      <span class="ruby-identifier">group_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>]
                      <span class="ruby-identifier">cluster_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>]
                      <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find_by_visible_url</span>(<span class="ruby-identifier">group_name</span>)
                      <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">group_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                              <span class="ruby-identifier">render_404</span>
                              <span class="ruby-keyword">return</span>
                      <span class="ruby-keyword">end</span>

                      <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find_by_group_id_and_visible_url</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">cluster_name</span>)
                      <span class="ruby-identifier">cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">cluster_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span>
                              <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>] = <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">id</span>
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">render_404</span>
                              <span class="ruby-keyword">return</span>
                      <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>

              <span class="ruby-ivar">@cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find_by_visible_url</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cluster</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                      <span class="ruby-ivar">@cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cluster</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/&quot;</span>
                      <span class="ruby-keyword">return</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-ivar">@group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">group_id</span>)

              <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment"># show.html.erb</span>
                      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-value">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@cluster</span> }
              <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- show-source -->
          
        </div>

        

        
      </div><!-- show-method -->

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>PUT /clusters/1 PUT /clusters/1.xml</p>
          

          
          <div class="method-source-code" id="update-source">
            <pre><span class="ruby-comment"># File app/controllers/clusters_controller.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update</span>
        <span class="ruby-ivar">@cluster</span> = <span class="ruby-constant">Cluster</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
        <span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>])
        <span class="ruby-identifier">which</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; and &quot;</span>)
        <span class="ruby-constant">GroupsUser</span>.<span class="ruby-identifier">email_hook</span>(<span class="ruby-string">&quot;group&quot;</span>, <span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">group_id</span>, <span class="ruby-node">&quot;#{Group.get_clusters_label(@cluster.group_id)} changed in #{Group.find(@cluster.group_id).name}&quot;</span>, <span class="ruby-node">&quot;#{get_curr_user_name} has updated the field \&quot;#{which}\&quot; in #{Group.get_clusters_label(@cluster.group_id)} \&quot;#{@cluster.name}\&quot;.&quot;</span>, <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'home'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'index'</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>))

        <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'cluster_details'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@cluster</span>.<span class="ruby-identifier">group_id</span>), <span class="ruby-value">:cluster</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@cluster</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">get_curr_user_id</span>() }
<span class="ruby-keyword">end</span></pre>
          </div><!-- update-source -->
          
        </div>

        

        
      </div><!-- update-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

