<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class Exhibit - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/exhibit.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-adjust_indexing_all">::adjust_indexing_all</a>
    
    <li><a href="#method-c-all_my_exhibits">::all_my_exhibits</a>
    
    <li><a href="#method-c-can_edit">::can_edit</a>
    
    <li><a href="#method-c-clean_up_word_file">::clean_up_word_file</a>
    
    <li><a href="#method-c-factory">::factory</a>
    
    <li><a href="#method-c-find_by_element_id">::find_by_element_id</a>
    
    <li><a href="#method-c-find_by_illustration_id">::find_by_illustration_id</a>
    
    <li><a href="#method-c-get_all_published">::get_all_published</a>
    
    <li><a href="#method-c-get_default_license">::get_default_license</a>
    
    <li><a href="#method-c-get_exhibits_in_group">::get_exhibits_in_group</a>
    
    <li><a href="#method-c-get_license_info">::get_license_info</a>
    
    <li><a href="#method-c-get_pending_exhibits_in_group">::get_pending_exhibits_in_group</a>
    
    <li><a href="#method-c-get_referencing_exhibits">::get_referencing_exhibits</a>
    
    <li><a href="#method-c-get_sharing_icon_url">::get_sharing_icon_url</a>
    
    <li><a href="#method-c-get_sharing_license_type">::get_sharing_license_type</a>
    
    <li><a href="#method-c-get_sharing_static">::get_sharing_static</a>
    
    <li><a href="#method-c-get_sharing_text">::get_sharing_text</a>
    
    <li><a href="#method-c-has_footnotes">::has_footnotes</a>
    
    <li><a href="#method-c-index_all_peer_reviewed">::index_all_peer_reviewed</a>
    
    <li><a href="#method-c-is_license_specified">::is_license_specified</a>
    
    <li><a href="#method-c-js_array_of_all_public_exhibits">::js_array_of_all_public_exhibits</a>
    
    <li><a href="#method-c-process_input_file">::process_input_file</a>
    
    <li><a href="#method-c-process_word_paragraph">::process_word_paragraph</a>
    
    <li><a href="#method-c-transform_url">::transform_url</a>
    
    <li><a href="#method-c-unindex_all_exhibits">::unindex_all_exhibits</a>
    
    <li><a href="#method-i-adjust_indexing">#adjust_indexing</a>
    
    <li><a href="#method-i-bump_last_change">#bump_last_change</a>
    
    <li><a href="#method-i-can_view">#can_view</a>
    
    <li><a href="#method-i-count_footnotes_from_illustration">#count_footnotes_from_illustration</a>
    
    <li><a href="#method-i-count_footnotes_from_text">#count_footnotes_from_text</a>
    
    <li><a href="#method-i-delete_page">#delete_page</a>
    
    <li><a href="#method-i-extract_footnotes_from_illustration">#extract_footnotes_from_illustration</a>
    
    <li><a href="#method-i-extract_footnotes_from_text">#extract_footnotes_from_text</a>
    
    <li><a href="#method-i-extract_links_from_illustration">#extract_links_from_illustration</a>
    
    <li><a href="#method-i-extract_links_from_text">#extract_links_from_text</a>
    
    <li><a href="#method-i-fonts_match_defaults">#fonts_match_defaults</a>
    
    <li><a href="#method-i-get_all_footnotes">#get_all_footnotes</a>
    
    <li><a href="#method-i-get_all_links">#get_all_links</a>
    
    <li><a href="#method-i-get_all_text">#get_all_text</a>
    
    <li><a href="#method-i-get_apparent_author">#get_apparent_author</a>
    
    <li><a href="#method-i-get_apparent_author_email">#get_apparent_author_email</a>
    
    <li><a href="#method-i-get_apparent_author_name">#get_apparent_author_name</a>
    
    <li><a href="#method-i-get_authors">#get_authors</a>
    
    <li><a href="#method-i-get_badge">#get_badge</a>
    
    <li><a href="#method-i-get_category">#get_category</a>
    
    <li><a href="#method-i-get_effective_license_type">#get_effective_license_type</a>
    
    <li><a href="#method-i-get_font_name">#get_font_name</a>
    
    <li><a href="#method-i-get_font_size">#get_font_size</a>
    
    <li><a href="#method-i-get_friendly_url">#get_friendly_url</a>
    
    <li><a href="#method-i-get_id_if_no_visible_url">#get_id_if_no_visible_url</a>
    
    <li><a href="#method-i-get_publish_links">#get_publish_links</a>
    
    <li><a href="#method-i-get_sharing">#get_sharing</a>
    
    <li><a href="#method-i-get_sharing_icon_with_link">#get_sharing_icon_with_link</a>
    
    <li><a href="#method-i-get_sharing_image">#get_sharing_image</a>
    
    <li><a href="#method-i-get_sharing_int">#get_sharing_int</a>
    
    <li><a href="#method-i-get_sharing_widget">#get_sharing_widget</a>
    
    <li><a href="#method-i-get_starting_footnote_per_page">#get_starting_footnote_per_page</a>
    
    <li><a href="#method-i-get_visibility_friendly_text">#get_visibility_friendly_text</a>
    
    <li><a href="#method-i-handle_solr">#handle_solr</a>
    
    <li><a href="#method-i-index_exhibit">#index_exhibit</a>
    
    <li><a href="#method-i-insert_example_page">#insert_example_page</a>
    
    <li><a href="#method-i-insert_page">#insert_page</a>
    
    <li><a href="#method-i-is_peer_reviewed">#is_peer_reviewed</a>
    
    <li><a href="#method-i-make_archive_name">#make_archive_name</a>
    
    <li><a href="#method-i-make_old_archive_name">#make_old_archive_name</a>
    
    <li><a href="#method-i-make_resource_name">#make_resource_name</a>
    
    <li><a href="#method-i-move_page_down">#move_page_down</a>
    
    <li><a href="#method-i-move_page_up">#move_page_up</a>
    
    <li><a href="#method-i-published-3F">#published?</a>
    
    <li><a href="#method-i-reset_fonts_to_default">#reset_fonts_to_default</a>
    
    <li><a href="#method-i-set_sharing">#set_sharing</a>
    
    <li><a href="#method-i-unindex_exhibit">#unindex_exhibit</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Typewright.html">Typewright</a>
  
    <li><a href="./Typewright/AdminController.html">Typewright::AdminController</a>
  
    <li><a href="./Typewright/Document.html">Typewright::Document</a>
  
    <li><a href="./Typewright/DocumentUser.html">Typewright::DocumentUser</a>
  
    <li><a href="./Typewright/DocumentUsersController.html">Typewright::DocumentUsersController</a>
  
    <li><a href="./Typewright/DocumentsController.html">Typewright::DocumentsController</a>
  
    <li><a href="./Typewright/Line.html">Typewright::Line</a>
  
    <li><a href="./Typewright/LinesController.html">Typewright::LinesController</a>
  
    <li><a href="./Typewright/Overview.html">Typewright::Overview</a>
  
    <li><a href="./Typewright/OverviewsController.html">Typewright::OverviewsController</a>
  
    <li><a href="./Typewright/OverviewsHelper.html">Typewright::OverviewsHelper</a>
  
    <li><a href="./Typewright/SoapController.html">Typewright::SoapController</a>
  
    <li><a href="./Typewright/TwFeaturedObject.html">Typewright::TwFeaturedObject</a>
  
    <li><a href="./Typewright/TypewrightHelper.html">Typewright::TypewrightHelper</a>
  
    <li><a href="./Typewright/User.html">Typewright::User</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/BaseController.html">Admin::BaseController</a>
  
    <li><a href="./Admin/DefaultController.html">Admin::DefaultController</a>
  
    <li><a href="./Admin/DefaultHelper.html">Admin::DefaultHelper</a>
  
    <li><a href="./Admin/DefaultHelper/Session.html">Admin::DefaultHelper::Session</a>
  
    <li><a href="./Admin/DiscussionTopicsController.html">Admin::DiscussionTopicsController</a>
  
    <li><a href="./Admin/DiscussionTopicsHelper.html">Admin::DiscussionTopicsHelper</a>
  
    <li><a href="./Admin/FeaturesController.html">Admin::FeaturesController</a>
  
    <li><a href="./Admin/FeaturesHelper.html">Admin::FeaturesHelper</a>
  
    <li><a href="./Admin/SetupsController.html">Admin::SetupsController</a>
  
    <li><a href="./Admin/SetupsHelper.html">Admin::SetupsHelper</a>
  
    <li><a href="./Admin/SiteHelper.html">Admin::SiteHelper</a>
  
    <li><a href="./Admin/UserRolesController.html">Admin::UserRolesController</a>
  
    <li><a href="./Admin/UserRolesHelper.html">Admin::UserRolesHelper</a>
  
    <li><a href="./Catalog.html">Catalog</a>
  
    <li><a href="./Catalog/Error.html">Catalog::Error</a>
  
    <li><a href="./GroupsController.html">GroupsController</a>
  
    <li><a href="./GroupsController/RolesUser.html">GroupsController::RolesUser</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Branding.html">Branding</a>
  
    <li><a href="./BuilderController.html">BuilderController</a>
  
    <li><a href="./BuilderHelper.html">BuilderHelper</a>
  
    <li><a href="./CachedProperty.html">CachedProperty</a>
  
    <li><a href="./CachedResource.html">CachedResource</a>
  
    <li><a href="./CharSetAlter.html">CharSetAlter</a>
  
    <li><a href="./ClassroomController.html">ClassroomController</a>
  
    <li><a href="./ClassroomHelper.html">ClassroomHelper</a>
  
    <li><a href="./Cluster.html">Cluster</a>
  
    <li><a href="./ClustersController.html">ClustersController</a>
  
    <li><a href="./CollectedItem.html">CollectedItem</a>
  
    <li><a href="./CommentReport.html">CommentReport</a>
  
    <li><a href="./CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="./CommunitiesHelper.html">CommunitiesHelper</a>
  
    <li><a href="./Constraint.html">Constraint</a>
  
    <li><a href="./DiscussionComment.html">DiscussionComment</a>
  
    <li><a href="./DiscussionThread.html">DiscussionThread</a>
  
    <li><a href="./DiscussionThreadsHelper.html">DiscussionThreadsHelper</a>
  
    <li><a href="./DiscussionTopic.html">DiscussionTopic</a>
  
    <li><a href="./DiscussionVisit.html">DiscussionVisit</a>
  
    <li><a href="./DocumentCompleteMailer.html">DocumentCompleteMailer</a>
  
    <li><a href="./Exhibit.html">Exhibit</a>
  
    <li><a href="./ExhibitElement.html">ExhibitElement</a>
  
    <li><a href="./ExhibitElementsController.html">ExhibitElementsController</a>
  
    <li><a href="./ExhibitElementsHelper.html">ExhibitElementsHelper</a>
  
    <li><a href="./ExhibitFootnote.html">ExhibitFootnote</a>
  
    <li><a href="./ExhibitIllustration.html">ExhibitIllustration</a>
  
    <li><a href="./ExhibitIllustrationsController.html">ExhibitIllustrationsController</a>
  
    <li><a href="./ExhibitObject.html">ExhibitObject</a>
  
    <li><a href="./ExhibitPage.html">ExhibitPage</a>
  
    <li><a href="./ExhibitPagesController.html">ExhibitPagesController</a>
  
    <li><a href="./ExhibitsController.html">ExhibitsController</a>
  
    <li><a href="./ExpressionConstraint.html">ExpressionConstraint</a>
  
    <li><a href="./FacetConstraint.html">FacetConstraint</a>
  
    <li><a href="./FeaturedObject.html">FeaturedObject</a>
  
    <li><a href="./FederationConstraint.html">FederationConstraint</a>
  
    <li><a href="./ForumController.html">ForumController</a>
  
    <li><a href="./FreeCultureConstraint.html">FreeCultureConstraint</a>
  
    <li><a href="./FullTextConstraint.html">FullTextConstraint</a>
  
    <li><a href="./GenericMailer.html">GenericMailer</a>
  
    <li><a href="./GetIncludeFileList.html">GetIncludeFileList</a>
  
    <li><a href="./Group.html">Group</a>
  
    <li><a href="./GroupsHelper.html">GroupsHelper</a>
  
    <li><a href="./GroupsUser.html">GroupsUser</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./Image.html">Image</a>
  
    <li><a href="./ImageFull.html">ImageFull</a>
  
    <li><a href="./IsoLanguage.html">IsoLanguage</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LoginHelper.html">LoginHelper</a>
  
    <li><a href="./LoginInfo.html">LoginInfo</a>
  
    <li><a href="./MyCollexController.html">MyCollexController</a>
  
    <li><a href="./MyCollexHelper.html">MyCollexHelper</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./ObjectActivity.html">ObjectActivity</a>
  
    <li><a href="./PeerReview.html">PeerReview</a>
  
    <li><a href="./PublicationImage.html">PublicationImage</a>
  
    <li><a href="./PublicationsController.html">PublicationsController</a>
  
    <li><a href="./PublicationsHelper.html">PublicationsHelper</a>
  
    <li><a href="./ResultsController.html">ResultsController</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./SavedSearchConstraint.html">SavedSearchConstraint</a>
  
    <li><a href="./Search.html">Search</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SearchUserContent.html">SearchUserContent</a>
  
    <li><a href="./Session.html">Session</a>
  
    <li><a href="./Setup.html">Setup</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagController.html">TagController</a>
  
    <li><a href="./TagHelper.html">TagHelper</a>
  
    <li><a href="./Tagassign.html">Tagassign</a>
  
    <li><a href="./TestJsController.html">TestJsController</a>
  
    <li><a href="./TestJsHelper.html">TestJsHelper</a>
  
    <li><a href="./TypeWrightConstraint.html">TypeWrightConstraint</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsernameAlreadyExistsException.html">UsernameAlreadyExistsException</a>
  
    <li><a href="./VicConference.html">VicConference</a>
  
    <li><a href="./VicConferenceController.html">VicConferenceController</a>
  
    <li><a href="./WebUtils.html">WebUtils</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Exhibit</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="ARCHIVE_PREFIX">ARCHIVE_PREFIX
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-author" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">author</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-editors_only" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">editors_only</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-group_only" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">group_only</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-adjust_indexing_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">adjust_indexing_all</span><span
            class="method-args">(group_id, typ)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="adjust_indexing_all-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 962</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">adjust_indexing_all</span>(<span class="ruby-identifier">group_id</span>, <span class="ruby-identifier">typ</span>)
        <span class="ruby-identifier">exhibits</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">group_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">group_id</span>})
        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exhibit</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">adjust_indexing</span>(<span class="ruby-identifier">typ</span>, <span class="ruby-identifier">exhibit</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">last</span>)
        }
<span class="ruby-keyword">end</span></pre>
          </div><!-- adjust_indexing_all-source -->
          
        </div>

        

        
      </div><!-- adjust_indexing_all-method -->

    
      <div id="method-c-all_my_exhibits" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all_my_exhibits</span><span
            class="method-args">(user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="all_my_exhibits-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">all_my_exhibits</span>(<span class="ruby-identifier">user_id</span>)
  <span class="ruby-identifier">my_exhibits</span> = <span class="ruby-identifier">where</span>({<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user_id</span>})
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">my_exhibits</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">my_exhibits</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">my_exhibits</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exhibit</span><span class="ruby-operator">|</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">text</span><span class="ruby-operator">:</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">title</span> }  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- all_my_exhibits-source -->
          
        </div>

        

        
      </div><!-- all_my_exhibits-method -->

    
      <div id="method-c-can_edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_edit</span><span
            class="method-args">(user, exhibit_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="can_edit-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">can_edit</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">exhibit_id</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">exhibit_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">group_id</span>
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">group_id</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">role_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'admin'</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_edit-source -->
          
        </div>

        

        
      </div><!-- can_edit-method -->

    
      <div id="method-c-clean_up_word_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clean_up_word_file</span><span
            class="method-args">(this_folder)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="clean_up_word_file-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1170</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clean_up_word_file</span>(<span class="ruby-identifier">this_folder</span>)
        <span class="ruby-node">%xrm -R #{this_folder}`</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- clean_up_word_file-source -->
          
        </div>

        

        
      </div><!-- clean_up_word_file-method -->

    
      <div id="method-c-factory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">factory</span><span
            class="method-args">(user_id, url, title, thumbnail, group_id, cluster_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="factory-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">url</span>, <span class="ruby-identifier">title</span>, <span class="ruby-identifier">thumbnail</span>, <span class="ruby-identifier">group_id</span>, <span class="ruby-identifier">cluster_id</span>)
  <span class="ruby-identifier">thumbnail</span> = <span class="ruby-identifier">thumbnail</span>.<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">thumbnail</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">thumbnail</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">'http'</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">thumbnail</span> = <span class="ruby-string">&quot;http://&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">thumbnail</span>
  <span class="ruby-keyword">end</span>
              <span class="ruby-identifier">resource_name</span> = <span class="ruby-identifier">title</span>
              <span class="ruby-identifier">found</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find_by_resource_name</span>(<span class="ruby-identifier">resource_name</span>)
              <span class="ruby-identifier">suffix</span> = <span class="ruby-value">1</span>
              <span class="ruby-keyword">while</span> <span class="ruby-identifier">found</span> <span class="ruby-keyword">do</span>
                      <span class="ruby-identifier">resource_name</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;#{suffix}&quot;</span>
                      <span class="ruby-identifier">found</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find_by_resource_name</span>(<span class="ruby-identifier">resource_name</span>)
                      <span class="ruby-identifier">suffix</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-identifier">params</span> = { <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>, <span class="ruby-value">:resource_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resource_name</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_id</span>, <span class="ruby-value">:thumbnail</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">thumbnail</span>, <span class="ruby-value">:visible_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">transform_url</span>(<span class="ruby-identifier">url</span>), <span class="ruby-value">:is_published</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-value">:license_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_default_license</span>() }
              <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>] = <span class="ruby-identifier">group_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">group_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
              <span class="ruby-identifier">params</span>[<span class="ruby-value">:cluster_id</span>] = <span class="ruby-identifier">cluster_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">insert_example_page</span>(<span class="ruby-value">1</span>)
  <span class="ruby-comment">#exhibit.insert_example_page(2)</span>
              <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">reset_fonts_to_default</span>()
              <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">bump_last_change</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">exhibit</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- factory-source -->
          
        </div>

        

        
      </div><!-- factory-method -->

    
      <div id="method-c-find_by_element_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_by_element_id</span><span
            class="method-args">(element_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_by_element_id-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_by_element_id</span>(<span class="ruby-identifier">element_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">element_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">element_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">element</span> = <span class="ruby-constant">ExhibitElement</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">element_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-constant">ExhibitPage</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_page_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_id</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_by_element_id-source -->
          
        </div>

        

        
      </div><!-- find_by_element_id-method -->

    
      <div id="method-c-find_by_illustration_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_by_illustration_id</span><span
            class="method-args">(illustration_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_by_illustration_id-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 193</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_by_illustration_id</span>(<span class="ruby-identifier">illustration_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">illustration_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">illustration</span> = <span class="ruby-constant">ExhibitIllustration</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">illustration_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_by_element_id</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">exhibit_element_id</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_by_illustration_id-source -->
          
        </div>

        

        
      </div><!-- find_by_illustration_id-method -->

    
      <div id="method-c-get_all_published" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_published</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_all_published-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 336</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_all_published</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">'is_published &lt;&gt; 0'</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_all_published-source -->
          
        </div>

        

        
      </div><!-- get_all_published-method -->

    
      <div id="method-c-get_default_license" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_default_license</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO-PER: All the license stuff can be refactored now that sharing and
license have been separated into two variables. license_type can only be
between 1-6 now, so the zero cases arenâ€™t ever used.</p>
          

          
          <div class="method-source-code" id="get_default_license-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 230</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_default_license</span>()
        <span class="ruby-keyword">return</span> <span class="ruby-value">4</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_default_license-source -->
          
        </div>

        

        
      </div><!-- get_default_license-method -->

    
      <div id="method-c-get_exhibits_in_group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_exhibits_in_group</span><span
            class="method-args">(group, cluster, user_id, sort_by)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_exhibits_in_group-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1068</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_exhibits_in_group</span>(<span class="ruby-identifier">group</span>, <span class="ruby-identifier">cluster</span>, <span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">sort_by</span>)
        <span class="ruby-comment"># if the cluster exists, we want all exhibits in that cluster; if it does not, we want all exhibits that aren't in a cluster.</span>
        <span class="ruby-comment"># We want all public exhibits, and if the user is a member of the group, also the exhibits just visible to the group.</span>
        <span class="ruby-identifier">is_member</span> = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">is_member</span>(<span class="ruby-identifier">user_id</span>)
        <span class="ruby-identifier">is_editor</span> = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">can_edit</span>(<span class="ruby-identifier">user_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_member</span>
                        <span class="ruby-identifier">exes</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&quot;group_id = ? AND is_published &lt;&gt; 0 AND cluster_id IS NULL&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>])
                        <span class="ruby-identifier">exhibits</span> = []
                        <span class="ruby-keyword">for</span> <span class="ruby-identifier">ex</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">exes</span>
                                <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">author</span> = <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">get_apparent_author_name</span>()
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editor_limit_visibility</span> <span class="ruby-operator">==</span> <span class="ruby-string">'group'</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">group_only</span> = <span class="ruby-keyword">true</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editors_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ex</span>)
                                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_editor</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">group_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editors_only</span> = <span class="ruby-keyword">true</span>
                                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ex</span>)
                                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-value">4</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">group_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editors_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ex</span>)
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&quot;group_id = ? AND is_published = 1 AND (editor_limit_visibility IS NULL OR editor_limit_visibility &lt;&gt; 'group') AND cluster_id IS NULL&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>])
                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ex</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">author</span> = <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">get_apparent_author_name</span>()
                        }
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_member</span>
                        <span class="ruby-identifier">exes</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&quot;group_id = ? AND is_published &lt;&gt; 0 AND cluster_id = ?&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">id</span>])
                        <span class="ruby-identifier">exhibits</span> = []
                        <span class="ruby-keyword">for</span> <span class="ruby-identifier">ex</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">exes</span>
                                <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">author</span> = <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">get_apparent_author_name</span>()
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editor_limit_visibility</span> <span class="ruby-operator">==</span> <span class="ruby-string">'group'</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">group_only</span> = <span class="ruby-keyword">true</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editors_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ex</span>)
                                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_editor</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">group_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editors_only</span> = <span class="ruby-keyword">true</span>
                                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ex</span>)
                                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-value">4</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">group_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">editors_only</span> = <span class="ruby-keyword">false</span>
                                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ex</span>)
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&quot;group_id = ? AND (is_published = 1 OR is_published = 5) AND (editor_limit_visibility IS NULL OR editor_limit_visibility &lt;&gt; 'group') AND cluster_id = ?&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">id</span>])
                        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ex</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">author</span> = <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">get_apparent_author_name</span>()
                        }
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">case</span> <span class="ruby-identifier">sort_by</span>
        <span class="ruby-keyword">when</span> <span class="ruby-string">'last_change'</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">exhibits</span> = <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">last_change</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">last_change</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-string">'title'</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">exhibits</span> = <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">title</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-string">'author'</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">exhibits</span> = <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">author</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">author</span> }
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">exhibits</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_exhibits_in_group-source -->
          
        </div>

        

        
      </div><!-- get_exhibits_in_group-method -->

    
      <div id="method-c-get_license_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_license_info</span><span
            class="method-args">(add_inherit, group_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_license_info-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 344</span>
    <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_license_info</span>(<span class="ruby-identifier">add_inherit</span>, <span class="ruby-identifier">group_id</span>)
            <span class="ruby-identifier">ret</span> = []
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">add_inherit</span>
               <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">group_id</span>)
               <span class="ruby-identifier">group_label</span> = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">get_exhibits_label</span>().<span class="ruby-identifier">downcase</span>()
                    <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Each #{group_label} can specify a license.&quot;</span>, <span class="ruby-value">:icon</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_icon_url</span>(<span class="ruby-value">0</span>), <span class="ruby-value">:abbrev</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_static</span>(<span class="ruby-value">0</span>) })
            <span class="ruby-keyword">end</span>
<span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">6</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_text</span>(<span class="ruby-identifier">i</span>), <span class="ruby-value">:icon</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_icon_url</span>(<span class="ruby-identifier">i</span>), <span class="ruby-value">:abbrev</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_static</span>(<span class="ruby-identifier">i</span>) })
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>
    <span class="ruby-keyword">end</span></pre>
          </div><!-- get_license_info-source -->
          
        </div>

        

        
      </div><!-- get_license_info-method -->

    
      <div id="method-c-get_pending_exhibits_in_group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pending_exhibits_in_group</span><span
            class="method-args">(group, cluster, user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_pending_exhibits_in_group-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1134</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_pending_exhibits_in_group</span>(<span class="ruby-identifier">group</span>, <span class="ruby-identifier">cluster</span>, <span class="ruby-identifier">user_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">can_edit</span>(<span class="ruby-identifier">user_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-identifier">pending_exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;group_id = ? AND cluster_id IS NULL AND is_published = 2&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>])
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">pending_exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;group_id = ? AND cluster_id = ? AND is_published = 2&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">id</span>])
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">cluster</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-identifier">pending_exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;group_id = ? AND cluster_id IS NULL AND is_published = 2 AND user_id = ?&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">user_id</span>])
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">pending_exhibits</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;group_id = ? AND cluster_id = ? AND is_published = 2 AND user_id = ?&quot;</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">cluster</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">user_id</span>])
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">pending_exhibits</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_pending_exhibits_in_group-source -->
          
        </div>

        

        
      </div><!-- get_pending_exhibits_in_group-method -->

    
      <div id="method-c-get_referencing_exhibits" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_referencing_exhibits</span><span
            class="method-args">(uri, curr_user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_referencing_exhibits-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1303</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_referencing_exhibits</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">curr_user</span>)
        <span class="ruby-identifier">exhibits</span> = <span class="ruby-constant">ExhibitObject</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">uri</span><span class="ruby-operator">:</span> <span class="ruby-identifier">uri</span>})
        <span class="ruby-identifier">user_name</span> = <span class="ruby-identifier">curr_user</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">curr_user</span>.<span class="ruby-identifier">fullname</span> <span class="ruby-operator">:</span> <span class="ruby-string">''</span>
        <span class="ruby-identifier">rows</span> = []
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">exhibit</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">exhibits</span>
                <span class="ruby-comment"># We only want to display the exhibit if it can be viewed, so only if it is owned by the current user, or is public</span>
                <span class="ruby-comment"># We only want to have the edit link if it is owned by the current user.</span>
                <span class="ruby-identifier">real_exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">id</span>)
                <span class="ruby-identifier">owner</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">real_exhibit</span>.<span class="ruby-identifier">user_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">owner</span>.<span class="ruby-identifier">username</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">real_exhibit</span>.<span class="ruby-identifier">published?</span>
                        <span class="ruby-identifier">edit_path</span> = <span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">can_edit</span>(<span class="ruby-identifier">curr_user</span>, <span class="ruby-identifier">real_exhibit</span>.<span class="ruby-identifier">id</span>)
                                <span class="ruby-identifier">edit_path</span> = <span class="ruby-node">&quot;/builder/#{real_exhibit.id}&quot;</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">real_exhibit</span>.<span class="ruby-identifier">title</span>,
                                                <span class="ruby-identifier">view_path</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;/exhibits/#{real_exhibit.visible_url != nil &amp;&amp; real_exhibit.visible_url.length &gt; 0 ? real_exhibit.visible_url : real_exhibit.id}&quot;</span>,
                                                <span class="ruby-identifier">edit_path</span><span class="ruby-operator">:</span> <span class="ruby-identifier">edit_path</span>
                                          })
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span> <span class="ruby-comment"># each exhibit</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">rows</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_referencing_exhibits-source -->
          
        </div>

        

        
      </div><!-- get_referencing_exhibits-method -->

    
      <div id="method-c-get_sharing_icon_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_icon_url</span><span
            class="method-args">(license_type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_icon_url-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 321</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_icon_url</span>(<span class="ruby-identifier">license_type</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">license_type</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">license_type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;&lt;img alt='Creative Commons License' style='border-width:0' src='http://i.creativecommons.org/l/#{get_sharing_license_type(license_type)}/3.0/us/88x31.png' /&gt;&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">view_context</span>.<span class="ruby-identifier">image_tag</span>(<span class="ruby-string">'not_shared.jpg'</span>, <span class="ruby-identifier">alt</span><span class="ruby-operator">:</span> <span class="ruby-string">'Creative Commons License'</span>, <span class="ruby-identifier">height</span><span class="ruby-operator">:</span> <span class="ruby-string">'31'</span>, <span class="ruby-identifier">style</span><span class="ruby-operator">:</span> <span class="ruby-string">'border-width:0'</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_icon_url-source -->
          
        </div>

        

        
      </div><!-- get_sharing_icon_url-method -->

    
      <div id="method-c-get_sharing_license_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_license_type</span><span
            class="method-args">(license_type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_license_type-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 295</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_license_type</span>(<span class="ruby-identifier">license_type</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">license_type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;by&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;by-sa&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">3</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;by-nd&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">4</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;by-nc&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">5</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;by-nc-sa&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">6</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;by-nc-nd&quot;</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;ERROR&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_license_type-source -->
          
        </div>

        

        
      </div><!-- get_sharing_license_type-method -->

    
      <div id="method-c-get_sharing_static" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_static</span><span
            class="method-args">(s)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_static-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 261</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_static</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>
    <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Attribution&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Attribution Share Alike&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">3</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Attribution No Derivatives&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">4</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Attribution Non-Commercial&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">5</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Attribution Non-Commercial Share Alike&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">6</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Attribution Non-Commercial No Derivatives&quot;</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_static-source -->
          
        </div>

        

        
      </div><!-- get_sharing_static-method -->

    
      <div id="method-c-get_sharing_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_text</span><span
            class="method-args">(s)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_text-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_text</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>
    <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This license lets others distribute, remix, tweak, and build upon your work, even commercially, as long as they credit you for the original creation. This is the most accommodating of licenses offered, in terms of what others can do with your works licensed under Attribution.&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This license lets others remix, tweak, and build upon your work even for commercial reasons, as long as they credit you and license their new creations under the identical terms. This license is often compared to open source software licenses. All new works based on yours will carry the same license, so any derivatives will also allow commercial use.&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">3</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This license allows for redistribution, commercial and non-commercial, as long as it is passed along unchanged and in whole, with credit to you.&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">4</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This license lets others remix, tweak, and build upon your work non-commercially, and although their new works must also acknowledge you and be non-commercial, they donâ€™t have to license their derivative works on the same terms.&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">5</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This license lets others remix, tweak, and build upon your work non-commercially, as long as they credit you and license their new creations under the identical terms. Others can download and redistribute your work just like the by-nc-nd license, but they can also translate, make remixes, and produce new stories based on your work. All new work based on yours will carry the same license, so any derivatives will also be non-commercial in nature.&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">6</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This license is the most restrictive of our six main licenses, allowing redistribution. This license is often called the â€œfree advertisingâ€ license because it allows others to download your works and share them with others as long as they mention you and link back to you, but they canâ€™t change them in any way or use them commercially.&quot;</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_text-source -->
          
        </div>

        

        
      </div><!-- get_sharing_text-method -->

    
      <div id="method-c-has_footnotes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_footnotes</span><span
            class="method-args">(id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>def self.find_by_section_id(section_id)</p>

<pre>section = ExhibitSection.find(section_id)
page = ExhibitPage.find(section.exhibit_page_id)
return Exhibit.find(page.exhibit_id)</pre>

<p>end</p>
          

          
          <div class="method-source-code" id="has_footnotes-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 381</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_footnotes</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-identifier">exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find_by_visible_url</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-identifier">exhibit</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">page</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">exhibit_pages</span>
                <span class="ruby-keyword">for</span> <span class="ruby-identifier">element</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_elements</span>
                        <span class="ruby-keyword">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_element_layout_type</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'header'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">1</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pics'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">for</span> <span class="ruby-identifier">illustration</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>
                                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">illustration</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'blockquote'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- has_footnotes-source -->
          
        </div>

        

        
      </div><!-- has_footnotes-method -->

    
      <div id="method-c-index_all_peer_reviewed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index_all_peer_reviewed</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="index_all_peer_reviewed-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 805</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">index_all_peer_reviewed</span>
        <span class="ruby-identifier">groups</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">group_type</span><span class="ruby-operator">:</span> <span class="ruby-string">'peer-reviewed'</span>})
        <span class="ruby-identifier">exhibits</span> = []
        <span class="ruby-identifier">groups</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">exhibits</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">where</span>({<span class="ruby-identifier">group_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_published</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>})
        }
        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">exhibit</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">should_commit</span> = <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">id</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Indexing: #{exhibit.title}#{' (commit)' if should_commit }&quot;</span>
                <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">index_exhibit</span>(<span class="ruby-identifier">should_commit</span>)
        }
<span class="ruby-keyword">end</span></pre>
          </div><!-- index_all_peer_reviewed-source -->
          
        </div>

        

        
      </div><!-- index_all_peer_reviewed-method -->

    
      <div id="method-c-is_license_specified" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_license_specified</span><span
            class="method-args">(license_type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="is_license_specified-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 340</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_license_specified</span>(<span class="ruby-identifier">license_type</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">license_type</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">license_type</span> <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">license_type</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_license_specified-source -->
          
        </div>

        

        
      </div><!-- is_license_specified-method -->

    
      <div id="method-c-js_array_of_all_public_exhibits" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">js_array_of_all_public_exhibits</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="js_array_of_all_public_exhibits-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">js_array_of_all_public_exhibits</span>()
  <span class="ruby-identifier">exhibits</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_all_published</span>()
  <span class="ruby-identifier">str</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">exhibit</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">exhibits</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;,\n&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;{ title: \&quot;#{CGI.escapeHTML(exhibit.title)}\&quot;, thumbnail: \&quot;#{exhibit.thumbnail}\&quot; }&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">str</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- js_array_of_all_public_exhibits-source -->
          
        </div>

        

        
      </div><!-- js_array_of_all_public_exhibits-method -->

    
      <div id="method-c-process_input_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_input_file</span><span
            class="method-args">(file)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="process_input_file-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1221</span>
        <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_input_file</span>(<span class="ruby-identifier">file</span>)
                <span class="ruby-identifier">root_folder</span> = <span class="ruby-node">&quot;#{Rails.root}/tmp/exhibit_import&quot;</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">%xmkdir #{root_folder}`</span>
                <span class="ruby-identifier">this_folder</span> = <span class="ruby-node">&quot;#{root_folder}/#{Time.now.to_s.gsub(/\W/, '_')}&quot;</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">%xmkdir #{this_folder}`</span>
                <span class="ruby-identifier">filename</span> = <span class="ruby-node">&quot;#{file.original_filename.gsub(' ','_')}.gz&quot;</span>
                <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{this_folder}/#{filename}&quot;</span>, <span class="ruby-string">&quot;wb&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>) }
<span class="ruby-comment">#               puts `cd #{this_folder} &amp;&amp; tar xvfz #{filename}`</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">%xcd #{this_folder} &amp;&amp; unzip #{filename}`</span>

                <span class="ruby-identifier">footnotes</span> = {}
                <span class="ruby-keyword">begin</span>
                        <span class="ruby-identifier">footnotes_doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{this_folder}/word/footnotes.xml&quot;</span>))
                        <span class="ruby-comment">#footnotes_doc = REXML::Document.new( File.new(&quot;#{this_folder}/word/footnotes.xml&quot;) )</span>
                        <span class="ruby-identifier">footnotes_doc</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'//w:p'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">para</span><span class="ruby-operator">|</span>
                        <span class="ruby-comment">#REXML::XPath.each( footnotes_doc, &quot;//w:p&quot; ){ |para|</span>
                                <span class="ruby-identifier">par</span> = <span class="ruby-identifier">para</span>.<span class="ruby-identifier">parent</span>
                                <span class="ruby-identifier">index</span> = <span class="ruby-string">'F'</span><span class="ruby-operator">+</span><span class="ruby-identifier">par</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">to_s</span>
                                <span class="ruby-identifier">str</span> = <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">index</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">index</span>] <span class="ruby-operator">:</span> <span class="ruby-string">''</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_word_paragraph</span>(<span class="ruby-identifier">para</span>, <span class="ruby-keyword">nil</span>)[<span class="ruby-value">:text</span>]
                                <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">index</span>] = <span class="ruby-identifier">str</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        }
                <span class="ruby-keyword">rescue</span>
                        <span class="ruby-comment"># It's ok for the footnotes file doesn't exist.</span>
                <span class="ruby-keyword">end</span>

                <span class="ruby-comment"># add the endnotes to the footnotes -- they are the same to us</span>
                <span class="ruby-comment"># For each &lt;w:endnote w:id=&quot;9999&quot;&gt;&lt;w:p&gt; element, concatenate all of its &lt;w:t&gt; text. Note that the &lt;w:t&gt; elements might not be direct descendants.</span>
                <span class="ruby-keyword">begin</span>
                        <span class="ruby-identifier">endnotes_doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{this_folder}/word/endnotes.xml&quot;</span>))
                        <span class="ruby-identifier">endnotes_doc</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'//w:p'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">para</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">par</span> = <span class="ruby-identifier">para</span>.<span class="ruby-identifier">parent</span>
                                <span class="ruby-identifier">index</span> = <span class="ruby-string">'E'</span><span class="ruby-operator">+</span><span class="ruby-identifier">par</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">to_s</span>
                                <span class="ruby-identifier">str</span> = <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">index</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">index</span>] <span class="ruby-operator">:</span> <span class="ruby-string">''</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_word_paragraph</span>(<span class="ruby-identifier">para</span>, <span class="ruby-keyword">nil</span>)[<span class="ruby-value">:text</span>]
                                <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">index</span>] = <span class="ruby-identifier">str</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        }
                <span class="ruby-keyword">rescue</span>
                        <span class="ruby-comment"># It's ok for the footnotes file doesn't exist.</span>
                <span class="ruby-keyword">end</span>

                <span class="ruby-keyword">begin</span>
                        <span class="ruby-comment"># If this file doesn't exist, the uploaded file was probably not a word file.</span>
                        <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{this_folder}/word/document.xml&quot;</span>))
                <span class="ruby-keyword">rescue</span>
                        <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;The uploaded file is not in docx format.&quot;</span>
                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">paragraphs</span> = []
                <span class="ruby-identifier">in_blockquote</span> = <span class="ruby-keyword">false</span>
                <span class="ruby-identifier">in_dropcap</span> = <span class="ruby-keyword">false</span>
                <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'//w:p'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">para</span><span class="ruby-operator">|</span>
                <span class="ruby-comment">#REXML::XPath.each( doc, &quot;//w:p&quot; ){ |para|</span>
                        <span class="ruby-identifier">p</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_word_paragraph</span>(<span class="ruby-identifier">para</span>, <span class="ruby-identifier">footnotes</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'dropcap'</span>
                                <span class="ruby-identifier">in_dropcap</span> = <span class="ruby-keyword">true</span>
                                <span class="ruby-identifier">in_blockquote</span> = <span class="ruby-keyword">false</span>
                                <span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'text'</span>, <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:text</span>] })
                        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'blockquote'</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_blockquote</span>
                                        <span class="ruby-identifier">paragraphs</span>[<span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-value">:text</span>] = <span class="ruby-identifier">paragraphs</span>[<span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-value">:text</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;br /&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:text</span>]
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:text</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                                <span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">p</span>)
                                                <span class="ruby-identifier">in_blockquote</span> = <span class="ruby-keyword">true</span>
                                        <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">in_dropcap</span> = <span class="ruby-keyword">false</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_dropcap</span>
                                        <span class="ruby-identifier">paragraphs</span>[<span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-value">:text</span>] = <span class="ruby-string">&quot;&lt;div class=\&quot;drop_cap\&quot;&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">paragraphs</span>[<span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-value">:text</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:text</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;/div&gt;&quot;</span>
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">p</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>[<span class="ruby-value">:text</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">in_blockquote</span> = <span class="ruby-keyword">false</span>
                                <span class="ruby-identifier">in_dropcap</span> = <span class="ruby-keyword">false</span>
                        <span class="ruby-keyword">end</span>
                }
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clean_up_word_file</span>(<span class="ruby-identifier">this_folder</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">paragraphs</span>
        <span class="ruby-keyword">end</span></pre>
          </div><!-- process_input_file-source -->
          
        </div>

        

        
      </div><!-- process_input_file-method -->

    
      <div id="method-c-process_word_paragraph" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_word_paragraph</span><span
            class="method-args">(para, footnotes)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="process_word_paragraph-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1174</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_word_paragraph</span>(<span class="ruby-identifier">para</span>, <span class="ruby-identifier">footnotes</span>)
        <span class="ruby-identifier">str</span> = <span class="ruby-string">''</span>
        <span class="ruby-identifier">type</span> = <span class="ruby-string">'text'</span>
        <span class="ruby-identifier">para</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:pPr'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:ind'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">type</span> = <span class="ruby-string">'blockquote'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'left'</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'left'</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">200</span> }
                <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:framePr'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">type</span> = <span class="ruby-string">'dropcap'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'dropCap'</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'dropCap'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;drop&quot;</span> }
        }
        <span class="ruby-identifier">para</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">name</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">name</span>()
                <span class="ruby-identifier">hyperlink</span> = <span class="ruby-keyword">false</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">'hyperlink'</span>
                        <span class="ruby-identifier">hyperlink</span> = <span class="ruby-keyword">true</span>
                        <span class="ruby-identifier">ns</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:r'</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">ns</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ns</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                <span class="ruby-identifier">r</span> = <span class="ruby-identifier">ns</span>[<span class="ruby-value">0</span>]
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">name</span>() <span class="ruby-operator">==</span> <span class="ruby-string">'r'</span>
                        <span class="ruby-identifier">has_underline</span> = <span class="ruby-keyword">false</span>
                        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:rPr/w:u'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">has_underline</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'val'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'none'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'val'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'off'</span> }
                        <span class="ruby-identifier">has_italics</span> = <span class="ruby-keyword">false</span>
                        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:rPr/w:i'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">has_italics</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'val'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'none'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'val'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'off'</span> }
                        <span class="ruby-identifier">has_bold</span> = <span class="ruby-keyword">false</span>
                        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:rPr/w:b'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">has_bold</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'val'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'none'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'val'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'off'</span> }
                        <span class="ruby-identifier">footnote_id</span> = <span class="ruby-keyword">nil</span>
                        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:footnoteReference'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">footnote_id</span> = <span class="ruby-string">'F'</span><span class="ruby-operator">+</span><span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">to_s</span> }
                        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:endnoteReference'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">footnote_id</span> = <span class="ruby-string">'E'</span><span class="ruby-operator">+</span><span class="ruby-identifier">x</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">to_s</span> }
                        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">'w:t'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;span title=\&quot;External Link: #{t.text}\&quot; real_link=\&quot;#{t.text}\&quot; class=\&quot;ext_linklike\&quot;&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">hyperlink</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;span style=\&quot;text-decoration: underline;\&quot;&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_underline</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;strong&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_bold</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;em&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_italics</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">text</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;/em&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_italics</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;/strong&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_bold</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_underline</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">hyperlink</span>
                        }
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">footnotes</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">footnote_id</span>]
                                <span class="ruby-identifier">footnote_template</span> = <span class="ruby-node">&quot;&lt;a href=\&quot;#\&quot; onclick='var footnote = $(this).next(); new MessageBoxDlg(\&quot;Footnote\&quot;, footnote.innerHTML); return false;' class=\&quot;superscript\&quot;&gt;@&lt;/a&gt;&lt;span class=\&quot;hidden\&quot;&gt;$$$$&lt;/span&gt;&quot;</span>
                                <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">footnote_template</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-string">'$$$$'</span>, <span class="ruby-identifier">footnotes</span>[<span class="ruby-identifier">footnote_id</span>])
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-keyword">return</span> { <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">str</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- process_word_paragraph-source -->
          
        </div>

        

        
      </div><!-- process_word_paragraph-method -->

    
      <div id="method-c-transform_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">transform_url</span><span
            class="method-args">(url)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="transform_url-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">transform_url</span>(<span class="ruby-identifier">url</span>)
  <span class="ruby-comment"># The legal characters are: Letters (A-Z and a-z), numbers (0-9) and the characters '-', '~' and '_'</span>
  <span class="ruby-comment"># All other characters are replaced by underscores, then multiple underscores are replaced by one underscore.</span>
  <span class="ruby-comment"># This never returns more than 30 characters.</span>

      <span class="ruby-keyword">return</span> <span class="ruby-identifier">url</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">url</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">url</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">'^A-Za-z0-9\-\~'</span>, <span class="ruby-string">'_'</span>)
  <span class="ruby-comment"># remove more than one underline in a row</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">url</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/_+/</span>, <span class="ruby-string">'_'</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">url</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">29</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">30</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">url</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- transform_url-source -->
          
        </div>

        

        
      </div><!-- transform_url-method -->

    
      <div id="method-c-unindex_all_exhibits" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unindex_all_exhibits</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="unindex_all_exhibits-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 843</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">unindex_all_exhibits</span>()
        <span class="ruby-identifier">@@solr</span> = <span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">factory_create</span>(<span class="ruby-keyword">false</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">@@solr</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">exhibits</span> = <span class="ruby-identifier">@@solr</span>.<span class="ruby-identifier">get_exhibits</span>()
        <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">exhibit</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">id</span> = <span class="ruby-identifier">exhibit</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>).<span class="ruby-identifier">last</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Removing exhibit #{id}: #{exhibit}&quot;</span>
                <span class="ruby-identifier">@@solr</span>.<span class="ruby-identifier">delete_exhibit</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">exhibit</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">exhibits</span>.<span class="ruby-identifier">last</span>)  <span class="ruby-comment"># just commit on the last one</span>
        }
<span class="ruby-keyword">end</span></pre>
          </div><!-- unindex_all_exhibits-source -->
          
        </div>

        

        
      </div><!-- unindex_all_exhibits-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-adjust_indexing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">adjust_indexing</span><span
            class="method-args">(action, should_commit)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="adjust_indexing-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 969</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">adjust_indexing</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">should_commit</span>)
        <span class="ruby-keyword">case</span> <span class="ruby-identifier">action</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:group_becomes_peer_reviewed</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">index_exhibit</span>(<span class="ruby-identifier">should_commit</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:group_leaves_peer_reviewed</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">unindex_exhibit</span>(<span class="ruby-identifier">should_commit</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:publishing</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">index_exhibit</span>(<span class="ruby-identifier">should_commit</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>).<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:unpublishing</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">unindex_exhibit</span>(<span class="ruby-identifier">should_commit</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>).<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:limit_to_group</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">unindex_exhibit</span>(<span class="ruby-identifier">should_commit</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>).<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:limit_to_everyone</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">index_exhibit</span>(<span class="ruby-identifier">should_commit</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>).<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:leave_group</span> <span class="ruby-keyword">then</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>
                        <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
                                <span class="ruby-identifier">unindex_exhibit</span>(<span class="ruby-identifier">should_commit</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- adjust_indexing-source -->
          
        </div>

        

        
      </div><!-- adjust_indexing-method -->

    
      <div id="method-i-bump_last_change" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bump_last_change</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="bump_last_change-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 666</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bump_last_change</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_change</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- bump_last_change-source -->
          
        </div>

        

        
      </div><!-- bump_last_change-method -->

    
      <div id="method-i-can_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_view</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="can_view-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_view</span>(<span class="ruby-identifier">user</span>)
        <span class="ruby-comment"># The user can view the exhibit if:</span>
        <span class="ruby-comment"># - they are the author or an admin</span>
        <span class="ruby-comment"># - the exhibit is not in a group and is published</span>
        <span class="ruby-comment"># - the exhibit is in a group and the group allows it</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">role_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'admin'</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">alias_id</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">can_view_exhibit</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">user</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_view-source -->
          
        </div>

        

        
      </div><!-- can_view-method -->

    
      <div id="method-i-count_footnotes_from_illustration" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">count_footnotes_from_illustration</span><span
            class="method-args">(illustration)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="count_footnotes_from_illustration-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 427</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">illustration</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Textual Illustration'</span>
                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- count_footnotes_from_illustration-source -->
          
        </div>

        

        
      </div><!-- count_footnotes_from_illustration-method -->

    
      <div id="method-i-count_footnotes_from_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">count_footnotes_from_text</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="count_footnotes_from_text-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 534</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">text</span>)
        <span class="ruby-comment"># We are scanning for footnotes that have the following structure:</span>
        <span class="ruby-identifier">footnote_prefix</span> = <span class="ruby-string">'&lt;a href=&quot;#&quot; onclick=\var footnote = $(this).next(); new MessageBoxDlg(&quot;Footnote&quot;, footnote.innerHTML); return false;\ class=&quot;superscript&quot;&gt;'</span>
        <span class="ruby-comment"># footnote number</span>
        <span class="ruby-identifier">footnote_mid</span> = <span class="ruby-string">'&lt;/a&gt;&lt;span class=&quot;hidden&quot;&gt;'</span>
        <span class="ruby-comment"># actual footnote</span>
        <span class="ruby-identifier">footnote_end</span> = <span class="ruby-string">'&lt;/span&gt;'</span>

        <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
        <span class="ruby-identifier">arr</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">footnote_prefix</span>)
        <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">shift</span>     <span class="ruby-comment"># the first element won't have a footnote in it.</span>
        <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">arr2</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">footnote_mid</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr2</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
                        <span class="ruby-identifier">arr3</span> = <span class="ruby-identifier">arr2</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>(<span class="ruby-identifier">footnote_end</span>)
                        <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- count_footnotes_from_text-source -->
          
        </div>

        

        
      </div><!-- count_footnotes_from_text-method -->

    
      <div id="method-i-delete_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_page</span><span
            class="method-args">(page_num)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete_page-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_page</span>(<span class="ruby-identifier">page_num</span>)
  <span class="ruby-identifier">curr_page</span> = <span class="ruby-identifier">exhibit_pages</span>[<span class="ruby-identifier">page_num</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
  <span class="ruby-identifier">curr_page</span>.<span class="ruby-identifier">remove_from_list</span>()
  <span class="ruby-identifier">curr_page</span>.<span class="ruby-identifier">destroy</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_page-source -->
          
        </div>

        

        
      </div><!-- delete_page-method -->

    
      <div id="method-i-extract_footnotes_from_illustration" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract_footnotes_from_illustration</span><span
            class="method-args">(illustration)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="extract_footnotes_from_illustration-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 417</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">illustration</span>)
        <span class="ruby-identifier">footnotes</span> = []
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Textual Illustration'</span>
                <span class="ruby-identifier">footnotes</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span>).<span class="ruby-identifier">footnote</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span>).<span class="ruby-identifier">footnote</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">footnotes</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- extract_footnotes_from_illustration-source -->
          
        </div>

        

        
      </div><!-- extract_footnotes_from_illustration-method -->

    
      <div id="method-i-extract_footnotes_from_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract_footnotes_from_text</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="extract_footnotes_from_text-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 513</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">text</span>)
        <span class="ruby-comment"># We are scanning for footnotes that have the following structure:</span>
        <span class="ruby-identifier">footnote_prefix</span> = <span class="ruby-string">'&lt;a href=&quot;#&quot; onclick=\var footnote = $(this).next(); new MessageBoxDlg(&quot;Footnote&quot;, footnote.innerHTML); return false;\ class=&quot;superscript&quot;&gt;'</span>
        <span class="ruby-comment"># footnote number</span>
        <span class="ruby-identifier">footnote_mid</span> = <span class="ruby-string">'&lt;/a&gt;&lt;span class=&quot;hidden&quot;&gt;'</span>
        <span class="ruby-comment"># actual footnote</span>
        <span class="ruby-comment"># '&lt;/span&gt;'</span>

        <span class="ruby-identifier">footnotes</span> = []
        <span class="ruby-identifier">arr</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">footnote_prefix</span>)
        <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">shift</span>     <span class="ruby-comment"># the first element won't have a footnote in it.</span>
        <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">arr2</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">footnote_mid</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr2</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
                        <span class="ruby-identifier">foot</span> = <span class="ruby-identifier">extract_up_to_matching_span</span>(<span class="ruby-identifier">arr2</span>[<span class="ruby-value">1</span>])
                        <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">foot</span>)
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">footnotes</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- extract_footnotes_from_text-source -->
          
        </div>

        

        
      </div><!-- extract_footnotes_from_text-method -->

    
      <div id="method-i-extract_links_from_illustration" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract_links_from_illustration</span><span
            class="method-args">(illustration)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="extract_links_from_illustration-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 505</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">illustration</span>)
        <span class="ruby-identifier">links</span> = []
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Textual Illustration'</span>
                <span class="ruby-identifier">links</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">links</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- extract_links_from_illustration-source -->
          
        </div>

        

        
      </div><!-- extract_links_from_illustration-method -->

    
      <div id="method-i-extract_links_from_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract_links_from_text</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="extract_links_from_text-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 465</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">text</span>)
        <span class="ruby-comment"># We are scanning for footnotes that have the following structure:</span>
        <span class="ruby-comment">#&lt;span title=&quot;XXX&quot; real_link=&quot;YYY&quot; class=&quot;nines_linklike&quot;&gt;ZZZ&lt;/span&gt;</span>
        <span class="ruby-comment">#&lt;span title=&quot;XXX&quot; real_link=&quot;YYY&quot; class=&quot;ext_linklike&quot;&gt;ZZZ&lt;/span&gt;</span>
        <span class="ruby-comment"># We are trying to extract the YYY and the ZZZ</span>
        <span class="ruby-identifier">link_prefix</span> = <span class="ruby-string">&quot;&lt;span title=\&quot;&quot;</span>
        <span class="ruby-identifier">link_mid</span> = <span class="ruby-string">&quot;real_link=\&quot;&quot;</span>
        <span class="ruby-identifier">link_signature</span> = <span class="ruby-string">&quot;class=\&quot;nines_linklike\&quot;&gt;&quot;</span>
        <span class="ruby-identifier">link_signature2</span> = <span class="ruby-string">&quot;class=\&quot;ext_linklike\&quot;&gt;&quot;</span>

        <span class="ruby-identifier">links</span> = []
        <span class="ruby-identifier">arr</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">link_prefix</span>)
        <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">shift</span>     <span class="ruby-comment"># the first element won't have a link in it.</span>
        <span class="ruby-comment"># this may be a false alarm, so just ignore the item if the rest of it doesn't match</span>
        <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">arr2</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">link_mid</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr2</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
                        <span class="ruby-comment">#arr2[1] now contains the url, plus the rest of the unparsed part.</span>
                        <span class="ruby-identifier">arr3</span> = <span class="ruby-identifier">arr2</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">'&quot;'</span>)
                        <span class="ruby-identifier">url</span> = <span class="ruby-identifier">arr3</span>[<span class="ruby-value">0</span>]
                        <span class="ruby-comment"># look for either link type</span>
                        <span class="ruby-identifier">arr3</span> = <span class="ruby-identifier">arr2</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>(<span class="ruby-identifier">link_signature</span>)
                        <span class="ruby-identifier">arr3</span> = <span class="ruby-identifier">arr2</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>(<span class="ruby-identifier">link_signature2</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr3</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr3</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
                                <span class="ruby-identifier">text</span> = <span class="ruby-identifier">extract_up_to_matching_span</span>(<span class="ruby-identifier">arr3</span>[<span class="ruby-value">1</span>])
                                <span class="ruby-identifier">cr</span> = <span class="ruby-constant">CachedProperty</span>.<span class="ruby-identifier">first</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&quot;name = ? AND value = ?&quot;</span>, <span class="ruby-string">'url'</span>, <span class="ruby-identifier">url</span> ])
                                <span class="ruby-identifier">name</span> = <span class="ruby-keyword">nil</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">cr</span>
                                        <span class="ruby-identifier">cr2</span> = <span class="ruby-constant">CachedProperty</span>.<span class="ruby-identifier">first</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&quot;name = ? AND cached_resource_id = ?&quot;</span>, <span class="ruby-string">'title'</span>, <span class="ruby-identifier">cr</span>.<span class="ruby-identifier">cached_resource_id</span> ])
                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">cr2</span>
                                                <span class="ruby-identifier">name</span> = <span class="ruby-identifier">cr2</span>.<span class="ruby-identifier">value</span>
                                        <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>, <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">url</span>, <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span> })
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">links</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- extract_links_from_text-source -->
          
        </div>

        

        
      </div><!-- extract_links_from_text-method -->

    
      <div id="method-i-fonts_match_defaults" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fonts_match_defaults</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="fonts_match_defaults-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fonts_match_defaults</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">header_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Arial'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">header_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'24'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">text_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Times New Roman'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">text_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'18'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">illustration_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Trebuchet MS'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">illustration_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'14'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption1_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Trebuchet MS'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption1_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'14'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption2_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Trebuchet MS'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption2_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'14'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">endnotes_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Times New Roman'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">endnotes_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'16'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">footnote_font_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Times New Roman'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">footnote_font_size</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'16'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- fonts_match_defaults-source -->
          
        </div>

        

        
      </div><!-- fonts_match_defaults-method -->

    
      <div id="method-i-get_all_footnotes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_footnotes</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_all_footnotes-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_all_footnotes</span>()
        <span class="ruby-identifier">footnotes</span> = []
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">page</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exhibit_pages</span>
                <span class="ruby-keyword">for</span> <span class="ruby-identifier">element</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_elements</span>
                        <span class="ruby-keyword">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_element_layout_type</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'header'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span>).<span class="ruby-identifier">footnote</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">1</span>]))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pics'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">for</span> <span class="ruby-identifier">illustration</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>
                                        <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">illustration</span>))
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'blockquote'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>))
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-comment"># this will happen if a new type is added but this method is not updated to handle it.</span>
                                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Unknown: #{element.exhibit_element_layout_type}&quot;</span>)
                        <span class="ruby-keyword">end</span>

                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">footnotes</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_all_footnotes-source -->
          
        </div>

        

        
      </div><!-- get_all_footnotes-method -->

    
      <div id="method-i-get_all_links" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_links</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_all_links-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 631</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_all_links</span>()
        <span class="ruby-identifier">pages</span> = []
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">page</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exhibit_pages</span>
                <span class="ruby-identifier">links</span> = []
                <span class="ruby-keyword">for</span> <span class="ruby-identifier">element</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_elements</span>
                        <span class="ruby-keyword">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_element_layout_type</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">1</span>]))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pics'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">for</span> <span class="ruby-identifier">illustration</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>
                                        <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">illustration</span>))
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'blockquote'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>))
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>]))
                                <span class="ruby-identifier">links</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">extract_links_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>))
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">links</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">pages</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_all_links-source -->
          
        </div>

        

        
      </div><!-- get_all_links-method -->

    
      <div id="method-i-get_all_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_text</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_all_text-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 853</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_all_text</span>()
        <span class="ruby-identifier">full_data</span> = []
        <span class="ruby-identifier">pages</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exhibit_pages</span>
        <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">elements</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_elements</span>
                <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>
                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span>
                                <span class="ruby-identifier">footnote</span> = <span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span>)
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">illustrations</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>
                        <span class="ruby-identifier">illustrations</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">illustration</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">alt_text</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">alt_text</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span>
                                        <span class="ruby-identifier">footnote</span> = <span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span>)
                                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span>
                                        <span class="ruby-identifier">footnote</span> = <span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span>)
                                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                <span class="ruby-keyword">end</span>
                        }
                }
        }
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; \n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_all_text-source -->
          
        </div>

        

        
      </div><!-- get_all_text-method -->

    
      <div id="method-i-get_apparent_author" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_apparent_author</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_apparent_author-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 671</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_apparent_author</span>()
        <span class="ruby-keyword">return</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>((<span class="ruby-keyword">self</span>.<span class="ruby-identifier">alias_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">alias_id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">alias_id</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_apparent_author-source -->
          
        </div>

        

        
      </div><!-- get_apparent_author-method -->

    
      <div id="method-i-get_apparent_author_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_apparent_author_email</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_apparent_author_email-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 696</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_apparent_author_email</span>()
        <span class="ruby-comment"># This gets the alias if there is one, and the real author if there isn't.</span>
        <span class="ruby-identifier">author_rec</span> = <span class="ruby-identifier">get_apparent_author</span>()
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">author_rec</span>.<span class="ruby-identifier">email</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_apparent_author_email-source -->
          
        </div>

        

        
      </div><!-- get_apparent_author_email-method -->

    
      <div id="method-i-get_apparent_author_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_apparent_author_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_apparent_author_name-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 689</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_apparent_author_name</span>()
        <span class="ruby-comment"># This gets the alias if there is one, and the real author if there isn't.</span>
        <span class="ruby-identifier">author_rec</span> = <span class="ruby-identifier">get_apparent_author</span>()
        <span class="ruby-identifier">auth</span> = <span class="ruby-identifier">author_rec</span>.<span class="ruby-identifier">fullname</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">author_rec</span>.<span class="ruby-identifier">fullname</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">author_rec</span>.<span class="ruby-identifier">username</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">auth</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_apparent_author_name-source -->
          
        </div>

        

        
      </div><!-- get_apparent_author_name-method -->

    
      <div id="method-i-get_authors" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_authors</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_authors-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 675</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_authors</span>()
        <span class="ruby-identifier">users</span> = [ <span class="ruby-identifier">get_apparent_author</span>() ]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">additional_authors</span>
                <span class="ruby-identifier">ids</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">additional_authors</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
                <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">id</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>
                                <span class="ruby-identifier">users</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">user</span>)
                        <span class="ruby-keyword">end</span>
                }
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">users</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_authors-source -->
          
        </div>

        

        
      </div><!-- get_authors-method -->

    
      <div id="method-i-get_badge" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_badge</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_badge-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_badge</span>()
        <span class="ruby-comment"># if the exhibit is in a group, then we will use that group's badge, if it exists</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-constant">PeerReview</span>.<span class="ruby-identifier">get_badge</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">badge_id</span>)
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment"># either the group wasn't peer-reviewed, or the exhibit isn't in a group</span>
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_badge-source -->
          
        </div>

        

        
      </div><!-- get_badge-method -->

    
      <div id="method-i-get_category" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_category</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_category-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 748</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_category</span>()
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;community&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>).<span class="ruby-identifier">group_type</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_category-source -->
          
        </div>

        

        
      </div><!-- get_category-method -->

    
      <div id="method-i-get_effective_license_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_effective_license_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_effective_license_type-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 735</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_effective_license_type</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">is_license_specified</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">license_type</span>)
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">license_type</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_effective_license_type-source -->
          
        </div>

        

        
      </div><!-- get_effective_license_type-method -->

    
      <div id="method-i-get_font_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_font_name</span><span
            class="method-args">(type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_font_name-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 707</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_font_name</span>(<span class="ruby-identifier">type</span>)
        <span class="ruby-identifier">type</span> = <span class="ruby-identifier">type</span> <span class="ruby-operator">+</span> <span class="ruby-string">'_font_name'</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>[<span class="ruby-identifier">type</span>]
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span>[<span class="ruby-identifier">type</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">group</span>[<span class="ruby-identifier">type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>[<span class="ruby-identifier">type</span>]
                <span class="ruby-keyword">else</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">group</span>[<span class="ruby-identifier">type</span>]
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_font_name-source -->
          
        </div>

        

        
      </div><!-- get_font_name-method -->

    
      <div id="method-i-get_font_size" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_font_size</span><span
            class="method-args">(type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_font_size-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 721</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_font_size</span>(<span class="ruby-identifier">type</span>)
        <span class="ruby-identifier">type</span> = <span class="ruby-identifier">type</span> <span class="ruby-operator">+</span> <span class="ruby-string">'_font_size'</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>[<span class="ruby-identifier">type</span>]
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span>[<span class="ruby-identifier">type</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">group</span>[<span class="ruby-identifier">type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>[<span class="ruby-identifier">type</span>]
                <span class="ruby-keyword">else</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">group</span>[<span class="ruby-identifier">type</span>]
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_font_size-source -->
          
        </div>

        

        
      </div><!-- get_font_size-method -->

    
      <div id="method-i-get_friendly_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_friendly_url</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_friendly_url-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 702</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_friendly_url</span>()
        <span class="ruby-identifier">url</span> = (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">visible_url</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">visible_url</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)  <span class="ruby-operator">?</span> <span class="ruby-node">&quot;/exhibits/#{self.visible_url}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;/exhibits/#{self.id}&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">url</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_friendly_url-source -->
          
        </div>

        

        
      </div><!-- get_friendly_url-method -->

    
      <div id="method-i-get_id_if_no_visible_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_id_if_no_visible_url</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>def self.getJsonLicenseInfo()</p>

<pre class="ruby"><span class="ruby-identifier">str</span> = <span class="ruby-node">&quot;[ { text: 'Exhibit should be visible to just me', icon: \&quot;#{self.get_sharing_icon_url(0)}\&quot; },&quot;</span>
<span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">6</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;{ text: '&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_text</span>(<span class="ruby-identifier">i</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;', icon: \&quot;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_sharing_icon_url</span>(<span class="ruby-identifier">i</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot; }&quot;</span>
   <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;{ text: '&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;t&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;', icon: \&quot;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;i&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot; }&quot;</span>
  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;,&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">6</span>
<span class="ruby-keyword">end</span>
<span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;]&quot;</span>
<span class="ruby-keyword">return</span> <span class="ruby-identifier">str</span>
</pre>

<p>end</p>
          

          
          <div class="method-source-code" id="get_id_if_no_visible_url-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 368</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_id_if_no_visible_url</span>()
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">visible_url</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">visible_url</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{id}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">''</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_id_if_no_visible_url-source -->
          
        </div>

        

        
      </div><!-- get_id_if_no_visible_url-method -->

    
      <div id="method-i-get_publish_links" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_publish_links</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_publish_links-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1010</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_publish_links</span>()
        <span class="ruby-identifier">ret</span> = []
        <span class="ruby-keyword">if</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">is_peer_reviewed_group</span>(<span class="ruby-keyword">self</span>)
                <span class="ruby-keyword">case</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span>
                <span class="ruby-keyword">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review/share with everyone]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review/share with everyone]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">3</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review/share with everyone]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">4</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review/share with everyone]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">5</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Submit for peer review/don't share]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> })
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">case</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span>
                <span class="ruby-keyword">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with group]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Publish to web]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with group]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with group]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">3</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Publish to web]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with administrators]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span> })
                <span class="ruby-keyword">when</span> <span class="ruby-value">4</span> <span class="ruby-keyword">then</span>
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Publish to web]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> })
                        <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>( { <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[Share with group]&quot;</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> })
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">text</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;[Unpublish]&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[Publish to web]&quot;</span>
                <span class="ruby-identifier">param</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>
                <span class="ruby-keyword">return</span> [ { <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>, <span class="ruby-value">:param</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">param</span> } ]
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_publish_links-source -->
          
        </div>

        

        
      </div><!-- get_publish_links-method -->

    
      <div id="method-i-get_sharing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 252</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sharing</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">get_sharing_static</span>(<span class="ruby-identifier">get_effective_license_type</span>())
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing-source -->
          
        </div>

        

        
      </div><!-- get_sharing-method -->

    
      <div id="method-i-get_sharing_icon_with_link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_icon_with_link</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_icon_with_link-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 329</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sharing_icon_with_link</span>()
              <span class="ruby-identifier">effective_license</span> = <span class="ruby-identifier">get_effective_license_type</span>()
  <span class="ruby-identifier">license</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">get_sharing_license_type</span>(<span class="ruby-identifier">effective_license</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&lt;a rel=\&quot;license\&quot; target='_blank' href=\&quot;http://creativecommons.org/licenses/&quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-identifier">license</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;/3.0/us/\&quot; title='This work is licensed under a Creative Commons #{Exhibit.get_sharing_static(effective_license)} 3.0 United States License'&gt;#{Exhibit.get_sharing_icon_url(effective_license)}&lt;/a&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_icon_with_link-source -->
          
        </div>

        

        
      </div><!-- get_sharing_icon_with_link-method -->

    
      <div id="method-i-get_sharing_image" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_image</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_image-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 317</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sharing_image</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">get_sharing_icon_url</span>(<span class="ruby-identifier">get_effective_license_type</span>())
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_image-source -->
          
        </div>

        

        
      </div><!-- get_sharing_image-method -->

    
      <div id="method-i-get_sharing_int" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_int</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_int-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sharing_int</span>()
              <span class="ruby-identifier">license</span> = <span class="ruby-identifier">get_effective_license_type</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">is_license_specified</span>(<span class="ruby-identifier">license</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">license</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">get_default_license</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_int-source -->
          
        </div>

        

        
      </div><!-- get_sharing_int-method -->

    
      <div id="method-i-get_sharing_widget" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sharing_widget</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_sharing_widget-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 307</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sharing_widget</span>()
  <span class="ruby-comment">#if published?</span>
    <span class="ruby-identifier">license</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">get_sharing_license_type</span>(<span class="ruby-identifier">get_effective_license_type</span>())
    <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{get_sharing_icon_with_link()}&lt;p&gt;This work is licensed under a &lt;a rel=\&quot;license\&quot; target='_blank' href=\&quot;http://creativecommons.org/licenses/&quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-identifier">license</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/3.0/us/\&quot;&gt;Creative Commons &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_sharing</span>() <span class="ruby-operator">+</span> <span class="ruby-string">&quot; 3.0 United States License&lt;/a&gt;.&lt;/p&gt;&quot;</span>
  <span class="ruby-comment">#else</span>
  <span class="ruby-comment">#  return &quot;This exhibit is visible to just me.&quot;</span>
  <span class="ruby-comment">#end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_sharing_widget-source -->
          
        </div>

        

        
      </div><!-- get_sharing_widget-method -->

    
      <div id="method-i-get_starting_footnote_per_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_starting_footnote_per_page</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_starting_footnote_per_page-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 594</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_starting_footnote_per_page</span>()
        <span class="ruby-identifier">footnotes</span> = []
        <span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">page</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exhibit_pages</span>
                <span class="ruby-identifier">footnotes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">count</span>)
                <span class="ruby-keyword">for</span> <span class="ruby-identifier">element</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_elements</span>
                        <span class="ruby-keyword">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_element_layout_type</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'header'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>])
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pic_text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>])
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">1</span>])
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'pics'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-keyword">for</span> <span class="ruby-identifier">illustration</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>
                                        <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">illustration</span>)
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'blockquote'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>])
                        <span class="ruby-keyword">when</span> <span class="ruby-string">'text_pic_text'</span> <span class="ruby-keyword">then</span>
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_illustration</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>[<span class="ruby-value">0</span>])
                                <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_footnotes_from_text</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">footnotes</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_starting_footnote_per_page-source -->
          
        </div>

        

        
      </div><!-- get_starting_footnote_per_page-method -->

    
      <div id="method-i-get_visibility_friendly_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_visibility_friendly_text</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_visibility_friendly_text-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 993</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_visibility_friendly_text</span>()
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Access to this exhibit is restricted to you.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>       <span class="ruby-comment"># if it is not published, that's the same in all cases</span>
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to everyone.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>   <span class="ruby-comment"># if it is not in a group, then all the special cases don't apply</span>
        <span class="ruby-keyword">if</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">is_peer_reviewed_group</span>(<span class="ruby-keyword">self</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to everyone.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Submitted for peer-review&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to the group's administrators.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Submitted for peer-review/visible to everyone.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to everyone.&quot;</span>        <span class="ruby-comment"># This case probably won't happen, but it could if the user changes the group when in a funny state.</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to everyone.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to members of the group.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to the group's administrators.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;This exhibit is visible to everyone.&quot;</span>        <span class="ruby-comment"># This case probably won't happen, but it could if the user changes the group when in a funny state.</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_visibility_friendly_text-source -->
          
        </div>

        

        
      </div><!-- get_visibility_friendly_text-method -->

    
      <div id="method-i-handle_solr" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">handle_solr</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="handle_solr-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">handle_solr</span>
        <span class="ruby-constant">SearchUserContent</span>.<span class="ruby-identifier">delay</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">'exhibit'</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- handle_solr-source -->
          
        </div>

        

        
      </div><!-- handle_solr-method -->

    
      <div id="method-i-index_exhibit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index_exhibit</span><span
            class="method-args">(should_commit)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="index_exhibit-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 885</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index_exhibit</span>(<span class="ruby-identifier">should_commit</span>)
        <span class="ruby-identifier">solr</span> = <span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">factory_create</span>(<span class="ruby-keyword">false</span>)
        
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Delete old index #{self.id}&quot;</span>
        <span class="ruby-identifier">solr</span>.<span class="ruby-identifier">delete_exhibit</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-keyword">false</span>)
        
        <span class="ruby-identifier">full_data</span> = []
        <span class="ruby-identifier">section_name</span> = <span class="ruby-string">&quot;&quot;</span>     <span class="ruby-comment"># The sections are set whenever there is a new header element; it is independent of the page.</span>
        <span class="ruby-identifier">num_sections</span> = <span class="ruby-value">0</span>
        <span class="ruby-identifier">section_page</span> = <span class="ruby-value">1</span>
        <span class="ruby-identifier">data</span> = []
        <span class="ruby-identifier">pages</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exhibit_pages</span>
        <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">elements</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">exhibit_elements</span>
                <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_element_layout_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'header'</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">section_name</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                                        <span class="ruby-identifier">add_object</span>(<span class="ruby-identifier">data</span>, <span class="ruby-value">:partial</span>, { <span class="ruby-value">:count</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">num_sections</span>, <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">section_name</span>, <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">section_page</span> }, <span class="ruby-keyword">false</span>)
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">section_name</span> = <span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)
                                <span class="ruby-identifier">section_page</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">position</span>
                                <span class="ruby-identifier">num_sections</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                                <span class="ruby-identifier">data</span> = []
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>
                        <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>
                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text</span>
                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">element_text2</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span>
                                <span class="ruby-identifier">footnote</span> = <span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">element</span>.<span class="ruby-identifier">header_footnote_id</span>)
                                <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">illustrations</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">exhibit_illustrations</span>
                        <span class="ruby-identifier">illustrations</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">illustration</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>
                                <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1</span>
                                <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2</span>
                                <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">alt_text</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">alt_text</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">illustration_text</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2</span>
                                <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">alt_text</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">alt_text</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span>
                                        <span class="ruby-identifier">footnote</span> = <span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption1_footnote_id</span>)
                                        <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span>
                                        <span class="ruby-identifier">footnote</span> = <span class="ruby-constant">ExhibitFootnote</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">illustration</span>.<span class="ruby-identifier">caption2_footnote_id</span>)
                                        <span class="ruby-identifier">data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                        <span class="ruby-identifier">full_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">Exhibit</span>.<span class="ruby-identifier">strip_tags</span>(<span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">footnote</span>.<span class="ruby-identifier">footnote</span>
                                <span class="ruby-keyword">end</span>
                        }
                }
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">section_name</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-identifier">add_object</span>(<span class="ruby-identifier">data</span>, <span class="ruby-value">:partial</span>, { <span class="ruby-value">:count</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">num_sections</span>, <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">section_name</span>, <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">section_page</span> }, <span class="ruby-keyword">false</span>)
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-identifier">add_object</span>(<span class="ruby-identifier">full_data</span>, <span class="ruby-value">:whole</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">should_commit</span>)

        <span class="ruby-comment"># add to the resource tree</span>
        <span class="ruby-comment">#value = self.make_archive_name()</span>
        <span class="ruby-comment">#puts &quot;Add #{value} to resource tree&quot;</span>
        <span class="ruby-comment">#facet = FacetCategory.find_by_value(value)</span>
        <span class="ruby-comment">#parent = FacetCategory.find_by_value(&quot;#{Setup.site_name()} Exhibits&quot;)</span>
        <span class="ruby-comment">#id = parent ? parent.id : 1</span>
        <span class="ruby-comment">#if facet == nil</span>
        <span class="ruby-comment">#     FacetValue.create(:value =&gt; value, :parent_id =&gt; id)</span>
        <span class="ruby-comment">#end</span>
        <span class="ruby-comment">#site = Catalog.factory_create(false).get_archive(value) #Site.find_by_code(value)</span>
        <span class="ruby-comment">#if site == nil</span>
        <span class="ruby-comment">#     Site.create(:code =&gt; value, :description =&gt; make_resource_name())</span>
        <span class="ruby-comment">#end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- index_exhibit-source -->
          
        </div>

        

        
      </div><!-- index_exhibit-method -->

    
      <div id="method-i-insert_example_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">insert_example_page</span><span
            class="method-args">(page_num)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="insert_example_page-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">insert_example_page</span>(<span class="ruby-identifier">page_num</span>)
  <span class="ruby-identifier">new_page</span> = <span class="ruby-constant">ExhibitPage</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:exhibit_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">new_page</span>.<span class="ruby-identifier">insert_at</span>(<span class="ruby-identifier">page_num</span>)
  
  <span class="ruby-identifier">type1</span> = <span class="ruby-string">'pic_text'</span>
  <span class="ruby-identifier">type2</span> = <span class="ruby-string">'text_pic'</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_num</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">type1</span> = <span class="ruby-string">'text_pic'</span>
    <span class="ruby-identifier">type2</span> = <span class="ruby-string">'pic_text'</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_page</span>.<span class="ruby-identifier">insert_element</span>(<span class="ruby-value">1</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_num</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
          <span class="ruby-identifier">el</span>.<span class="ruby-identifier">element_text</span> = <span class="ruby-string">&quot;Welcome to your new exhibit. Click here to enter text, or select another layout from the section editing toolbar above.&quot;</span>
              <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">el</span>.<span class="ruby-identifier">element_text</span> = <span class="ruby-string">&quot;Enter your text here.&quot;</span>
              <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#el.element_text = &quot;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&quot;</span>
  
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">change_layout</span>(<span class="ruby-identifier">type1</span>)
  <span class="ruby-constant">ExhibitIllustration</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">1</span>)

  <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_page</span>.<span class="ruby-identifier">insert_element</span>(<span class="ruby-value">2</span>)
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">element_text</span> = <span class="ruby-string">&quot;Enter your text here.&quot;</span>
  <span class="ruby-comment">#el.element_text = &quot;Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?&quot;</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-identifier">el</span> = <span class="ruby-identifier">new_page</span>.<span class="ruby-identifier">insert_element</span>(<span class="ruby-value">3</span>)
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">element_text</span> = <span class="ruby-string">&quot;Enter your text here.&quot;</span>
  <span class="ruby-comment">#el.element_text = &quot;At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.&quot;</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">el</span>.<span class="ruby-identifier">change_layout</span>(<span class="ruby-identifier">type2</span>)
  <span class="ruby-constant">ExhibitIllustration</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- insert_example_page-source -->
          
        </div>

        

        
      </div><!-- insert_example_page-method -->

    
      <div id="method-i-insert_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">insert_page</span><span
            class="method-args">(page_num)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="insert_page-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">insert_page</span>(<span class="ruby-identifier">page_num</span>)
  <span class="ruby-identifier">new_page</span> = <span class="ruby-constant">ExhibitPage</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:exhibit_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">new_page</span>.<span class="ruby-identifier">insert_at</span>(<span class="ruby-identifier">page_num</span>)
  <span class="ruby-identifier">new_page</span>.<span class="ruby-identifier">insert_element</span>(<span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- insert_page-source -->
          
        </div>

        

        
      </div><!-- insert_page-method -->

    
      <div id="method-i-is_peer_reviewed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_peer_reviewed</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="is_peer_reviewed-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 1163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_peer_reviewed</span>()
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>  <span class="ruby-comment"># and if it isn't in a group, it can't be peer-reviewed any other way</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>        <span class="ruby-comment"># even if it is in a peer-reviewed group, it must be published to be peer-reviewed</span>
        <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">group_id</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'peer-reviewed'</span>    <span class="ruby-comment"># so it is in a peer-reviewed group and it is published.</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_peer_reviewed-source -->
          
        </div>

        

        
      </div><!-- is_peer_reviewed-method -->

    
      <div id="method-i-make_archive_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_archive_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Generate a namespaced archive name for an exhibit. Example
exhibit_NINES_152</p>
          

          
          <div class="method-source-code" id="make_archive_name-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 834</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">make_archive_name</span>
  <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{ARCHIVE_PREFIX}#{Setup.site_name()}_#{self.id}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- make_archive_name-source -->
          
        </div>

        

        
      </div><!-- make_archive_name-method -->

    
      <div id="method-i-make_old_archive_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_old_archive_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>generate the old-style archive name for an exhibitâ€¦ like: exhibit_152</p>
          

          
          <div class="method-source-code" id="make_old_archive_name-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 828</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_old_archive_name</span>
        <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{ARCHIVE_PREFIX}#{self.id}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- make_old_archive_name-source -->
          
        </div>

        

        
      </div><!-- make_old_archive_name-method -->

    
      <div id="method-i-make_resource_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_resource_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="make_resource_name-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_resource_name</span>
        <span class="ruby-identifier">name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">resource_name</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>().<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
                <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;#{self.id}&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- make_resource_name-source -->
          
        </div>

        

        
      </div><!-- make_resource_name-method -->

    
      <div id="method-i-move_page_down" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">move_page_down</span><span
            class="method-args">(page_num)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="move_page_down-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">move_page_down</span>(<span class="ruby-identifier">page_num</span>)
  <span class="ruby-identifier">curr_page</span> = <span class="ruby-identifier">exhibit_pages</span>[<span class="ruby-identifier">page_num</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
  <span class="ruby-identifier">curr_page</span>.<span class="ruby-identifier">move_lower</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- move_page_down-source -->
          
        </div>

        

        
      </div><!-- move_page_down-method -->

    
      <div id="method-i-move_page_up" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">move_page_up</span><span
            class="method-args">(page_num)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="move_page_up-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">move_page_up</span>(<span class="ruby-identifier">page_num</span>)
  <span class="ruby-identifier">curr_page</span> = <span class="ruby-identifier">exhibit_pages</span>[<span class="ruby-identifier">page_num</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
  <span class="ruby-identifier">curr_page</span>.<span class="ruby-identifier">move_higher</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- move_page_up-source -->
          
        </div>

        

        
      </div><!-- move_page_up-method -->

    
      <div id="method-i-published-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">published?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="published-3F-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 248</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">published?</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_published</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- published-3F-source -->
          
        </div>

        

        
      </div><!-- published-3F-method -->

    
      <div id="method-i-reset_fonts_to_default" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_fonts_to_default</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="reset_fonts_to_default-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_fonts_to_default</span>
        <span class="ruby-comment"># set the default values for fields that were added later</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">header_font_name</span> = <span class="ruby-string">'Arial'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">header_font_size</span> = <span class="ruby-string">'24'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">text_font_name</span> = <span class="ruby-string">'Times New Roman'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">text_font_size</span> = <span class="ruby-string">'18'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">illustration_font_name</span> = <span class="ruby-string">'Trebuchet MS'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">illustration_font_size</span> = <span class="ruby-string">'14'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption1_font_name</span> = <span class="ruby-string">'Trebuchet MS'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption1_font_size</span> = <span class="ruby-string">'14'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption2_font_name</span> = <span class="ruby-string">'Trebuchet MS'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">caption2_font_size</span> = <span class="ruby-string">'14'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">endnotes_font_name</span> = <span class="ruby-string">'Times New Roman'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">endnotes_font_size</span> = <span class="ruby-string">'16'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">footnote_font_name</span> = <span class="ruby-string">'Times New Roman'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">footnote_font_size</span> = <span class="ruby-string">'16'</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_fonts_to_default-source -->
          
        </div>

        

        
      </div><!-- reset_fonts_to_default-method -->

    
      <div id="method-i-set_sharing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_sharing</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="set_sharing-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_sharing</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">str</span>
    <span class="ruby-comment">#when &quot;Not Shared&quot;: self.is_published = 0</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Attribution&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Attribution Share Alike&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Attribution No Derivatives&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Attribution Non-Commercial&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">4</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Attribution Non-Commercial Share Alike&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">5</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Attribution Non-Commercial No Derivatives&quot;</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">6</span>
    <span class="ruby-comment">#when '0': self.is_published = 0</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'1'</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'2'</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'3'</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'4'</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">4</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'5'</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">5</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'6'</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-value">6</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">license_type</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_default_license</span>()
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_sharing-source -->
          
        </div>

        

        
      </div><!-- set_sharing-method -->

    
      <div id="method-i-unindex_exhibit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unindex_exhibit</span><span
            class="method-args">(should_commit)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="unindex_exhibit-source">
            <pre><span class="ruby-comment"># File app/models/exhibit.rb, line 838</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unindex_exhibit</span>(<span class="ruby-identifier">should_commit</span>)
        <span class="ruby-identifier">@@solr</span> = <span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">factory_create</span>(<span class="ruby-keyword">false</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">@@solr</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">@@solr</span>.<span class="ruby-identifier">delete_exhibit</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">should_commit</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- unindex_exhibit-source -->
          
        </div>

        

        
      </div><!-- unindex_exhibit-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

